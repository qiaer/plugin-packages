"use strict";var go=Object.defineProperty;var _o=(e,t,r)=>t in e?go(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var re=(e,t,r)=>(_o(e,typeof t!="symbol"?t+"":t,r),r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var Bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jn={exports:{}},fr={exports:{}},mn;function yo(){return mn||(mn=1,function(e){(function(t,r){var n=function(){var m={};return r.apply(m,arguments),m.moxie};e.exports?e.exports=n():t.moxie=n()})(Bn||window,function(){(function(t,r){var n={};function m(d,i){for(var a,c=[],o=0;o<d.length;++o){if(a=n[d[o]]||x(d[o]),!a)throw"module definition dependecy not found: "+d[o];c.push(a)}i.apply(null,c)}function p(d,i,a){if(typeof d!="string")throw"invalid module definition, module id must be defined and be a string";if(i===r)throw"invalid module definition, dependencies must be specified";if(a===r)throw"invalid module definition, definition function must be specified";m(i,function(){n[d]=a.apply(null,arguments)})}function b(d){return!!n[d]}function x(d){for(var i=t,a=d.split(/[.\/]/),c=0;c<a.length;++c){if(!i[a[c]])return;i=i[a[c]]}return i}function E(d){for(var i=0;i<d.length;i++){for(var a=t,c=d[i],o=c.split(/[.\/]/),l=0;l<o.length-1;++l)a[o[l]]===r&&(a[o[l]]={}),a=a[o[l]];a[o[o.length-1]]=n[c]}}p("moxie/core/utils/Basic",[],function(){function d(D){var L;return D===L?"undefined":D===null?"null":D.nodeType?"node":{}.toString.call(D).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function i(){return f(!1,!1,arguments)}function a(){return f(!0,!1,arguments)}function c(){return f(!1,!0,arguments)}function o(){return f(!0,!0,arguments)}function l(D){switch(d(D)){case"array":return f(!1,!0,[[],D]);case"object":return f(!1,!0,[{},D]);default:return D}}function s(D){switch(d(D)){case"array":return Array.prototype.slice.call(D);case"object":return i({},D)}return D}function f(D,L,F){var q,W=F[0];return y(F,function(z,G){G>0&&y(z,function(A,N){var U=v(d(A),["array","object"])!==-1;if(A===q||D&&W[N]===q)return!0;U&&L&&(A=s(A)),d(W[N])===d(A)&&U?f(D,L,[W[N],A]):W[N]=A})}),W}function u(D,L){for(var F in L)({}).hasOwnProperty.call(L,F)&&(D[F]=L[F]);function q(){this.constructor=D;{var W=function(z){var G=z.toString().match(/^function\s([^\(\s]+)/);return G?G[1]:!1};this.ctorName=W(D)}}return q.prototype=L.prototype,D.prototype=new q,D.parent=L.prototype,D}function y(D,L){var F,q,W,z;if(D){try{F=D.length}catch{F=z}if(F===z||typeof F!="number"){for(q in D)if(D.hasOwnProperty(q)&&L(D[q],q)===!1)return}else for(W=0;W<F;W++)if(L(D[W],W)===!1)return}}function w(D){var L;if(!D||d(D)!=="object")return!0;for(L in D)return!1;return!0}function g(D,L){var F=0,q=D.length;d(L)!=="function"&&(L=function(){}),(!D||!D.length)&&L();function W(z){d(D[z])==="function"&&D[z](function(G){++z<q&&!G?W(z):L(G)})}W(F)}function h(D,L){var F=0,q=D.length,W=new Array(q);y(D,function(z,G){z(function(A){if(A)return L(A);var N=[].slice.call(arguments);N.shift(),W[G]=N,F++,F===q&&(W.unshift(null),L.apply(this,W))})})}function v(D,L){if(L){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(L,D);for(var F=0,q=L.length;F<q;F++)if(L[F]===D)return F}return-1}function _(D,L){var F=[];d(D)!=="array"&&(D=[D]),d(L)!=="array"&&(L=[L]);for(var q in D)v(D[q],L)===-1&&F.push(D[q]);return F.length?F:!1}function R(D,L){var F=[];return y(D,function(q){v(q,L)!==-1&&F.push(q)}),F.length?F:null}function S(D){var L,F=[];for(L=0;L<D.length;L++)F[L]=D[L];return F}var O=function(){var D=0;return function(L){var F=new Date().getTime().toString(32),q;for(q=0;q<5;q++)F+=Math.floor(Math.random()*65535).toString(32);return(L||"o_")+F+(D++).toString(32)}}();function P(D){return D&&(String.prototype.trim?String.prototype.trim.call(D):D.toString().replace(/^\s*/,"").replace(/\s*$/,""))}function I(D){if(typeof D!="string")return D;var L={t:1099511627776,g:1073741824,m:1048576,k:1024},F;return D=/^([0-9\.]+)([tmgk]?)$/.exec(D.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),F=D[2],D=+D[1],L.hasOwnProperty(F)&&(D*=L[F]),Math.floor(D)}function T(D){var L=[].slice.call(arguments,1);return D.replace(/%([a-z])/g,function(F,q){var W=L.shift();switch(q){case"s":return W+"";case"d":return parseInt(W,10);case"f":return parseFloat(W);case"c":return"";default:return W}})}function C(D,L){var F=this;setTimeout(function(){D.call(F)},L||1)}return{guid:O,typeOf:d,extend:i,extendIf:a,extendImmutable:c,extendImmutableIf:o,clone:l,inherit:u,each:y,isEmptyObj:w,inSeries:g,inParallel:h,inArray:v,arrayDiff:_,arrayIntersect:R,toArray:S,trim:P,sprintf:T,parseSizeStr:I,delay:C}}),p("moxie/core/utils/Encode",[],function(){var d=function(o){return unescape(encodeURIComponent(o))},i=function(o){return decodeURIComponent(escape(o))},a=function(o,l){if(typeof window.atob=="function")return l?i(window.atob(o)):window.atob(o);var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f,u,y,w,g,h,v,_,R=0,S=0,O="",P=[];if(!o)return o;o+="";do w=s.indexOf(o.charAt(R++)),g=s.indexOf(o.charAt(R++)),h=s.indexOf(o.charAt(R++)),v=s.indexOf(o.charAt(R++)),_=w<<18|g<<12|h<<6|v,f=_>>16&255,u=_>>8&255,y=_&255,h==64?P[S++]=String.fromCharCode(f):v==64?P[S++]=String.fromCharCode(f,u):P[S++]=String.fromCharCode(f,u,y);while(R<o.length);return O=P.join(""),l?i(O):O},c=function(o,l){if(l&&(o=d(o)),typeof window.btoa=="function")return window.btoa(o);var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f,u,y,w,g,h,v,_,R=0,S=0,O="",P=[];if(!o)return o;do f=o.charCodeAt(R++),u=o.charCodeAt(R++),y=o.charCodeAt(R++),_=f<<16|u<<8|y,w=_>>18&63,g=_>>12&63,h=_>>6&63,v=_&63,P[S++]=s.charAt(w)+s.charAt(g)+s.charAt(h)+s.charAt(v);while(R<o.length);O=P.join("");var I=o.length%3;return(I?O.slice(0,I-3):O)+"===".slice(I||3)};return{utf8_encode:d,utf8_decode:i,atob:a,btoa:c}}),p("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(d){var i=function(s){var f="",u="?",y="function",w="undefined",g="object",h="name",v="version",_={has:function(I,T){return T.toLowerCase().indexOf(I.toLowerCase())!==-1},lowerize:function(I){return I.toLowerCase()}},R={rgx:function(){for(var I,T=0,C,D,L,F,q,W,z=arguments;T<z.length;T+=2){var G=z[T],A=z[T+1];if(typeof I===w){I={};for(L in A)F=A[L],typeof F===g?I[F[0]]=s:I[F]=s}for(C=D=0;C<G.length;C++)if(q=G[C].exec(this.getUA()),q){for(L=0;L<A.length;L++)W=q[++D],F=A[L],typeof F===g&&F.length>0?F.length==2?typeof F[1]==y?I[F[0]]=F[1].call(this,W):I[F[0]]=F[1]:F.length==3?typeof F[1]===y&&!(F[1].exec&&F[1].test)?I[F[0]]=W?F[1].call(this,W,F[2]):s:I[F[0]]=W?W.replace(F[1],F[2]):s:F.length==4&&(I[F[0]]=W?F[3].call(this,W.replace(F[1],F[2])):s):I[F]=W||s;break}if(q)break}return I},str:function(I,T){for(var C in T)if(typeof T[C]===g&&T[C].length>0){for(var D=0;D<T[C].length;D++)if(_.has(T[C][D],I))return C===u?s:C}else if(_.has(T[C],I))return C===u?s:C;return I}},S={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"}}}},O={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[h,v],[/\s(opr)\/([\w\.]+)/i],[[h,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[h,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[h,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[h,v],[/(yabrowser)\/([\w\.]+)/i],[[h,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],v],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[h,v],[/(dolfin)\/([\w\.]+)/i],[[h,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[h,"Chrome"],v],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[v,[h,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[v,[h,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[v,[h,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[h,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,h],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[h,[v,R.str,S.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[h,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[h,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[h,v]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[h,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,v],[/rv\:([\w\.]+).*(gecko)/i],[v,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[v,R.str,S.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[v,R.str,S.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[h,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[h,"Symbian"],v],[/\((series40);/i],[h],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],v],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[h,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[h,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[h,v],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[h,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[h,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[h,v]]},P=function(I){var T=I||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:f);this.getBrowser=function(){return R.rgx.apply(this,O.browser)},this.getEngine=function(){return R.rgx.apply(this,O.engine)},this.getOS=function(){return R.rgx.apply(this,O.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return T},this.setUA=function(C){return T=C,this},this.setUA(T)};return P}();function a(s,f,u){var y=0,w=0,g=0,h={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},v=function(R){return R=(""+R).replace(/[_\-+]/g,"."),R=R.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),R.length?R.split("."):[-8]},_=function(R){return R?isNaN(R)?h[R]||-7:parseInt(R,10):0};for(s=v(s),f=v(f),w=Math.max(s.length,f.length),y=0;y<w;y++)if(s[y]!=f[y]){if(s[y]=_(s[y]),f[y]=_(f[y]),s[y]<f[y]){g=-1;break}else if(s[y]>f[y]){g=1;break}}if(!u)return g;switch(u){case">":case"gt":return g>0;case">=":case"ge":return g>=0;case"<=":case"le":return g<=0;case"==":case"=":case"eq":return g===0;case"<>":case"!=":case"ne":return g!==0;case"":case"<":case"lt":return g<0;default:return null}}var c=function(){var s={access_global_ns:function(){return!!window.moxie},define_property:function(){return!1}(),create_canvas:function(){var f=document.createElement("canvas"),u=!!(f.getContext&&f.getContext("2d"));return s.create_canvas=u,u},return_response_type:function(f){try{if(d.inArray(f,["","text","document"])!==-1)return!0;if(window.XMLHttpRequest){var u=new XMLHttpRequest;if(u.open("get","/"),"responseType"in u)return u.responseType=f,u.responseType===f}}catch{}return!1},use_blob_uri:function(){var f=window.URL;return s.use_blob_uri=f&&"createObjectURL"in f&&"revokeObjectURL"in f&&(l.browser!=="IE"||l.verComp(l.version,"11.0.46",">=")),s.use_blob_uri},use_data_uri:function(){var f=new Image;return f.onload=function(){s.use_data_uri=f.width===1&&f.height===1},setTimeout(function(){f.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return s.use_data_uri&&(l.browser!=="IE"||l.version>=9)},use_data_uri_of:function(f){return s.use_data_uri&&f<33e3||s.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var f=document.createElement("input");return f.setAttribute("type","file"),s.use_fileinput=!f.disabled},use_webgl:function(){var f=document.createElement("canvas"),u=null,y;try{u=f.getContext("webgl")||f.getContext("experimental-webgl")}catch{}return u||(u=null),y=!!u,s.use_webgl=y,f=r,y}};return function(f){var u=[].slice.call(arguments);return u.shift(),d.typeOf(s[f])==="function"?s[f].apply(this,u):!!s[f]}}(),o=new i().getResult(),l={can:c,uaParser:i,browser:o.browser.name,version:o.browser.version,os:o.os.name,osVersion:o.os.version,verComp:a,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return l.OS=l.os,l.debug={runtime:!0,events:!1},l.log=function(){function s(y){f.appendChild(document.createTextNode(y+`
`))}if(window&&window.console&&window.console.log&&window.console.log.apply)window.console.log.apply(window.console,arguments);else if(document){var f=document.getElementById("moxie-console");f||(f=document.createElement("pre"),f.id="moxie-console",document.body.appendChild(f));var u=arguments[0];if(d.typeOf(u)==="string")u=d.sprintf.apply(this,arguments);else if(d.inArray(d.typeOf(u),["object","array"])!==-1){s(u);return}f.appendChild(document.createTextNode(u+`
`))}},l}),p("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(d){function i(a,c){var o;for(o in a)if(a[o]===c)return o;return null}return{RuntimeError:function(){var a={NOT_INIT_ERR:1,EXCEPTION_ERR:3,NOT_SUPPORTED_ERR:9,JS_ERR:4};function c(o,l){this.code=o,this.name=i(a,o),this.message=this.name+(l||": RuntimeError "+this.code)}return d.extend(c,a),c.prototype=Error.prototype,c}(),OperationNotAllowedException:function(){function a(c){this.code=c,this.name="OperationNotAllowedException"}return d.extend(a,{NOT_ALLOWED_ERR:1}),a.prototype=Error.prototype,a}(),ImageError:function(){var a={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};function c(o){this.code=o,this.name=i(a,o),this.message=this.name+": ImageError "+this.code}return d.extend(c,a),c.prototype=Error.prototype,c}(),FileException:function(){var a={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function c(o){this.code=o,this.name=i(a,o),this.message=this.name+": FileException "+this.code}return d.extend(c,a),c.prototype=Error.prototype,c}(),DOMException:function(){var a={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function c(o){this.code=o,this.name=i(a,o),this.message=this.name+": DOMException "+this.code}return d.extend(c,a),c.prototype=Error.prototype,c}(),EventException:function(){function a(c){this.code=c,this.name="EventException"}return d.extend(a,{UNSPECIFIED_EVENT_TYPE_ERR:0}),a.prototype=Error.prototype,a}()}}),p("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(d){var i=function(u){return typeof u!="string"?u:document.getElementById(u)},a=function(u,y){if(!u.className)return!1;var w=new RegExp("(^|\\s+)"+y+"(\\s+|$)");return w.test(u.className)},c=function(u,y){a(u,y)||(u.className=u.className?u.className.replace(/\s+$/,"")+" "+y:y)},o=function(u,y){if(u.className){var w=new RegExp("(^|\\s+)"+y+"(\\s+|$)");u.className=u.className.replace(w,function(g,h,v){return h===" "&&v===" "?" ":""})}},l=function(u,y){if(u.currentStyle)return u.currentStyle[y];if(window.getComputedStyle)return window.getComputedStyle(u,null)[y]},s=function(u,y){var w=0,g=0,h,v=document,_,R;u=u,y=y||v.body;function S(O){var P,I,T=0,C=0;return O&&(I=O.getBoundingClientRect(),P=v.compatMode==="CSS1Compat"?v.documentElement:v.body,T=I.left+P.scrollLeft,C=I.top+P.scrollTop),{x:T,y:C}}if(u&&u.getBoundingClientRect&&d.browser==="IE"&&(!v.documentMode||v.documentMode<8))return _=S(u),R=S(y),{x:_.x-R.x,y:_.y-R.y};for(h=u;h&&h!=y&&h.nodeType;)w+=h.offsetLeft||0,g+=h.offsetTop||0,h=h.offsetParent;for(h=u.parentNode;h&&h!=y&&h.nodeType;)w-=h.scrollLeft||0,g-=h.scrollTop||0,h=h.parentNode;return{x:w,y:g}},f=function(u){return{w:u.offsetWidth||u.clientWidth,h:u.offsetHeight||u.clientHeight}};return{get:i,hasClass:a,addClass:c,removeClass:o,getStyle:l,getPos:s,getSize:f}}),p("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(d,i,a){var c={};function o(){this.uid=a.guid()}return a.extend(o.prototype,{init:function(){this.uid||(this.uid=a.guid("uid_"))},addEventListener:function(l,s,f,u){var y=this,w;if(this.hasOwnProperty("uid")||(this.uid=a.guid("uid_")),l=a.trim(l),/\s/.test(l)){a.each(l.split(/\s+/),function(g){y.addEventListener(g,s,f,u)});return}l=l.toLowerCase(),f=parseInt(f,10)||0,w=c[this.uid]&&c[this.uid][l]||[],w.push({fn:s,priority:f,scope:u||this}),c[this.uid]||(c[this.uid]={}),c[this.uid][l]=w},hasEventListener:function(l){var s;return l?(l=l.toLowerCase(),s=c[this.uid]&&c[this.uid][l]):s=c[this.uid],s||!1},removeEventListener:function(l,s){var f=this,u,y;if(l=l.toLowerCase(),/\s/.test(l)){a.each(l.split(/\s+/),function(w){f.removeEventListener(w,s)});return}if(u=c[this.uid]&&c[this.uid][l],u){if(s){for(y=u.length-1;y>=0;y--)if(u[y].fn===s){u.splice(y,1);break}}else u=[];u.length||(delete c[this.uid][l],a.isEmptyObj(c[this.uid])&&delete c[this.uid])}},removeAllEventListeners:function(){c[this.uid]&&delete c[this.uid]},dispatchEvent:function(l){var s,f,u,y,w={},g=!0,h;if(a.typeOf(l)!=="string")if(y=l,a.typeOf(y.type)==="string")l=y.type,y.total!==h&&y.loaded!==h&&(w.total=y.total,w.loaded=y.loaded),w.async=y.async||!1;else throw new i.EventException(i.EventException.UNSPECIFIED_EVENT_TYPE_ERR);if(l.indexOf("::")!==-1?function(_){s=_[0],l=_[1]}(l.split("::")):s=this.uid,l=l.toLowerCase(),f=c[s]&&c[s][l],f){f.sort(function(_,R){return R.priority-_.priority}),u=[].slice.call(arguments),u.shift(),w.type=l,u.unshift(w),d.debug.events&&d.log("%cEvent '%s' fired on %s","color: #999;",w.type,(this.ctorName?this.ctorName+"::":"")+s);var v=[];a.each(f,function(_){u[0].target=_.scope,w.async?v.push(function(R){setTimeout(function(){R(_.fn.apply(_.scope,u)===!1)},1)}):v.push(function(R){R(_.fn.apply(_.scope,u)===!1)})}),v.length&&a.inSeries(v,function(_){g=!_})}return g},bindOnce:function(l,s,f,u){var y=this;y.bind.call(this,l,function w(){return y.unbind(l,w),s.apply(this,arguments)},f,u)},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(l){var s=this;this.bind(l.join(" "),function(f){var u="on"+f.type.toLowerCase();a.typeOf(this[u])==="function"&&this[u].apply(this,arguments)}),a.each(l,function(f){f="on"+f.toLowerCase(f),a.typeOf(s[f])==="undefined"&&(s[f]=null)})}}),o.instance=new o,o}),p("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(d,i,a,c){var o={},l={};function s(f,u,y,w,g){var h=this,v,_=i.guid(u+"_"),R=g||"browser";f=f||{},l[_]=this,y=i.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},y),f.preferred_caps&&(R=s.getMode(w,f.preferred_caps,R)),d.debug.runtime&&d.log("	default mode: %s",R),v=function(){var S={};return{exec:function(O,P,I,T){if(v[P]&&(S[O]||(S[O]={context:this,instance:new v[P]}),S[O].instance[I]))return S[O].instance[I].apply(this,T)},removeInstance:function(O){delete S[O]},removeAllInstances:function(){var O=this;i.each(S,function(P,I){i.typeOf(P.instance.destroy)==="function"&&P.instance.destroy.call(P.context),O.removeInstance(I)})}}}(),i.extend(this,{initialized:!1,uid:_,type:u,mode:s.getMode(w,f.required_caps,R),shimid:_+"_container",clients:0,options:f,can:function(S,O){var P=arguments[2]||y;if(i.typeOf(S)==="string"&&i.typeOf(O)==="undefined"&&(S=s.parseCaps(S)),i.typeOf(S)==="object"){for(var I in S)if(!this.can(I,S[I],P))return!1;return!0}return i.typeOf(P[S])==="function"?P[S].call(this,O):O===P[S]},getShimContainer:function(){var S,O=a.get(this.shimid);return O||(S=a.get(this.options.container)||document.body,O=document.createElement("div"),O.id=this.shimid,O.className="moxie-shim moxie-shim-"+this.type,i.extend(O.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),S.appendChild(O),S=null),O},getShim:function(){return v},shimExec:function(S,O){var P=[].slice.call(arguments,2);return h.getShim().exec.call(this,this.uid,S,O,P)},exec:function(S,O){var P=[].slice.call(arguments,2);return h[S]&&h[S][O]?h[S][O].apply(this,P):h.shimExec.apply(this,arguments)},destroy:function(){if(h){var S=a.get(this.shimid);S&&S.parentNode.removeChild(S),v&&v.removeAllInstances(),this.unbindAll(),delete l[this.uid],this.uid=null,_=h=v=S=null}}}),this.mode&&f.required_caps&&!this.can(f.required_caps)&&(this.mode=!1)}return s.order="html5,flash,silverlight,html4",s.getRuntime=function(f){return l[f]?l[f]:!1},s.addConstructor=function(f,u){u.prototype=c.instance,o[f]=u},s.getConstructor=function(f){return o[f]||null},s.getInfo=function(f){var u=s.getRuntime(f);return u?{uid:u.uid,type:u.type,mode:u.mode,can:function(){return u.can.apply(u,arguments)}}:null},s.parseCaps=function(f){var u={};return i.typeOf(f)!=="string"?f||{}:(i.each(f.split(","),function(y){u[y]=!0}),u)},s.can=function(f,u){var y,w=s.getConstructor(f),g;return w?(y=new w({required_caps:u}),g=y.mode,y.destroy(),!!g):!1},s.thatCan=function(f,u){var y=(u||s.order).split(/\s*,\s*/);for(var w in y)if(s.can(y[w],f))return y[w];return null},s.getMode=function(f,u,y){var w=null;if(i.typeOf(y)==="undefined"&&(y="browser"),u&&!i.isEmptyObj(f)){if(i.each(u,function(g,h){if(f.hasOwnProperty(h)){var v=f[h](g);if(typeof v=="string"&&(v=[v]),!w)w=v;else if(!(w=i.arrayIntersect(w,v)))return d.debug.runtime&&d.log("		%s: %s (conflicting mode requested: %s)",h,g,v),w=!1}d.debug.runtime&&d.log("		%s: %s (compatible modes: %s)",h,g,w)}),w)return i.inArray(y,w)!==-1?y:w[0];if(w===!1)return!1}return y},s.getGlobalEventTarget=function(){if(/^moxie\./.test(d.global_event_dispatcher)&&!d.can("access_global_ns")){var f=i.guid("moxie_event_target_");window[f]=function(u,y){c.instance.dispatchEvent(u,y)},d.global_event_dispatcher=f}return d.global_event_dispatcher},s.capTrue=function(){return!0},s.capFalse=function(){return!1},s.capTest=function(f){return function(){return!!f}},s}),p("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(d,i,a,c){return function(){var l;a.extend(this,{connectRuntime:function(s){var f=this,u;function y(w){var g,h;if(!w.length){f.trigger("RuntimeError",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR)),l=null;return}if(g=w.shift().toLowerCase(),h=c.getConstructor(g),!h){d.debug.runtime&&d.log("Constructor for '%s' runtime is not available.",g),y(w);return}if(d.debug.runtime&&(d.log("Trying runtime: %s",g),d.log(s)),l=new h(s),l.bind("Init",function(){l.initialized=!0,d.debug.runtime&&d.log("Runtime '%s' initialized",l.type),setTimeout(function(){l.clients++,f.ruid=l.uid,f.trigger("RuntimeInit",l)},1)}),l.bind("Error",function(){d.debug.runtime&&d.log("Runtime '%s' failed to initialize",l.type),l.destroy(),y(w)}),l.bind("Exception",function(v,_){var R=_.name+"(#"+_.code+")"+(_.message?", from: "+_.message:"");d.debug.runtime&&d.log("Runtime '%s' has thrown an exception: %s",this.type,R),f.trigger("RuntimeError",new i.RuntimeError(i.RuntimeError.EXCEPTION_ERR,R))}),d.debug.runtime&&d.log("	selected mode: %s",l.mode),!l.mode){l.trigger("Error");return}l.init()}if(a.typeOf(s)==="string"?u=s:a.typeOf(s.ruid)==="string"&&(u=s.ruid),u){if(l=c.getRuntime(u),l)return f.ruid=u,l.clients++,l;throw new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR)}y((s.runtime_order||c.order).split(/\s*,\s*/))},disconnectRuntime:function(){l&&--l.clients<=0&&l.destroy(),l=null},getRuntime:function(){return l&&l.uid?l:l=null},exec:function(){return l?l.exec.apply(this,arguments):null},can:function(s){return l?l.can(s):!1}})}}),p("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(d,i,a){var c={};function o(l,s){function f(u,y,w){var g,h=c[this.uid];return d.typeOf(h)!=="string"||!h.length?null:(g=new o(null,{type:w,size:y-u}),g.detach(h.substr(u,g.size)),g)}a.call(this),l&&this.connectRuntime(l),s?d.typeOf(s)==="string"&&(s={data:s}):s={},d.extend(this,{uid:s.uid||d.guid("uid_"),ruid:l,size:s.size||0,type:s.type||"",slice:function(u,y,w){return this.isDetached()?f.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),u,y,w)},getSource:function(){return c[this.uid]?c[this.uid]:null},detach:function(u){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),u=u||"",u.substr(0,5)=="data:"){var y=u.indexOf(";base64,");this.type=u.substring(5,y),u=i.atob(u.substring(y+8))}this.size=u.length,c[this.uid]=u},isDetached:function(){return!this.ruid&&d.typeOf(c[this.uid])==="string"},destroy:function(){this.detach(),delete c[this.uid]}}),s.data?this.detach(s.data):c[this.uid]=s}return o}),p("moxie/core/I18n",["moxie/core/utils/Basic"],function(d){var i={};return{addI18n:function(a){return d.extend(i,a)},translate:function(a){return i[a]||a},_:function(a){return this.translate(a)},sprintf:function(a){var c=[].slice.call(arguments,1);return a.replace(/%[a-z]/g,function(){var o=c.shift();return d.typeOf(o)!=="undefined"?o:""})}}}),p("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(d,i){var a="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb xlt xla,application/vnd.ms-powerpoint,ppt pps pot ppa,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",c={},o={},l=function(g){var h=g.split(/,/),v,_,R;for(v=0;v<h.length;v+=2){for(R=h[v+1].split(/ /),_=0;_<R.length;_++)c[R[_]]=h[v];o[h[v]]=R}},s=function(g,h){var v,_,R,S,O=[];for(_=0;_<g.length;_++)for(v=g[_].extensions.toLowerCase().split(/\s*,\s*/),R=0;R<v.length;R++){if(v[R]==="*")return[];if(S=O[v[R]],h&&/^\w+$/.test(v[R]))O.push("."+v[R]);else if(S&&d.inArray(S,O)===-1)O.push(S);else if(!S)return[]}return O},f=function(g){var h=[];return d.each(g,function(v){if(v=v.toLowerCase(),v==="*")return h=[],!1;var _=v.match(/^(\w+)\/(\*|\w+)$/);_&&(_[2]==="*"?d.each(o,function(R,S){new RegExp("^"+_[1]+"/").test(S)&&[].push.apply(h,o[S])}):o[v]&&[].push.apply(h,o[v]))}),h},u=function(g){var h=[],v=[];return d.typeOf(g)==="string"&&(g=d.trim(g).split(/\s*,\s*/)),v=f(g),h.push({title:i.translate("Files"),extensions:v.length?v.join(","):"*"}),h},y=function(g){var h=g&&g.match(/\.([^.]+)$/);return h?h[1].toLowerCase():""},w=function(g){return c[y(g)]||""};return l(a),{mimes:c,extensions:o,addMimeType:l,extList2mimes:s,mimes2exts:f,mimes2extList:u,getFileExtension:y,getFileMime:w}}),p("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(d,i,a,c,o,l,s,f,u){var y=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];function w(g){i.log("Instantiating FileInput...");var h,v,_;if(d.inArray(d.typeOf(g),["string","node"])!==-1&&(g={browse_button:g}),v=c.get(g.browse_button),!v)throw new o.DOMException(o.DOMException.NOT_FOUND_ERR);_={accept:[{title:s.translate("All Files"),extensions:"*"}],multiple:!1,required_caps:!1,container:v.parentNode||document.body},g=d.extend({},_,g),typeof g.required_caps=="string"&&(g.required_caps=f.parseCaps(g.required_caps)),typeof g.accept=="string"&&(g.accept=a.mimes2extList(g.accept)),h=c.get(g.container),h||(h=document.body),c.getStyle(h,"position")==="static"&&(h.style.position="relative"),h=v=null,u.call(this),d.extend(this,{uid:d.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){var R=this;R.bind("RuntimeInit",function(S,O){R.ruid=O.uid,R.shimid=O.shimid,R.bind("Ready",function(){R.trigger("Refresh")},999),R.bind("Refresh",function(){var P,I,T,C,D;T=c.get(g.browse_button),C=c.get(O.shimid),T&&(P=c.getPos(T,c.get(g.container)),I=c.getSize(T),D=parseInt(c.getStyle(T,"z-index"),10)||0,C&&d.extend(C.style,{top:P.y+"px",left:P.x+"px",width:I.w+"px",height:I.h+"px",zIndex:D+1})),C=T=null}),O.exec.call(R,"FileInput","init",g)}),R.connectRuntime(d.extend({},g,{required_caps:{select_file:!0}}))},getOption:function(R){return g[R]},setOption:function(R,S){if(g.hasOwnProperty(R)){var O=g[R];switch(R){case"accept":typeof S=="string"&&(S=a.mimes2extList(S));break;case"container":case"required_caps":throw new o.FileException(o.FileException.NO_MODIFICATION_ALLOWED_ERR)}g[R]=S,this.exec("FileInput","setOption",R,S),this.trigger("OptionChanged",R,S,O)}},disable:function(R){var S=this.getRuntime();S&&this.exec("FileInput","disable",d.typeOf(R)==="undefined"?!0:R)},refresh:function(){this.trigger("Refresh")},destroy:function(){var R=this.getRuntime();R&&(R.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),d.typeOf(this.files)==="array"&&d.each(this.files,function(S){S.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(y)}return w.prototype=l.instance,w}),p("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(d,i,a){function c(o,l){l||(l={}),a.apply(this,arguments),this.type||(this.type=i.getFileMime(l.name));var s;if(l.name)s=l.name.replace(/\\/g,"/"),s=s.substr(s.lastIndexOf("/")+1);else if(this.type){var f=this.type.split("/")[0];s=d.guid((f!==""?f:"file")+"_"),i.extensions[this.type]&&(s+="."+i.extensions[this.type][0])}d.extend(this,{name:s||d.guid("file_"),relativePath:"",lastModifiedDate:l.lastModifiedDate||new Date().toLocaleString()})}return c.prototype=a.prototype,c}),p("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/core/utils/Env","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(d,i,a,c,o,l,s,f,u){var y=["ready","dragenter","dragleave","drop","error"];function w(g){o.log("Instantiating FileDrop...");var h=this,v;typeof g=="string"&&(g={drop_zone:g}),v={accept:[{title:d.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},g=typeof g=="object"?c.extend({},v,g):v,g.container=i.get(g.drop_zone)||document.body,i.getStyle(g.container,"position")==="static"&&(g.container.style.position="relative"),typeof g.accept=="string"&&(g.accept=u.mimes2extList(g.accept)),s.call(h),c.extend(h,{uid:c.guid("uid_"),ruid:null,files:null,init:function(){h.bind("RuntimeInit",function(_,R){h.ruid=R.uid,R.exec.call(h,"FileDrop","init",g),h.dispatchEvent("ready")}),h.connectRuntime(g)},destroy:function(){var _=this.getRuntime();_&&(_.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(y)}return w.prototype=f.instance,w}),p("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/runtime/RuntimeClient"],function(d,i,a,c,o,l){var s=["loadstart","progress","load","abort","error","loadend"];function f(){l.call(this),d.extend(this,{uid:d.guid("uid_"),readyState:f.EMPTY,result:null,error:null,readAsBinaryString:function(y){u.call(this,"readAsBinaryString",y)},readAsDataURL:function(y){u.call(this,"readAsDataURL",y)},readAsText:function(y){u.call(this,"readAsText",y)},abort:function(){this.result=null,d.inArray(this.readyState,[f.EMPTY,f.DONE])===-1&&(this.readyState===f.LOADING&&(this.readyState=f.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(s),this.bind("Error",function(y,w){this.readyState=f.DONE,this.error=w},999),this.bind("Load",function(y){this.readyState=f.DONE},999);function u(y,w){if(this.trigger("loadstart"),this.readyState===f.LOADING){this.trigger("error",new a.DOMException(a.DOMException.INVALID_STATE_ERR)),this.trigger("loadend");return}if(!(w instanceof o)){this.trigger("error",new a.DOMException(a.DOMException.NOT_FOUND_ERR)),this.trigger("loadend");return}if(this.result=null,this.readyState=f.LOADING,w.isDetached()){var g=w.getSource();switch(y){case"readAsText":case"readAsBinaryString":this.result=g;break;case"readAsDataURL":this.result="data:"+w.type+";base64,"+i.btoa(g);break}this.readyState=f.DONE,this.trigger("load"),this.trigger("loadend")}else this.connectRuntime(w.ruid),this.exec("FileReader","read",y,w)}}return f.EMPTY=0,f.LOADING=1,f.DONE=2,f.prototype=c.instance,f}),p("moxie/core/utils/Url",["moxie/core/utils/Basic"],function(d){var i=function(o,l){var s=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],f=s.length,u={http:80,https:443},y={},w=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[\da-fA-F:]+\]|[^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,g=w.exec(o||""),h,v=/^\/\/\w/.test(o);switch(d.typeOf(l)){case"undefined":l=i(document.location.href,!1);break;case"string":l=i(l,!1);break}for(;f--;)g[f]&&(y[s[f]]=g[f]);if(h=!v&&!y.scheme,(v||h)&&(y.scheme=l.scheme),h){y.host=l.host,y.port=l.port;var _="";/^[^\/]/.test(y.path)&&(_=l.path,/\/[^\/]*\.[^\/]*$/.test(_)?_=_.replace(/\/[^\/]+$/,"/"):_=_.replace(/\/?$/,"/")),y.path=_+(y.path||"")}return y.port||(y.port=u[y.scheme]||80),y.port=parseInt(y.port,10),y.path||(y.path="/"),delete y.source,y},a=function(o){var l={http:80,https:443},s=typeof o=="object"?o:i(o);return s.scheme+"://"+s.host+(s.port!==l[s.scheme]?":"+s.port:"")+s.path+(s.query?s.query:"")},c=function(o){function l(s){return[s.scheme,s.host,s.port].join("/")}return typeof o=="string"&&(o=i(o)),l(i())===l(o)};return{parseUrl:i,resolveUrl:a,hasSameOrigin:c}}),p("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(d,i,a){function c(){this.uid=d.guid("uid_"),i.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return c.prototype=a.instance,c}),p("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(d,i,a){return function(){i.call(this),d.extend(this,{uid:d.guid("uid_"),readAsBinaryString:function(o){return c.call(this,"readAsBinaryString",o)},readAsDataURL:function(o){return c.call(this,"readAsDataURL",o)},readAsText:function(o){return c.call(this,"readAsText",o)}});function c(o,l){if(l.isDetached()){var s=l.getSource();switch(o){case"readAsBinaryString":return s;case"readAsDataURL":return"data:"+l.type+";base64,"+a.btoa(s);case"readAsText":for(var f="",u=0,y=s.length;u<y;u++)f+=String.fromCharCode(s[u]);return f}}else{var w=this.connectRuntime(l.ruid).exec.call(this,"FileReaderSync","read",o,l);return this.disconnectRuntime(),w}}}}),p("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(d,i,a){function c(){var o,l=[];i.extend(this,{append:function(s,f){var u=this,y=i.typeOf(f);f instanceof a?o={name:s,value:f}:y==="array"?(s+="[]",i.each(f,function(w){u.append(s,w)})):y==="object"?i.each(f,function(w,g){u.append(s+"["+g+"]",w)}):y==="null"||y==="undefined"||y==="number"&&isNaN(f)?u.append(s,"false"):l.push({name:s,value:f.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return o&&o.value||null},getBlobName:function(){return o&&o.name||null},each:function(s){i.each(l,function(f){s(f.value,f.name)}),o&&s(o.value,o.name)},destroy:function(){o=null,l=[]}})}return c}),p("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(d,i,a,c,o,l,s,f,u,y,w,g){var h={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};function v(){this.uid=d.guid("uid_")}v.prototype=a.instance;var _=["loadstart","progress","abort","error","load","timeout","loadend"];function R(){var S=this,O={timeout:0,readyState:R.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},P=!0,I,T,C={},D,L,F=null,q=null,W=!1,z=!1,G=!1,A=!1,N=!1,U=!1,B={},j,te="",X;d.extend(this,O,{uid:d.guid("uid_"),upload:new v,open:function(H,V,Z,ie,se){var ee;if(!H||!V)throw new i.DOMException(i.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(H)||c.utf8_encode(H)!==H)throw new i.DOMException(i.DOMException.SYNTAX_ERR);if(~d.inArray(H.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(T=H.toUpperCase()),~d.inArray(T,["CONNECT","TRACE","TRACK"]))throw new i.DOMException(i.DOMException.SECURITY_ERR);if(V=c.utf8_encode(V),ee=o.parseUrl(V),U=o.hasSameOrigin(ee),I=o.resolveUrl(V),(ie||se)&&!U)throw new i.DOMException(i.DOMException.INVALID_ACCESS_ERR);if(D=ie||ee.user,L=se||ee.pass,P=Z||!0,P===!1&&(M("timeout")||M("withCredentials")||M("responseType")!==""))throw new i.DOMException(i.DOMException.INVALID_ACCESS_ERR);W=!P,z=!1,C={},ne.call(this),M("readyState",R.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(H,V){var Z=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(M("readyState")!==R.OPENED||z)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(H)||c.utf8_encode(H)!==H)throw new i.DOMException(i.DOMException.SYNTAX_ERR);return H=d.trim(H).toLowerCase(),~d.inArray(H,Z)||/^(proxy\-|sec\-)/.test(H)?!1:(C[H]?C[H]+=", "+V:C[H]=V,!0)},hasRequestHeader:function(H){return H&&C[H.toLowerCase()]||!1},getAllResponseHeaders:function(){return te||""},getResponseHeader:function(H){return H=H.toLowerCase(),N||~d.inArray(H,["set-cookie","set-cookie2"])?null:te&&te!==""&&(X||(X={},d.each(te.split(/\r\n/),function(V){var Z=V.split(/:\s+/);Z.length===2&&(Z[0]=d.trim(Z[0]),X[Z[0].toLowerCase()]={header:Z[0],value:d.trim(Z[1])})})),X.hasOwnProperty(H))?X[H].header+": "+X[H].value:null},overrideMimeType:function(H){var V;if(~d.inArray(M("readyState"),[R.LOADING,R.DONE]))throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(H=d.trim(H.toLowerCase()),/;/.test(H)&&(V=H.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(H=V[1],V[2]&&V[2]),!g.mimes[H])throw new i.DOMException(i.DOMException.SYNTAX_ERR)},send:function(H,V){if(d.typeOf(V)==="string"?B={ruid:V}:V?B=V:B={},this.readyState!==R.OPENED||z)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(H instanceof f)B.ruid=H.ruid,q=H.type||"application/octet-stream";else if(H instanceof y){if(H.hasBlob()){var Z=H.getBlob();B.ruid=Z.ruid,q=Z.type||"application/octet-stream"}}else typeof H=="string"&&(F="UTF-8",q="text/plain;charset=UTF-8",H=c.utf8_encode(H));this.withCredentials||(this.withCredentials=B.required_caps&&B.required_caps.send_browser_cookies&&!U),G=!W&&this.upload.hasEventListener(),N=!1,A=!H,W||(z=!0),J.call(this,H)},abort:function(){if(N=!0,W=!1,~d.inArray(M("readyState"),[R.UNSENT,R.OPENED,R.DONE]))M("readyState",R.UNSENT);else{if(M("readyState",R.DONE),z=!1,j)j.getRuntime().exec.call(j,"XMLHttpRequest","abort",A);else throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);A=!0}},destroy:function(){j&&(d.typeOf(j.destroy)==="function"&&j.destroy(),j=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(_.concat(["readystatechange"])),this.upload.handleEventProps(_);function M(H,V){if(O.hasOwnProperty(H)){if(arguments.length===1)return w.can("define_property")?O[H]:S[H];w.can("define_property")?O[H]=V:S[H]=V}}function J(H){var V=this;new Date().getTime(),j=new s;function Z(){j&&(j.destroy(),j=null),V.dispatchEvent("loadend"),V=null}function ie(se){j.bind("LoadStart",function(ee){M("readyState",R.LOADING),V.dispatchEvent("readystatechange"),V.dispatchEvent(ee),G&&V.upload.dispatchEvent(ee)}),j.bind("Progress",function(ee){M("readyState")!==R.LOADING&&(M("readyState",R.LOADING),V.dispatchEvent("readystatechange")),V.dispatchEvent(ee)}),j.bind("UploadProgress",function(ee){G&&V.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:ee.total,loaded:ee.loaded})}),j.bind("Load",function(ee){M("readyState",R.DONE),M("status",Number(se.exec.call(j,"XMLHttpRequest","getStatus")||0)),M("statusText",h[M("status")]||""),M("response",se.exec.call(j,"XMLHttpRequest","getResponse",M("responseType"))),~d.inArray(M("responseType"),["text",""])?M("responseText",M("response")):M("responseType")==="document"&&M("responseXML",M("response")),te=se.exec.call(j,"XMLHttpRequest","getAllResponseHeaders"),V.dispatchEvent("readystatechange"),M("status")>0?(G&&V.upload.dispatchEvent(ee),V.dispatchEvent(ee)):(N=!0,V.dispatchEvent("error")),Z()}),j.bind("Abort",function(ee){V.dispatchEvent(ee),Z()}),j.bind("Error",function(ee){N=!0,M("readyState",R.DONE),V.dispatchEvent("readystatechange"),A=!0,V.dispatchEvent(ee),Z()}),se.exec.call(j,"XMLHttpRequest","send",{url:I,method:T,async:P,user:D,password:L,headers:C,mimeType:q,encoding:F,responseType:V.responseType,withCredentials:V.withCredentials,options:B},H)}typeof B.required_caps=="string"&&(B.required_caps=l.parseCaps(B.required_caps)),B.required_caps=d.extend({},B.required_caps,{return_response_type:V.responseType}),H instanceof y&&(B.required_caps.send_multipart=!0),d.isEmptyObj(C)||(B.required_caps.send_custom_headers=!0),U||(B.required_caps.do_cors=!0),B.ruid?ie(j.connectRuntime(B)):(j.bind("RuntimeInit",function(se,ee){ie(ee)}),j.bind("RuntimeError",function(se,ee){V.dispatchEvent("RuntimeError",ee)}),j.connectRuntime(B))}function ne(){M("responseText",""),M("responseXML",null),M("response",null),M("status",0),M("statusText","")}}return R.UNSENT=0,R.OPENED=1,R.HEADERS_RECEIVED=2,R.LOADING=3,R.DONE=4,R.prototype=a.instance,R}),p("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(d,i,a,c){function o(){var l,s,f,u,y,w;a.call(this),d.extend(this,{uid:d.guid("uid_"),state:o.IDLE,result:null,transport:function(_,R,S){var O=this;if(S=d.extend({chunk_size:204798},S),(l=S.chunk_size%3)&&(S.chunk_size+=3-l),w=S.chunk_size,g.call(this),f=_,u=_.length,d.typeOf(S)==="string"||S.ruid)h.call(O,R,this.connectRuntime(S));else{var P=function(I,T){O.unbind("RuntimeInit",P),h.call(O,R,T)};this.bind("RuntimeInit",P),this.connectRuntime(S)}},abort:function(){var _=this;_.state=o.IDLE,s&&(s.exec.call(_,"Transporter","clear"),_.trigger("TransportingAborted")),g.call(_)},destroy:function(){this.unbindAll(),s=null,this.disconnectRuntime(),g.call(this)}});function g(){u=y=0,f=this.result=null}function h(_,R){var S=this;s=R,S.bind("TransportingProgress",function(O){y=O.loaded,y<u&&d.inArray(S.state,[o.IDLE,o.DONE])===-1&&v.call(S)},999),S.bind("TransportingComplete",function(){y=u,S.state=o.DONE,f=null,S.result=s.exec.call(S,"Transporter","getAsBlob",_||"")},999),S.state=o.BUSY,S.trigger("TransportingStarted"),v.call(S)}function v(){var _=this,R,S=u-y;w>S&&(w=S),R=i.btoa(f.substr(y,w)),s.exec.call(_,"Transporter","receive",R,u)}}return o.IDLE=0,o.BUSY=1,o.DONE=2,o.prototype=c.instance,o}),p("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(d,i,a,c,o,l,s,f,u,y,w,g,h){var v=["progress","load","error","resize","embedded"];function _(){s.call(this),d.extend(this,{uid:d.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){S.apply(this,arguments)},resize:function(T){var C=this,D,L,F={x:0,y:0,width:C.width,height:C.height},q=d.extendIf({width:C.width,height:C.height,type:C.type||"image/jpeg",quality:90,crop:!1,fit:!0,preserveHeaders:!0,resample:"default",multipass:!0},T);try{if(!C.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);if(C.width>_.MAX_RESIZE_WIDTH||C.height>_.MAX_RESIZE_HEIGHT)throw new a.ImageError(a.ImageError.MAX_RESOLUTION_ERR);if(D=C.meta&&C.meta.tiff&&C.meta.tiff.Orientation||1,d.inArray(D,[5,6,7,8])!==-1){var W=q.width;q.width=q.height,q.height=W}if(q.crop){switch(L=Math.max(q.width/C.width,q.height/C.height),T.fit?(F.width=Math.min(Math.ceil(q.width/L),C.width),F.height=Math.min(Math.ceil(q.height/L),C.height),L=q.width/F.width):(F.width=Math.min(q.width,C.width),F.height=Math.min(q.height,C.height),L=1),typeof q.crop=="boolean"&&(q.crop="cc"),q.crop.toLowerCase().replace(/_/,"-")){case"rb":case"right-bottom":F.x=C.width-F.width,F.y=C.height-F.height;break;case"cb":case"center-bottom":F.x=Math.floor((C.width-F.width)/2),F.y=C.height-F.height;break;case"lb":case"left-bottom":F.x=0,F.y=C.height-F.height;break;case"lt":case"left-top":F.x=0,F.y=0;break;case"ct":case"center-top":F.x=Math.floor((C.width-F.width)/2),F.y=0;break;case"rt":case"right-top":F.x=C.width-F.width,F.y=0;break;case"rc":case"right-center":case"right-middle":F.x=C.width-F.width,F.y=Math.floor((C.height-F.height)/2);break;case"lc":case"left-center":case"left-middle":F.x=0,F.y=Math.floor((C.height-F.height)/2);break;case"cc":case"center-center":case"center-middle":default:F.x=Math.floor((C.width-F.width)/2),F.y=Math.floor((C.height-F.height)/2)}F.x=Math.max(F.x,0),F.y=Math.max(F.y,0)}else L=Math.min(q.width/C.width,q.height/C.height),L>1&&!q.fit&&(L=1);this.exec("Image","resize",F,L,q)}catch(z){C.trigger("error",z.code)}},downsize:function(T){var C={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,fit:!1,preserveHeaders:!0,resample:"default"},D;typeof T=="object"?D=d.extend(C,T):D=d.extend(C,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]}),this.resize(D)},crop:function(T,C,D){this.downsize(T,C,!0,D)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);return this.exec("Image","getAsCanvas")},getAsBlob:function(T,C){if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsBlob",T||"image/jpeg",C||90)},getAsDataURL:function(T,C){if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",T||"image/jpeg",C||90)},getAsBinaryString:function(T,C){var D=this.getAsDataURL(T,C);return h.atob(D.substring(D.indexOf("base64,")+7))},embed:function(T,C){var D=this,L,F=d.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,fit:!0,resample:"nearest"},C);function q(z,G){var A=this;if(u.can("create_canvas")){var N=A.getAsCanvas();if(N){T.appendChild(N),N=null,A.destroy(),D.trigger("embedded");return}}var U=A.getAsDataURL(z,G);if(!U)throw new a.ImageError(a.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",U.length))T.innerHTML='<img src="'+U+'" width="'+A.width+'" height="'+A.height+'" alt="" />',A.destroy(),D.trigger("embedded");else{var B=new f;B.bind("TransportingComplete",function(){L=D.connectRuntime(this.result.ruid),D.bind("Embedded",function(){d.extend(L.getShimContainer().style,{top:"0px",left:"0px",width:A.width+"px",height:A.height+"px"}),L=null},999),L.exec.call(D,"ImageView","display",this.result.uid,width,height),A.destroy()}),B.transport(h.atob(U.substring(U.indexOf("base64,")+7)),z,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:T})}}try{if(!(T=i.get(T)))throw new a.DOMException(a.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);this.width>_.MAX_RESIZE_WIDTH||this.height>_.MAX_RESIZE_HEIGHT;var W=new _;return W.bind("Resize",function(){q.call(this,F.type,F.quality)}),W.bind("Load",function(){this.downsize(F)}),this.meta.thumb&&this.meta.thumb.width>=F.width&&this.meta.thumb.height>=F.height?W.load(this.meta.thumb.data):W.clone(this,!1),W}catch(z){this.trigger("error",z.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.meta&&this.meta.thumb&&this.meta.thumb.data.destroy(),this.unbindAll()}}),this.handleEventProps(v),this.bind("Load Resize",function(){return R.call(this)},999);function R(T){try{return T||(T=this.exec("Image","getInfo")),this.size=T.size,this.width=T.width,this.height=T.height,this.type=T.type,this.meta=T.meta,this.name===""&&(this.name=T.name),!0}catch(C){return this.trigger("error",C.code),!1}}function S(T){var C=d.typeOf(T);try{if(T instanceof _){if(!T.size)throw new a.DOMException(a.DOMException.INVALID_STATE_ERR);O.apply(this,arguments)}else if(T instanceof w){if(!~d.inArray(T.type,["image/jpeg","image/png"]))throw new a.ImageError(a.ImageError.WRONG_FORMAT);P.apply(this,arguments)}else if(d.inArray(C,["blob","file"])!==-1)S.call(this,new g(null,T),arguments[1]);else if(C==="string")T.substr(0,5)==="data:"?S.call(this,new w(null,{data:T}),arguments[1]):I.apply(this,arguments);else if(C==="node"&&T.nodeName.toLowerCase()==="img")S.call(this,T.src,arguments[1]);else throw new a.DOMException(a.DOMException.TYPE_MISMATCH_ERR)}catch(D){this.trigger("error",D.code)}}function O(T,C){var D=this.connectRuntime(T.ruid);this.ruid=D.uid,D.exec.call(this,"Image","loadFromImage",T,d.typeOf(C)==="undefined"?!0:C)}function P(T,C){var D=this;D.name=T.name||"";function L(F){D.ruid=F.uid,F.exec.call(D,"Image","loadFromBlob",T)}T.isDetached()?(this.bind("RuntimeInit",function(F,q){L(q)}),C&&typeof C.required_caps=="string"&&(C.required_caps=l.parseCaps(C.required_caps)),this.connectRuntime(d.extend({required_caps:{access_image_binary:!0,resize_image:!0}},C))):L(this.connectRuntime(T.ruid))}function I(T,C){var D=this,L;L=new o,L.open("get",T),L.responseType="blob",L.onprogress=function(F){D.trigger(F)},L.onload=function(){P.call(D,L.response,!0)},L.onerror=function(F){D.trigger(F)},L.onloadend=function(){L.destroy()},L.bind("RuntimeError",function(F,q){D.trigger("RuntimeError",q)}),L.send(null,C)}}return _.MAX_RESIZE_WIDTH=8192,_.MAX_RESIZE_HEIGHT=8192,_.prototype=y.instance,_}),p("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(d,i,a,c){var o="html5",l={};function s(f){var u=this,y=a.capTest,w=a.capTrue,g=d.extend({access_binary:y(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return u.can("access_binary")&&!!l.Image},display_media:y((c.can("create_canvas")||c.can("use_data_uri_over32kb"))&&b("moxie/image/Image")),do_cors:y(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:y(function(){var h=document.createElement("div");return("draggable"in h||"ondragstart"in h&&"ondrop"in h)&&(c.browser!=="IE"||c.verComp(c.version,9,">"))}()),filter_by_extension:y(function(){return!(c.browser==="Chrome"&&c.verComp(c.version,28,"<")||c.browser==="IE"&&c.verComp(c.version,10,"<")||c.browser==="Safari"&&c.verComp(c.version,7,"<")||c.browser==="Firefox"&&c.verComp(c.version,37,"<"))}()),return_response_headers:w,return_response_type:function(h){return h==="json"&&window.JSON?!0:c.can("return_response_type",h)},return_status_code:w,report_upload_progress:y(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return u.can("access_binary")&&c.can("create_canvas")},select_file:function(){return c.can("use_fileinput")&&window.File},select_folder:function(){return u.can("select_file")&&(c.browser==="Chrome"&&c.verComp(c.version,21,">=")||c.browser==="Firefox"&&c.verComp(c.version,42,">="))},select_multiple:function(){return u.can("select_file")&&!(c.browser==="Safari"&&c.os==="Windows")&&!(c.os==="iOS"&&c.verComp(c.osVersion,"7.0.0",">")&&c.verComp(c.osVersion,"8.0.0","<"))},send_binary_string:y(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:y(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||u.can("send_binary_string")},slice_blob:y(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return u.can("slice_blob")&&u.can("send_multipart")},summon_file_dialog:function(){return u.can("select_file")&&!(c.browser==="Firefox"&&c.verComp(c.version,4,"<")||c.browser==="Opera"&&c.verComp(c.version,12,"<")||c.browser==="IE"&&c.verComp(c.version,10,"<"))},upload_filesize:w,use_http_method:w},arguments[2]);a.call(this,f,arguments[1]||o,g),d.extend(this,{init:function(){this.trigger("Init")},destroy:function(h){return function(){h.call(u),h=u=null}}(this.destroy)}),d.extend(this.getShim(),l)}return a.addConstructor(o,s),l}),p("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(d,i){function a(){function c(o,l,s){var f;if(window.File.prototype.slice)try{return o.slice(),o.slice(l,s)}catch{return o.slice(l,s-l)}else return(f=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?f.call(o,l,s):null}this.slice=function(){return new i(this.getRuntime().uid,c.apply(this,arguments))},this.destroy=function(){this.getRuntime().getShim().removeInstance(this.uid)}}return d.Blob=a}),p("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(d){var i={},a="moxie_"+d.guid();function c(){this.returnValue=!1}function o(){this.cancelBubble=!0}var l=function(u,y,w,g){var h,v;y=y.toLowerCase(),u.addEventListener?(h=w,u.addEventListener(y,h,!1)):u.attachEvent&&(h=function(){var _=window.event;_.target||(_.target=_.srcElement),_.preventDefault=c,_.stopPropagation=o,w(_)},u.attachEvent("on"+y,h)),u[a]||(u[a]=d.guid()),i.hasOwnProperty(u[a])||(i[u[a]]={}),v=i[u[a]],v.hasOwnProperty(y)||(v[y]=[]),v[y].push({func:h,orig:w,key:g})},s=function(u,y,w){var g,h;if(y=y.toLowerCase(),u[a]&&i[u[a]]&&i[u[a]][y])g=i[u[a]][y];else return;for(var v=g.length-1;v>=0&&!((g[v].orig===w||g[v].key===w)&&(u.removeEventListener?u.removeEventListener(y,g[v].func,!1):u.detachEvent&&u.detachEvent("on"+y,g[v].func),g[v].orig=null,g[v].func=null,g.splice(v,1),w!==h));v--);if(g.length||delete i[u[a]][y],d.isEmptyObj(i[u[a]])){delete i[u[a]];try{delete u[a]}catch{u[a]=h}}},f=function(u,y){!u||!u[a]||d.each(i[u[a]],function(w,g){s(u,g,y)})};return{addEvent:l,removeEvent:s,removeAllEvents:f}}),p("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(d,i,a,c,o,l,s){function f(){var u,y;a.extend(this,{init:function(w){var g=this,h=g.getRuntime(),v,_,R,S,O,P;u=w,R=l.extList2mimes(u.accept,h.can("filter_by_extension")),_=h.getShimContainer(),_.innerHTML='<input id="'+h.uid+'" type="file" style="font-size:999px;opacity:0;"'+(u.multiple&&h.can("select_multiple")?"multiple":"")+(u.directory&&h.can("select_folder")?"webkitdirectory directory":"")+(R?' accept="'+R.join(",")+'"':"")+" />",v=c.get(h.uid),a.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),S=c.get(u.browse_button),y=c.getStyle(S,"z-index")||"auto",h.can("summon_file_dialog")&&(c.getStyle(S,"position")==="static"&&(S.style.position="relative"),o.addEvent(S,"click",function(I){var T=c.get(h.uid);T&&!T.disabled&&T.click(),I.preventDefault()},g.uid),g.bind("Refresh",function(){O=parseInt(y,10)||1,c.get(u.browse_button).style.zIndex=O,this.getRuntime().getShimContainer().style.zIndex=O-1})),P=h.can("summon_file_dialog")?S:_,o.addEvent(P,"mouseover",function(){g.trigger("mouseenter")},g.uid),o.addEvent(P,"mouseout",function(){g.trigger("mouseleave")},g.uid),o.addEvent(P,"mousedown",function(){g.trigger("mousedown")},g.uid),o.addEvent(c.get(u.container),"mouseup",function(){g.trigger("mouseup")},g.uid),(h.can("summon_file_dialog")?v:S).setAttribute("tabindex",-1),v.onchange=function I(){if(g.files=[],a.each(this.files,function(C){var D="";if(u.directory&&C.name==".")return!0;C.webkitRelativePath&&(D="/"+C.webkitRelativePath.replace(/^\//,"")),C=new i(h.uid,C),C.relativePath=D,g.files.push(C)}),s.browser!=="IE"&&s.browser!=="IEMobile")this.value="";else{var T=this.cloneNode(!0);this.parentNode.replaceChild(T,this),T.onchange=I}g.files.length&&g.trigger("change")},g.trigger({type:"ready",async:!0}),_=null},setOption:function(w,g){var h=this.getRuntime(),v=c.get(h.uid);switch(w){case"accept":if(g){var _=g.mimes||l.extList2mimes(g,h.can("filter_by_extension"));v.setAttribute("accept",_.join(","))}else v.removeAttribute("accept");break;case"directory":g&&h.can("select_folder")?(v.setAttribute("directory",""),v.setAttribute("webkitdirectory","")):(v.removeAttribute("directory"),v.removeAttribute("webkitdirectory"));break;case"multiple":g&&h.can("select_multiple")?v.setAttribute("multiple",""):v.removeAttribute("multiple")}},disable:function(w){var g=this.getRuntime(),h;(h=c.get(g.uid))&&(h.disabled=!!w)},destroy:function(){var w=this.getRuntime(),g=w.getShim(),h=w.getShimContainer(),v=u&&c.get(u.container),_=u&&c.get(u.browse_button);v&&o.removeAllEvents(v,this.uid),_&&(o.removeAllEvents(_,this.uid),_.style.zIndex=y),h&&(o.removeAllEvents(h,this.uid),h.innerHTML=""),g.removeInstance(this.uid),u=h=v=_=g=null}})}return d.FileInput=f}),p("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(d,i,a,c,o,l){function s(){var f=[],u=[],y,w;a.extend(this,{init:function(I){var T=this,C;y=I,w=T.ruid,u=v(y.accept),C=y.container,o.addEvent(C,"dragover",function(D){g(D)&&(D.preventDefault(),D.dataTransfer.dropEffect="copy")},T.uid),o.addEvent(C,"drop",function(D){g(D)&&(D.preventDefault(),f=[],D.dataTransfer.items&&D.dataTransfer.items[0].webkitGetAsEntry?R(D.dataTransfer.items,function(){T.files=f,T.trigger("drop")}):(a.each(D.dataTransfer.files,function(L){h(L)}),T.files=f,T.trigger("drop")))},T.uid),o.addEvent(C,"dragenter",function(D){T.trigger("dragenter")},T.uid),o.addEvent(C,"dragleave",function(D){T.trigger("dragleave")},T.uid)},destroy:function(){o.removeAllEvents(y&&c.get(y.container),this.uid),w=f=u=y=null,this.getRuntime().getShim().removeInstance(this.uid)}});function g(I){if(!I.dataTransfer||!I.dataTransfer.types)return!1;var T=a.toArray(I.dataTransfer.types||[]);return a.inArray("Files",T)!==-1||a.inArray("public.file-url",T)!==-1||a.inArray("application/x-moz-file",T)!==-1}function h(I,T){if(_(I)){var C=new i(w,I);C.relativePath=T||"",f.push(C)}}function v(I){for(var T=[],C=0;C<I.length;C++)[].push.apply(T,I[C].extensions.split(/\s*,\s*/));return a.inArray("*",T)===-1?T:[]}function _(I){if(!u.length)return!0;var T=l.getFileExtension(I.name);return!T||a.inArray(T,u)!==-1}function R(I,T){var C=[];a.each(I,function(D){var L=D.webkitGetAsEntry();L&&(L.isFile?h(D.getAsFile(),L.fullPath):C.push(L))}),C.length?S(C,T):T()}function S(I,T){var C=[];a.each(I,function(D){C.push(function(L){O(D,L)})}),a.inSeries(C,function(){T()})}function O(I,T){I.isFile?I.file(function(C){h(C,I.fullPath),T()},function(){T()}):I.isDirectory?P(I,T):T()}function P(I,T){var C=[],D=I.createReader();function L(F){D.readEntries(function(q){q.length?([].push.apply(C,q),L(F)):F()},F)}L(function(){S(C,T)})}}return d.FileDrop=s}),p("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(d,i,a){function c(){var o,l=!1;a.extend(this,{read:function(f,u){var y=this;y.result="",o=new window.FileReader,o.addEventListener("progress",function(w){y.trigger(w)}),o.addEventListener("load",function(w){y.result=l?s(o.result):o.result,y.trigger(w)}),o.addEventListener("error",function(w){y.trigger(w,o.error)}),o.addEventListener("loadend",function(w){o=null,y.trigger(w)}),a.typeOf(o[f])==="function"?(l=!1,o[f](u.getSource())):f==="readAsBinaryString"&&(l=!0,o.readAsDataURL(u.getSource()))},abort:function(){o&&o.abort()},destroy:function(){o=null,this.getRuntime().getShim().removeInstance(this.uid)}});function s(f){return i.atob(f.substring(f.indexOf("base64,")+7))}}return d.FileReader=c}),p("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(d,i,a,c,o,l,s,f,u){function y(){var w=this,g,h;i.extend(this,{send:function(O,P){var I=this,T=u.browser==="Mozilla"&&u.verComp(u.version,4,">=")&&u.verComp(u.version,7,"<"),C=u.browser==="Android Browser",D=!1;if(h=O.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),g=_(),g.open(O.method,O.url,O.async,O.user,O.password),P instanceof l)P.isDetached()&&(D=!0),P=P.getSource();else if(P instanceof s){if(P.hasBlob()){if(P.getBlob().isDetached())P=S.call(I,P),D=!0;else if((T||C)&&i.typeOf(P.getBlob().getSource())==="blob"&&window.FileReader){v.call(I,O,P);return}}if(P instanceof s){var L=new window.FormData;P.each(function(F,q){F instanceof l?L.append(q,F.getSource()):L.append(q,F)}),P=L}}g.upload?(O.withCredentials&&(g.withCredentials=!0),g.addEventListener("load",function(F){I.trigger(F)}),g.addEventListener("error",function(F){I.trigger(F)}),g.addEventListener("progress",function(F){I.trigger(F)}),g.upload.addEventListener("progress",function(F){I.trigger({type:"UploadProgress",loaded:F.loaded,total:F.total})})):g.onreadystatechange=function(){switch(g.readyState){case 1:break;case 2:break;case 3:var q,W;try{c.hasSameOrigin(O.url)&&(q=g.getResponseHeader("Content-Length")||0),g.responseText&&(W=g.responseText.length)}catch{q=W=0}I.trigger({type:"progress",lengthComputable:!!q,total:parseInt(q,10),loaded:W});break;case 4:g.onreadystatechange=function(){};try{if(g.status>=200&&g.status<400){I.trigger("load");break}}catch{}I.trigger("error");break}},i.isEmptyObj(O.headers)||i.each(O.headers,function(F,q){g.setRequestHeader(q,F)}),O.responseType!==""&&"responseType"in g&&(O.responseType==="json"&&!u.can("return_response_type","json")?g.responseType="text":g.responseType=O.responseType),D?g.sendAsBinary?g.sendAsBinary(P):function(){for(var F=new Uint8Array(P.length),q=0;q<P.length;q++)F[q]=P.charCodeAt(q)&255;g.send(F.buffer)}():g.send(P),I.trigger("loadstart")},getStatus:function(){try{if(g)return g.status}catch{}return 0},getResponse:function(O){var P=this.getRuntime();try{switch(O){case"blob":var I=new o(P.uid,g.response),T=g.getResponseHeader("Content-Disposition");if(T){var C=T.match(/filename=([\'\"'])([^\1]+)\1/);C&&(h=C[2])}return I.name=h,I.type||(I.type=a.getFileMime(h)),I;case"json":return u.can("return_response_type","json")?g.response:g.status===200&&window.JSON?JSON.parse(g.responseText):null;case"document":return R(g);default:return g.responseText!==""?g.responseText:null}}catch{return null}},getAllResponseHeaders:function(){try{return g.getAllResponseHeaders()}catch{}return""},abort:function(){g&&g.abort()},destroy:function(){w=h=null,this.getRuntime().getShim().removeInstance(this.uid)}});function v(O,P){var I=this,T,C;T=P.getBlob().getSource(),C=new window.FileReader,C.onload=function(){P.append(P.getBlobName(),new l(null,{type:T.type,data:C.result})),w.send.call(I,O,P)},C.readAsBinaryString(T)}function _(){return window.XMLHttpRequest&&!(u.browser==="IE"&&u.verComp(u.version,8,"<"))?new window.XMLHttpRequest:function(){for(var O=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],P=0;P<O.length;P++)try{return new ActiveXObject(O[P])}catch{}}()}function R(O){var P=O.responseXML,I=O.responseText;return u.browser==="IE"&&I&&P&&!P.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(O.getResponseHeader("Content-Type"))&&(P=new window.ActiveXObject("Microsoft.XMLDOM"),P.async=!1,P.validateOnParse=!1,P.loadXML(I)),P&&(u.browser==="IE"&&P.parseError!==0||!P.documentElement||P.documentElement.tagName==="parsererror")?null:P}function S(O){var P="----moxieboundary"+new Date().getTime(),I="--",T=`\r
`,C="",D=this.getRuntime();if(!D.can("send_binary_string"))throw new f.RuntimeError(f.RuntimeError.NOT_SUPPORTED_ERR);return g.setRequestHeader("Content-Type","multipart/form-data; boundary="+P),O.each(function(L,F){L instanceof l?C+=I+P+T+'Content-Disposition: form-data; name="'+F+'"; filename="'+unescape(encodeURIComponent(L.name||"blob"))+'"'+T+"Content-Type: "+(L.type||"application/octet-stream")+T+T+L.getSource()+T:C+=I+P+T+'Content-Disposition: form-data; name="'+F+'"'+T+T+unescape(encodeURIComponent(L))+T}),C+=I+P+I+T,C}}return d.XMLHttpRequest=y}),p("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(d){function i(o){o instanceof ArrayBuffer?a.apply(this,arguments):c.apply(this,arguments)}d.extend(i.prototype,{littleEndian:!1,read:function(o,l){var s,f,u;if(o+l>this.length())throw new Error("You are trying to read outside the source boundaries.");for(f=this.littleEndian?0:-8*(l-1),u=0,s=0;u<l;u++)s|=this.readByteAt(o+u)<<Math.abs(f+u*8);return s},write:function(o,l,s){var f,u;if(o>this.length())throw new Error("You are trying to write outside the source boundaries.");for(f=this.littleEndian?0:-8*(s-1),u=0;u<s;u++)this.writeByteAt(o+u,l>>Math.abs(f+u*8)&255)},BYTE:function(o){return this.read(o,1)},SHORT:function(o){return this.read(o,2)},LONG:function(o){return this.read(o,4)},SLONG:function(o){var l=this.read(o,4);return l>2147483647?l-4294967296:l},CHAR:function(o){return String.fromCharCode(this.read(o,1))},STRING:function(o,l){return this.asArray("CHAR",o,l).join("")},asArray:function(o,l,s){for(var f=[],u=0;u<s;u++)f[u]=this[o](l+u);return f}});function a(o){var l=new DataView(o);d.extend(this,{readByteAt:function(s){return l.getUint8(s)},writeByteAt:function(s,f){l.setUint8(s,f)},SEGMENT:function(s,f,u){switch(arguments.length){case 2:return o.slice(s,s+f);case 1:return o.slice(s);case 3:if(u===null&&(u=new ArrayBuffer),u instanceof ArrayBuffer){var y=new Uint8Array(this.length()-f+u.byteLength);s>0&&y.set(new Uint8Array(o.slice(0,s)),0),y.set(new Uint8Array(u),s),y.set(new Uint8Array(o.slice(s+f)),s+u.byteLength),this.clear(),o=y.buffer,l=new DataView(o);break}default:return o}},length:function(){return o?o.byteLength:0},clear:function(){l=o=null}})}function c(o){d.extend(this,{readByteAt:function(s){return o.charCodeAt(s)},writeByteAt:function(s,f){l(String.fromCharCode(f),s,1)},SEGMENT:function(s,f,u){switch(arguments.length){case 1:return o.substr(s);case 2:return o.substr(s,f);case 3:l(u!==null?u:"",s,f);break;default:return o}},length:function(){return o?o.length:0},clear:function(){o=null}});function l(s,f,u){u=arguments.length===3?u:o.length-f-1,o=o.substr(0,f)+s+o.substr(u+f)}}return i}),p("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(d,i){return function a(c){var o=[],l,s,f,u=0;if(l=new d(c),l.SHORT(0)!==65496)throw l.clear(),new i.ImageError(i.ImageError.WRONG_FORMAT);for(s=2;s<=l.length();){if(f=l.SHORT(s),f>=65488&&f<=65495){s+=2;continue}if(f===65498||f===65497)break;u=l.SHORT(s+2)+2,f>=65505&&f<=65519&&o.push({hex:f,name:"APP"+(f&15),start:s,length:u,segment:l.SEGMENT(s,u)}),s+=u}return l.clear(),{headers:o,restore:function(y){var w,g,h;for(h=new d(y),s=h.SHORT(2)==65504?4+h.SHORT(4):2,g=0,w=o.length;g<w;g++)h.SEGMENT(s,0,o[g].segment),s+=o[g].length;return y=h.SEGMENT(),h.clear(),y},strip:function(y){var w,g,h,v;for(h=new a(y),g=h.headers,h.purge(),w=new d(y),v=g.length;v--;)w.SEGMENT(g[v].start,g[v].length,"");return y=w.SEGMENT(),w.clear(),y},get:function(y){for(var w=[],g=0,h=o.length;g<h;g++)o[g].name===y.toUpperCase()&&w.push(o[g].segment);return w},set:function(y,w){var g=[],h,v,_;for(typeof w=="string"?g.push(w):g=w,h=v=0,_=o.length;h<_&&(o[h].name===y.toUpperCase()&&(o[h].segment=g[v],o[h].length=g[v].length,v++),!(v>=g.length));h++);},purge:function(){this.headers=o=[]}}}}),p("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(d,i,a){function c(o){var l,s,f,u,y,w;if(i.call(this,o),s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},u={tiffHeader:10},y=u.tiffHeader,l={clear:this.clear},d.extend(this,{read:function(){try{return c.prototype.read.apply(this,arguments)}catch{throw new a.ImageError(a.ImageError.INVALID_META_ERR)}},write:function(){try{return c.prototype.write.apply(this,arguments)}catch{throw new a.ImageError(a.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(_){return this.LONG(_)/this.LONG(_+4)},SRATIONAL:function(_){return this.SLONG(_)/this.SLONG(_+4)},ASCII:function(_){return this.CHAR(_)},TIFF:function(){return w||null},EXIF:function(){var _=null;if(u.exifIFD){try{_=h.call(this,u.exifIFD,s.exif)}catch{return null}if(_.ExifVersion&&d.typeOf(_.ExifVersion)==="array"){for(var R=0,S="";R<_.ExifVersion.length;R++)S+=String.fromCharCode(_.ExifVersion[R]);_.ExifVersion=S}}return _},GPS:function(){var _=null;if(u.gpsIFD){try{_=h.call(this,u.gpsIFD,s.gps)}catch{return null}_.GPSVersionID&&d.typeOf(_.GPSVersionID)==="array"&&(_.GPSVersionID=_.GPSVersionID.join("."))}return _},thumb:function(){if(u.IFD1)try{var _=h.call(this,u.IFD1,s.thumb);if("JPEGInterchangeFormat"in _)return this.SEGMENT(u.tiffHeader+_.JPEGInterchangeFormat,_.JPEGInterchangeFormatLength)}catch{}return null},setExif:function(_,R){return _!=="PixelXDimension"&&_!=="PixelYDimension"?!1:v.call(this,"exif",_,R)},clear:function(){l.clear(),o=s=f=w=u=l=null}}),this.SHORT(0)!==65505||this.STRING(4,5).toUpperCase()!=="EXIF\0")throw new a.ImageError(a.ImageError.INVALID_META_ERR);if(this.littleEndian=this.SHORT(y)==18761,this.SHORT(y+=2)!==42)throw new a.ImageError(a.ImageError.INVALID_META_ERR);u.IFD0=u.tiffHeader+this.LONG(y+=2),w=h.call(this,u.IFD0,s.tiff),"ExifIFDPointer"in w&&(u.exifIFD=u.tiffHeader+w.ExifIFDPointer,delete w.ExifIFDPointer),"GPSInfoIFDPointer"in w&&(u.gpsIFD=u.tiffHeader+w.GPSInfoIFDPointer,delete w.GPSInfoIFDPointer),d.isEmptyObj(w)&&(w=null);var g=this.LONG(u.IFD0+this.SHORT(u.IFD0)*12+2);g&&(u.IFD1=u.tiffHeader+g);function h(_,R){var S=this,O,P,I,T,C,D,L,F,q=[],W={},z={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},G={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(O=S.SHORT(_),P=0;P<O;P++)if(q=[],L=_+2+P*12,I=R[S.SHORT(L)],I!==r){if(T=z[S.SHORT(L+=2)],C=S.LONG(L+=2),D=G[T],!D)throw new a.ImageError(a.ImageError.INVALID_META_ERR);if(L+=4,D*C>4&&(L=S.LONG(L)+u.tiffHeader),L+D*C>=this.length())throw new a.ImageError(a.ImageError.INVALID_META_ERR);if(T==="ASCII"){W[I]=d.trim(S.STRING(L,C).replace(/\0$/,""));continue}else q=S.asArray(T,L,C),F=C==1?q[0]:q,f.hasOwnProperty(I)&&typeof F!="object"?W[I]=f[I][F]:W[I]=F}return W}function v(_,R,S){var O,P,I,T=0;if(typeof R=="string"){var C=s[_.toLowerCase()];for(var D in C)if(C[D]===R){R=D;break}}O=u[_.toLowerCase()+"IFD"],P=this.SHORT(O);for(var L=0;L<P;L++)if(I=O+12*L+2,this.SHORT(I)==R){T=I+8;break}if(!T)return!1;try{this.write(T,S,4)}catch{return!1}return!0}}return c.prototype=i.prototype,c}),p("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(d,i,a,c,o){function l(s){var f,u,y,w;if(f=new c(s),f.SHORT(0)!==65496)throw new i.ImageError(i.ImageError.WRONG_FORMAT);u=new a(s);try{y=new o(u.get("app1")[0])}catch{}w=g.call(this),d.extend(this,{type:"image/jpeg",size:f.length(),width:w&&w.width||0,height:w&&w.height||0,setExif:function(_,R){if(!y)return!1;d.typeOf(_)==="object"?d.each(_,function(S,O){y.setExif(O,S)}):y.setExif(_,R),u.set("app1",y.SEGMENT())},writeHeaders:function(){return arguments.length?u.restore(arguments[0]):u.restore(s)},stripHeaders:function(_){return u.strip(_)},purge:function(){v.call(this)}}),y&&(this.meta={tiff:y.TIFF(),exif:y.EXIF(),gps:y.GPS(),thumb:h()});function g(_){var R=0,S,O;for(_||(_=f);R<=_.length();){if(S=_.SHORT(R+=2),S>=65472&&S<=65475)return R+=5,{height:_.SHORT(R),width:_.SHORT(R+=2)};O=_.SHORT(R+=2),R+=O-2}return null}function h(){var _=y.thumb(),R,S;return _&&(R=new c(_),S=g(R),R.clear(),S)?(S.data=_,S):null}function v(){!y||!u||!f||(y.clear(),u.purge(),f.clear(),w=u=y=f=null)}}return l}),p("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(d,i,a){function c(o){var l,s;l=new a(o),function(){var w=0,g=0,h=[35152,20039,3338,6666];for(g=0;g<h.length;g++,w+=2)if(h[g]!=l.SHORT(w))throw new d.ImageError(d.ImageError.WRONG_FORMAT)}();function f(){var w,g;return w=y.call(this,8),w.type=="IHDR"?(g=w.start,{width:l.LONG(g),height:l.LONG(g+=4)}):null}function u(){l&&(l.clear(),o=s=l=null)}s=f.call(this),i.extend(this,{type:"image/png",size:l.length(),width:s.width,height:s.height,purge:function(){u.call(this)}}),u.call(this);function y(w){var g,h,v,_;return g=l.LONG(w),h=l.STRING(w+=4,4),v=w+=4,_=l.LONG(w+g),{length:g,type:h,start:v,CRC:_}}}return c}),p("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(d,i,a,c){return function(o){var l=[a,c],s;s=function(){for(var f=0;f<l.length;f++)try{return new l[f](o)}catch{}throw new i.ImageError(i.ImageError.WRONG_FORMAT)}(),d.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(f){return f},stripHeaders:function(f){return f},purge:function(){o=null}}),d.extend(this,s),this.purge=function(){s.purge(),s=null}}}),p("moxie/runtime/html5/image/ResizerCanvas",[],function(){function d(a,c,o){var l=a.width>a.height?"width":"height",s=Math.round(a[l]*c),f=!1;o!=="nearest"&&(c<.5||c>2)&&(c=c<.5?.5:2,f=!0);var u=i(a,c);return f?d(u,s/u[l],o):u}function i(a,c){var o=a.width,l=a.height,s=Math.round(o*c),f=Math.round(l*c),u=document.createElement("canvas");return u.width=s,u.height=f,u.getContext("2d").drawImage(a,0,0,o,l,0,0,s,f),a=null,u}return{scale:d}}),p("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/ResizerCanvas","moxie/core/utils/Mime","moxie/core/utils/Env"],function(d,i,a,c,o,l,s,f,u,y){function w(){var g=this,h,v,_,R,S,O=!1,P=!0;i.extend(this,{loadFromBlob:function(z){var G=this.getRuntime(),A=arguments.length>1?arguments[1]:!0;if(!G.can("access_binary"))throw new a.RuntimeError(a.RuntimeError.NOT_SUPPORTED_ERR);if(S=z,z.isDetached()){R=z.getSource(),L.call(this,R);return}else F.call(this,z.getSource(),function(N){A&&(R=C(N)),L.call(this,N)})},loadFromImage:function(z,G){this.meta=z.meta,S=new l(null,{name:z.name,size:z.size,type:z.type}),L.call(this,G?R=z.getAsBinaryString():z.getAsDataURL())},getInfo:function(){var z=this.getRuntime(),G;return!v&&R&&z.can("access_image_binary")&&(v=new s(R)),G={width:I().width||0,height:I().height||0,type:S.type||u.getFileMime(S.name),size:R&&R.length||S.size||0,name:S.name||"",meta:null},P&&(G.meta=v&&v.meta||this.meta||{},G.meta&&G.meta.thumb&&!(G.meta.thumb.data instanceof o)&&(G.meta.thumb.data=new o(null,{type:"image/jpeg",data:G.meta.thumb.data}))),G},resize:function(z,G,A){var N=document.createElement("canvas");if(N.width=z.width,N.height=z.height,N.getContext("2d").drawImage(I(),z.x,z.y,z.width,z.height,0,0,N.width,N.height),_=f.scale(N,G),P=A.preserveHeaders,!P){var U=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;_=q(_,U)}this.width=_.width,this.height=_.height,O=!0,this.trigger("Resize")},getAsCanvas:function(){return _||(_=T()),_.id=this.uid+"_canvas",_},getAsBlob:function(z,G){return z!==this.type?(O=!0,new l(null,{name:S.name||"",type:z,data:g.getAsDataURL(z,G)})):new l(null,{name:S.name||"",type:z,data:g.getAsBinaryString(z,G)})},getAsDataURL:function(z){var G=arguments[1]||90;if(!O)return h.src;if(T(),z!=="image/jpeg")return _.toDataURL("image/png");try{return _.toDataURL("image/jpeg",G/100)}catch{return _.toDataURL("image/jpeg")}},getAsBinaryString:function(z,G){if(!O)return R||(R=C(g.getAsDataURL(z,G))),R;if(z!=="image/jpeg")R=C(g.getAsDataURL(z,G));else{var A;G||(G=90),T();try{A=_.toDataURL("image/jpeg",G/100)}catch{A=_.toDataURL("image/jpeg")}R=C(A),v&&(R=v.stripHeaders(R),P&&(v.meta&&v.meta.exif&&v.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),R=v.writeHeaders(R)),v.purge(),v=null)}return O=!1,R},destroy:function(){g=null,W.call(this),this.getRuntime().getShim().removeInstance(this.uid)}});function I(){if(!_&&!h)throw new a.ImageError(a.DOMException.INVALID_STATE_ERR);return _||h}function T(){var z=I();return z.nodeName.toLowerCase()=="canvas"?z:(_=document.createElement("canvas"),_.width=z.width,_.height=z.height,_.getContext("2d").drawImage(z,0,0),_)}function C(z){return c.atob(z.substring(z.indexOf("base64,")+7))}function D(z,G){return"data:"+(G||"")+";base64,"+c.btoa(z)}function L(z){var G=this;h=new Image,h.onerror=function(){W.call(this),G.trigger("error",a.ImageError.WRONG_FORMAT)},h.onload=function(){G.trigger("load")},h.src=z.substr(0,5)=="data:"?z:D(z,S.type)}function F(z,G){var A=this,N;if(window.FileReader)N=new FileReader,N.onload=function(){G.call(A,this.result)},N.onerror=function(){A.trigger("error",a.ImageError.WRONG_FORMAT)},N.readAsDataURL(z);else return G.call(this,z.getAsDataURL())}function q(z,G){var A=Math.PI/180,N=document.createElement("canvas"),U=N.getContext("2d"),B=z.width,j=z.height;switch(i.inArray(G,[5,6,7,8])>-1?(N.width=j,N.height=B):(N.width=B,N.height=j),G){case 2:U.translate(B,0),U.scale(-1,1);break;case 3:U.translate(B,j),U.rotate(180*A);break;case 4:U.translate(0,j),U.scale(1,-1);break;case 5:U.rotate(90*A),U.scale(1,-1);break;case 6:U.rotate(90*A),U.translate(0,-j);break;case 7:U.rotate(90*A),U.translate(B,-j),U.scale(-1,1);break;case 8:U.rotate(-90*A),U.translate(-B,0);break}return U.drawImage(z,0,0,B,j),N}function W(){v&&(v.purge(),v=null),R=h=_=S=null,O=!1}}return d.Image=w}),p("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(d,i,a,c,o){var l="flash",s={};function f(){var g;try{g=navigator.plugins["Shockwave Flash"],g=g.description}catch{try{g=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch{g="0.0"}}return g=g.match(/\d+/g),parseFloat(g[0]+"."+g[1])}function u(g){var h=a.get(g);h&&h.nodeName=="OBJECT"&&(i.browser==="IE"?(h.style.display="none",function v(){h.readyState==4?y(g):setTimeout(v,10)}()):h.parentNode.removeChild(h))}function y(g){var h=a.get(g);if(h){for(var v in h)typeof h[v]=="function"&&(h[v]=null);h.parentNode.removeChild(h)}}function w(g){var h=this,v;g=d.extend({swf_url:i.swf_url},g),o.call(this,g,l,{access_binary:function(_){return _&&h.mode==="browser"},access_image_binary:function(_){return _&&h.mode==="browser"},display_media:o.capTest(b("moxie/image/Image")),do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:function(){return h.mode==="client"},resize_image:o.capTrue,return_response_headers:!1,return_response_type:function(_){return _==="json"&&window.JSON?!0:!d.arrayDiff(_,["","text","document"])||h.mode==="browser"},return_status_code:function(_){return h.mode==="browser"||!d.arrayDiff(_,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:function(_){return _&&h.mode==="browser"},send_browser_cookies:function(_){return _&&h.mode==="browser"},send_custom_headers:function(_){return _&&h.mode==="browser"},send_multipart:o.capTrue,slice_blob:function(_){return _&&h.mode==="browser"},stream_upload:function(_){return _&&h.mode==="browser"},summon_file_dialog:!1,upload_filesize:function(_){return d.parseSizeStr(_)<=2097152||h.mode==="client"},use_http_method:function(_){return!d.arrayDiff(_,["GET","POST"])}},{access_binary:function(_){return _?"browser":"client"},access_image_binary:function(_){return _?"browser":"client"},report_upload_progress:function(_){return _?"browser":"client"},return_response_type:function(_){return d.arrayDiff(_,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(_){return d.arrayDiff(_,[200,404])?"browser":["client","browser"]},send_binary_string:function(_){return _?"browser":"client"},send_browser_cookies:function(_){return _?"browser":"client"},send_custom_headers:function(_){return _?"browser":"client"},slice_blob:function(_){return _?"browser":"client"},stream_upload:function(_){return _?"client":"browser"},upload_filesize:function(_){return d.parseSizeStr(_)>=2097152?"client":"browser"}},"client"),f()<11.3&&(i.debug.runtime&&i.log("	Flash didn't meet minimal version requirement (11.3)."),this.mode=!1),d.extend(this,{getShim:function(){return a.get(this.uid)},shimExec:function(_,R){var S=[].slice.call(arguments,2);return h.getShim().exec(this.uid,_,R,S)},init:function(){var _,R,S;S=this.getShimContainer(),d.extend(S.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),_='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+g.swf_url+'" ',i.browser==="IE"&&(_+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),_+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+g.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+o.getGlobalEventTarget()+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',i.browser==="IE"?(R=document.createElement("div"),S.appendChild(R),R.outerHTML=_,R=S=null):S.innerHTML=_,v=setTimeout(function(){h&&!h.initialized&&(h.trigger("Error",new c.RuntimeError(c.RuntimeError.NOT_INIT_ERR)),i.debug.runtime&&i.log("	Flash failed to initialize within a specified period of time (typically 5s)."))},5e3)},destroy:function(_){return function(){u(h.uid),_.call(h),clearTimeout(v),g=v=_=h=null}}(this.destroy)},s)}return o.addConstructor(l,w),s}),p("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(d,i){var a={slice:function(c,o,l,s){var f=this.getRuntime();return o<0?o=Math.max(c.size+o,0):o>0&&(o=Math.min(o,c.size)),l<0?l=Math.max(c.size+l,0):l>0&&(l=Math.min(l,c.size)),c=f.shimExec.call(this,"Blob","slice",o,l,s||""),c&&(c=new i(f.uid,c)),c}};return d.Blob=a}),p("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(d,i,a,c){var o={init:function(l){var s=this,f=this.getRuntime(),u=a.get(l.browse_button);u&&(u.setAttribute("tabindex",-1),u=null),this.bind("Change",function(){var y=f.shimExec.call(s,"FileInput","getFiles");s.files=[],c.each(y,function(w){s.files.push(new i(f.uid,w))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",{accept:l.accept,multiple:l.multiple}),this.trigger("ready")}};return d.FileInput=o}),p("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(d,i){function a(o,l){switch(l){case"readAsText":return i.atob(o,"utf8");case"readAsBinaryString":return i.atob(o);case"readAsDataURL":return o}return null}var c={read:function(o,l){var s=this;return s.result="",o==="readAsDataURL"&&(s.result="data:"+(l.type||"")+";base64,"),s.bind("Progress",function(f,u){u&&(s.result+=a(u,o))},999),s.getRuntime().shimExec.call(this,"FileReader","readAsBase64",l.uid)}};return d.FileReader=c}),p("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(d,i){function a(o,l){switch(l){case"readAsText":return i.atob(o,"utf8");case"readAsBinaryString":return i.atob(o);case"readAsDataURL":return o}return null}var c={read:function(o,l){var s,f=this.getRuntime();return s=f.shimExec.call(this,"FileReaderSync","readAsBase64",l.uid),s?(o==="readAsDataURL"&&(s="data:"+(l.type||"")+";base64,"+s),a(s,o,l.type)):null}};return d.FileReaderSync=c}),p("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(d,i){var a={getAsBlob:function(c){var o=this.getRuntime(),l=o.shimExec.call(this,"Transporter","getAsBlob",c);return l?new i(o.uid,l):null}};return d.Transporter=a}),p("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/runtime/flash/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/runtime/flash/runtime/Transporter"],function(d,i,a,c,o,l,s,f,u){var y={send:function(w,g){var h=this,v=h.getRuntime();function _(){w.transport=v.mode,v.shimExec.call(h,"XMLHttpRequest","send",w,g)}function R(I,T){v.shimExec.call(h,"XMLHttpRequest","appendBlob",I,T.uid),g=null,_()}function S(I,T){var C=new f;C.bind("TransportingComplete",function(){T(this.result)}),C.transport(I.getSource(),I.type,{ruid:v.uid})}if(i.isEmptyObj(w.headers)||i.each(w.headers,function(I,T){v.shimExec.call(h,"XMLHttpRequest","setRequestHeader",T,I.toString())}),g instanceof s){var O;if(g.each(function(I,T){I instanceof a?O=T:v.shimExec.call(h,"XMLHttpRequest","append",T,I)}),!g.hasBlob())g=null,_();else{var P=g.getBlob();P.isDetached()?S(P,function(I){P.destroy(),R(O,I)}):R(O,P)}}else g instanceof a?g.isDetached()?S(g,function(I){g.destroy(),g=I.uid,_()}):(g=g.uid,_()):_()},getResponse:function(w){var g,h,v=this.getRuntime();if(h=v.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob"),h){if(h=new c(v.uid,h),w==="blob")return h;try{if(g=new o,~i.inArray(w,["","text"]))return g.readAsText(h);if(w==="json"&&window.JSON)return JSON.parse(g.readAsText(h))}finally{h.destroy()}}return null},abort:function(w){var g=this.getRuntime();g.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return d.XMLHttpRequest=y}),p("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(d,i,a,c,o){var l={loadFromBlob:function(s){var f=this,u=f.getRuntime();function y(g){u.shimExec.call(f,"Image","loadFromBlob",g.uid),f=u=null}if(s.isDetached()){var w=new a;w.bind("TransportingComplete",function(){y(w.result.getSource())}),w.transport(s.getSource(),s.type,{ruid:u.uid})}else y(s.getSource())},loadFromImage:function(s){var f=this.getRuntime();return f.shimExec.call(this,"Image","loadFromImage",s.uid)},getInfo:function(){var s=this.getRuntime(),f=s.shimExec.call(this,"Image","getInfo");return f.meta&&f.meta.thumb&&f.meta.thumb.data&&!(s.meta.thumb.data instanceof c)&&(f.meta.thumb.data=new c(s.uid,f.meta.thumb.data)),f},getAsBlob:function(s,f){var u=this.getRuntime(),y=u.shimExec.call(this,"Image","getAsBlob",s,f);return y?new c(u.uid,y):null},getAsDataURL:function(){var s=this.getRuntime(),f=s.Image.getAsBlob.apply(this,arguments),u;return f?(u=new o,u.readAsDataURL(f)):null}};return d.Image=l}),p("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(d,i,a,c,o){var l="silverlight",s={};function f(y){var w=!1,g=null,h,v,_,R,S,O=0;try{try{g=new ActiveXObject("AgControl.AgControl"),g.IsVersionSupported(y)&&(w=!0),g=null}catch{var P=navigator.plugins["Silverlight Plug-In"];if(P){for(h=P.description,h==="1.0.30226.2"&&(h="2.0.30226.2"),v=h.split(".");v.length>3;)v.pop();for(;v.length<4;)v.push(0);for(_=y.split(".");_.length>4;)_.pop();do R=parseInt(_[O],10),S=parseInt(v[O],10),O++;while(O<_.length&&R===S);R<=S&&!isNaN(R)&&(w=!0)}}}catch{w=!1}return w}function u(y){var w=this,g;y=d.extend({xap_url:i.xap_url},y),o.call(this,y,l,{access_binary:o.capTrue,access_image_binary:o.capTrue,display_media:o.capTest(b("moxie/image/Image")),do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:o.capTrue,resize_image:o.capTrue,return_response_headers:function(h){return h&&w.mode==="client"},return_response_type:function(h){return h!=="json"?!0:!!window.JSON},return_status_code:function(h){return w.mode==="client"||!d.arrayDiff(h,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:o.capTrue,send_browser_cookies:function(h){return h&&w.mode==="browser"},send_custom_headers:function(h){return h&&w.mode==="client"},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:o.capTrue,use_http_method:function(h){return w.mode==="client"||!d.arrayDiff(h,["GET","POST"])}},{return_response_headers:function(h){return h?"client":"browser"},return_status_code:function(h){return d.arrayDiff(h,[200,404])?"client":["client","browser"]},send_browser_cookies:function(h){return h?"browser":"client"},send_custom_headers:function(h){return h?"client":"browser"},use_http_method:function(h){return d.arrayDiff(h,["GET","POST"])?"client":["client","browser"]}}),(!f("2.0.31005.0")||i.browser==="Opera")&&(i.debug.runtime&&i.log("	Silverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely)."),this.mode=!1),d.extend(this,{getShim:function(){return a.get(this.uid).content.Moxie},shimExec:function(h,v){var _=[].slice.call(arguments,2);return w.getShim().exec(this.uid,h,v,_)},init:function(){var h;h=this.getShimContainer(),h.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+y.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+o.getGlobalEventTarget()+'"/></object>',g=setTimeout(function(){w&&!w.initialized&&(w.trigger("Error",new c.RuntimeError(c.RuntimeError.NOT_INIT_ERR)),i.debug.runtime&&i.log("Silverlight failed to initialize within a specified period of time (5-10s)."))},i.OS!=="Windows"?1e4:5e3)},destroy:function(h){return function(){h.call(w),clearTimeout(g),y=g=h=w=null}}(this.destroy)},s)}return o.addConstructor(l,u),s}),p("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(d,i,a){return d.Blob=i.extend({},a)}),p("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Dom","moxie/core/utils/Basic"],function(d,i,a,c){function o(s){for(var f="",u=0;u<s.length;u++)f+=(f!==""?"|":"")+s[u].title+" | *."+s[u].extensions.replace(/,/g,";*.");return f}var l={init:function(s){var f=this,u=this.getRuntime(),y=a.get(s.browse_button);y&&(y.setAttribute("tabindex",-1),y=null),this.bind("Change",function(){var w=u.shimExec.call(f,"FileInput","getFiles");f.files=[],c.each(w,function(g){f.files.push(new i(u.uid,g))})},999),u.shimExec.call(this,"FileInput","init",o(s.accept),s.multiple),this.trigger("ready")},setOption:function(s,f){s=="accept"&&(f=o(f)),this.getRuntime().shimExec.call(this,"FileInput","setOption",s,f)}};return d.FileInput=l}),p("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(d,i,a){var c={init:function(){var o=this,l=o.getRuntime(),s;return s=l.getShimContainer(),a.addEvent(s,"dragover",function(f){f.preventDefault(),f.stopPropagation(),f.dataTransfer.dropEffect="copy"},o.uid),a.addEvent(s,"dragenter",function(f){f.preventDefault();var u=i.get(l.uid).dragEnter(f);u&&f.stopPropagation()},o.uid),a.addEvent(s,"drop",function(f){f.preventDefault();var u=i.get(l.uid).dragDrop(f);u&&f.stopPropagation()},o.uid),l.shimExec.call(this,"FileDrop","init")}};return d.FileDrop=c}),p("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(d,i,a){return d.FileReader=i.extend({},a)}),p("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(d,i,a){return d.FileReaderSync=i.extend({},a)}),p("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(d,i,a){return d.Transporter=i.extend({},a)}),p("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/silverlight/file/FileReaderSync","moxie/runtime/silverlight/runtime/Transporter"],function(d,i,a,c,o){return d.XMLHttpRequest=i.extend({},a)}),p("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(d,i,a,c){return d.Image=i.extend({},c,{getInfo:function(){var o=this.getRuntime(),l=["tiff","exif","gps","thumb"],s={meta:{}},f=o.shimExec.call(this,"Image","getInfo");return f.meta&&(i.each(l,function(u){var y=f.meta[u],w,g,h,v;if(y&&y.keys)for(s.meta[u]={},g=0,h=y.keys.length;g<h;g++)w=y.keys[g],v=y[w],v&&(/^(\d|[1-9]\d+)$/.test(v)?v=parseInt(v,10):/^\d*\.\d+$/.test(v)&&(v=parseFloat(v)),s.meta[u][w]=v)}),s.meta&&s.meta.thumb&&s.meta.thumb.data&&!(o.meta.thumb.data instanceof a)&&(s.meta.thumb.data=new a(o.uid,s.meta.thumb.data))),s.width=parseInt(f.width,10),s.height=parseInt(f.height,10),s.size=parseInt(f.size,10),s.type=f.type,s.name=f.name,s},resize:function(o,l,s){this.getRuntime().shimExec.call(this,"Image","resize",o.x,o.y,o.width,o.height,l,s.preserveHeaders,s.resample)}})}),p("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(d,i,a,c){var o="html4",l={};function s(f){var u=this,y=a.capTest,w=a.capTrue;a.call(this,f,o,{access_binary:y(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:y((c.can("create_canvas")||c.can("use_data_uri_over32kb"))&&b("moxie/image/Image")),do_cors:!1,drag_and_drop:!1,filter_by_extension:y(function(){return!(c.browser==="Chrome"&&c.verComp(c.version,28,"<")||c.browser==="IE"&&c.verComp(c.version,10,"<")||c.browser==="Safari"&&c.verComp(c.version,7,"<")||c.browser==="Firefox"&&c.verComp(c.version,37,"<"))}()),resize_image:function(){return l.Image&&u.can("access_binary")&&c.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(g){return g==="json"&&window.JSON?!0:!!~d.inArray(g,["text","document",""])},return_status_code:function(g){return!d.arrayDiff(g,[200,404])},select_file:function(){return c.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return u.can("select_file")},summon_file_dialog:function(){return u.can("select_file")&&!(c.browser==="Firefox"&&c.verComp(c.version,4,"<")||c.browser==="Opera"&&c.verComp(c.version,12,"<")||c.browser==="IE"&&c.verComp(c.version,10,"<"))},upload_filesize:w,use_http_method:function(g){return!d.arrayDiff(g,["GET","POST"])}}),d.extend(this,{init:function(){this.trigger("Init")},destroy:function(g){return function(){g.call(u),g=u=null}}(this.destroy)}),d.extend(this.getShim(),l)}return a.addConstructor(o,s),l}),p("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(d,i,a,c,o,l,s){function f(){var u,y=[],w,g;function h(){var v=this,_=v.getRuntime(),R,S,O,P,I,T;T=a.guid("uid_"),R=_.getShimContainer(),u&&(O=c.get(u+"_form"),O&&(a.extend(O.style,{top:"100%"}),O.firstChild.setAttribute("tabindex",-1))),P=document.createElement("form"),P.setAttribute("id",T+"_form"),P.setAttribute("method","post"),P.setAttribute("enctype","multipart/form-data"),P.setAttribute("encoding","multipart/form-data"),a.extend(P.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),I=document.createElement("input"),I.setAttribute("id",T),I.setAttribute("type","file"),I.setAttribute("accept",y.join(",")),_.can("summon_file_dialog")&&I.setAttribute("tabindex",-1),a.extend(I.style,{fontSize:"999px",opacity:0}),P.appendChild(I),R.appendChild(P),a.extend(I.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),s.browser==="IE"&&s.verComp(s.version,10,"<")&&a.extend(I.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),I.onchange=function(){var C;this.value&&(this.files?C=this.files[0]:C={name:this.value},C=new i(_.uid,C),this.onchange=function(){},h.call(v),v.files=[C],I.setAttribute("id",C.uid),P.setAttribute("id",C.uid+"_form"),v.trigger("change"),I=P=null)},_.can("summon_file_dialog")&&(S=c.get(w.browse_button),o.removeEvent(S,"click",v.uid),o.addEvent(S,"click",function(C){I&&!I.disabled&&I.click(),C.preventDefault()},v.uid)),u=T,R=O=S=null}a.extend(this,{init:function(v){var _=this,R=_.getRuntime(),S;w=v,y=l.extList2mimes(v.accept,R.can("filter_by_extension")),S=R.getShimContainer(),function(){var O,P,I;O=c.get(v.browse_button),g=c.getStyle(O,"z-index")||"auto",R.can("summon_file_dialog")?(c.getStyle(O,"position")==="static"&&(O.style.position="relative"),_.bind("Refresh",function(){P=parseInt(g,10)||1,c.get(w.browse_button).style.zIndex=P,this.getRuntime().getShimContainer().style.zIndex=P-1})):O.setAttribute("tabindex",-1),I=R.can("summon_file_dialog")?O:S,o.addEvent(I,"mouseover",function(){_.trigger("mouseenter")},_.uid),o.addEvent(I,"mouseout",function(){_.trigger("mouseleave")},_.uid),o.addEvent(I,"mousedown",function(){_.trigger("mousedown")},_.uid),o.addEvent(c.get(v.container),"mouseup",function(){_.trigger("mouseup")},_.uid),O=null}(),h.call(this),S=null,_.trigger({type:"ready",async:!0})},setOption:function(v,_){var R=this.getRuntime(),S;v=="accept"&&(y=_.mimes||l.extList2mimes(_,R.can("filter_by_extension"))),S=c.get(u),S&&S.setAttribute("accept",y.join(","))},disable:function(v){var _;(_=c.get(u))&&(_.disabled=!!v)},destroy:function(){var v=this.getRuntime(),_=v.getShim(),R=v.getShimContainer(),S=w&&c.get(w.container),O=w&&c.get(w.browse_button);S&&o.removeAllEvents(S,this.uid),O&&(o.removeAllEvents(O,this.uid),O.style.zIndex=g),R&&(o.removeAllEvents(R,this.uid),R.innerHTML=""),_.removeInstance(this.uid),u=y=w=R=S=O=_=null}})}return d.FileInput=f}),p("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(d,i){return d.FileReader=i}),p("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(d,i,a,c,o,l,s,f){function u(){var y,w,g;function h(v){var _=this,R,S,O,P,I=!1;if(g){if(R=g.id.replace(/_iframe$/,""),S=a.get(R+"_form"),S){for(O=S.getElementsByTagName("input"),P=O.length;P--;)switch(O[P].getAttribute("type")){case"hidden":O[P].parentNode.removeChild(O[P]);break;case"file":I=!0;break}O=[],I||S.parentNode.removeChild(S),S=null}setTimeout(function(){l.removeEvent(g,"load",_.uid),g.parentNode&&g.parentNode.removeChild(g);var T=_.getRuntime().getShimContainer();T.children.length||T.parentNode.removeChild(T),T=g=null,v()},1)}}i.extend(this,{send:function(v,_){var R=this,S=R.getRuntime(),O,P,I,T;y=w=null;function C(){var D=S.getShimContainer()||document.body,L=document.createElement("div");L.innerHTML='<iframe id="'+O+'_iframe" name="'+O+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',g=L.firstChild,D.appendChild(g),l.addEvent(g,"load",function(){var F;try{F=g.contentWindow.document||g.contentDocument||window.frames[g.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(F.title)?y=F.title.replace(/^(\d+).*$/,"$1"):(y=200,w=i.trim(F.body.innerHTML),R.trigger({type:"progress",loaded:w.length,total:w.length}),T&&R.trigger({type:"uploadprogress",loaded:T.size||1025,total:T.size||1025}))}catch{if(c.hasSameOrigin(v.url))y=404;else{h.call(R,function(){R.trigger("error")});return}}h.call(R,function(){R.trigger("load")})},R.uid)}if(_ instanceof f&&_.hasBlob()){if(T=_.getBlob(),O=T.uid,I=a.get(O),P=a.get(O+"_form"),!P)throw new o.DOMException(o.DOMException.NOT_FOUND_ERR)}else O=i.guid("uid_"),P=document.createElement("form"),P.setAttribute("id",O+"_form"),P.setAttribute("method",v.method),P.setAttribute("enctype","multipart/form-data"),P.setAttribute("encoding","multipart/form-data"),S.getShimContainer().appendChild(P);P.setAttribute("target",O+"_iframe"),_ instanceof f&&_.each(function(D,L){if(D instanceof s)I&&I.setAttribute("name",L);else{var F=document.createElement("input");i.extend(F,{type:"hidden",name:L,value:D}),I?P.insertBefore(F,I):P.appendChild(F)}}),P.setAttribute("action",v.url),C(),P.submit(),R.trigger("loadstart")},getStatus:function(){return y},getResponse:function(v){if(v==="json"&&i.typeOf(w)==="string"&&window.JSON)try{return JSON.parse(w.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch{return null}return w},abort:function(){var v=this;g&&g.contentWindow&&(g.contentWindow.stop?g.contentWindow.stop():g.contentWindow.document.execCommand?g.contentWindow.document.execCommand("Stop"):g.src="about:blank"),h.call(this,function(){v.dispatchEvent("abort")})},destroy:function(){this.getRuntime().getShim().removeInstance(this.uid)}})}return d.XMLHttpRequest=u}),p("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(d,i){return d.Image=i}),E(["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Dom","moxie/core/EventTarget","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/core/I18n","moxie/core/utils/Mime","moxie/file/FileInput","moxie/file/File","moxie/file/FileDrop","moxie/file/FileReader","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/image/Image","moxie/core/utils/Events","moxie/runtime/html5/image/ResizerCanvas"])})(this)})}(fr)),fr.exports}(function(e){(function(t,r){var n=function(){var m={};return r.apply(m,arguments),m.plupload};e.exports?e.exports=n(yo()):t.plupload=n(t.moxie)})(Bn||window,function(t){(function(r,n,m){var p=window.setTimeout,b={},x=n.core.utils,E=n.runtime.Runtime;function d(a){var c=a.required_features,o={};function l(s,f,u){var y={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};y[s]?o[y[s]]=f:u||(o[s]=f)}return typeof c=="string"?i.each(c.split(/\s*,\s*/),function(s){l(s,!0)}):typeof c=="object"?i.each(c,function(s,f){l(f,s)}):c===!0&&(a.chunk_size&&a.chunk_size>0&&(o.slice_blob=!0),(!i.isEmptyObj(a.resize)||a.multipart===!1)&&(o.send_binary_string=!0),a.http_method&&(o.use_http_method=a.http_method),i.each(a,function(s,f){l(f,!!s,!0)})),o}var i={VERSION:"2.3.6",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,moxie:n,mimeTypes:x.Mime.mimes,ua:x.Env,typeOf:x.Basic.typeOf,extend:x.Basic.extend,guid:x.Basic.guid,getAll:function(c){var o=[],l;i.typeOf(c)!=="array"&&(c=[c]);for(var s=c.length;s--;)l=i.get(c[s]),l&&o.push(l);return o.length?o:null},get:x.Dom.get,each:x.Basic.each,getPos:x.Dom.getPos,getSize:x.Dom.getSize,xmlEncode:function(a){var c={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},o=/[<>&\"\']/g;return a&&(""+a).replace(o,function(l){return c[l]?"&"+c[l]+";":l})},toArray:x.Basic.toArray,inArray:x.Basic.inArray,inSeries:x.Basic.inSeries,addI18n:n.core.I18n.addI18n,translate:n.core.I18n.translate,sprintf:x.Basic.sprintf,isEmptyObj:x.Basic.isEmptyObj,hasClass:x.Dom.hasClass,addClass:x.Dom.addClass,removeClass:x.Dom.removeClass,getStyle:x.Dom.getStyle,addEvent:x.Events.addEvent,removeEvent:x.Events.removeEvent,removeAllEvents:x.Events.removeAllEvents,cleanName:function(a){var c,o;for(o=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],c=0;c<o.length;c+=2)a=a.replace(o[c],o[c+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,""),a},buildUrl:function(a,c){var o="";return i.each(c,function(l,s){o+=(o?"&":"")+encodeURIComponent(s)+"="+encodeURIComponent(l)}),o&&(a+=(a.indexOf("?")>0?"&":"?")+o),a},formatSize:function(a){if(a===m||/\D/.test(a))return i.translate("N/A");function c(l,s){return Math.round(l*Math.pow(10,s))/Math.pow(10,s)}var o=Math.pow(1024,4);return a>o?c(a/o,1)+" "+i.translate("tb"):a>(o/=1024)?c(a/o,1)+" "+i.translate("gb"):a>(o/=1024)?c(a/o,1)+" "+i.translate("mb"):a>1024?Math.round(a/1024)+" "+i.translate("kb"):a+" "+i.translate("b")},parseSize:x.Basic.parseSizeStr,predictRuntime:function(a,c){var o,l;return o=new i.Uploader(a),l=E.thatCan(o.getOption().required_features,c||a.runtimes),o.destroy(),l},addFileFilter:function(a,c){b[a]=c}};i.addFileFilter("mime_types",function(a,c,o){a.length&&!a.regexp.test(c.name)?(this.trigger("Error",{code:i.FILE_EXTENSION_ERROR,message:i.translate("File extension error."),file:c}),o(!1)):o(!0)}),i.addFileFilter("max_file_size",function(a,c,o){var l;a=i.parseSize(a),c.size!==l&&a&&c.size>a?(this.trigger("Error",{code:i.FILE_SIZE_ERROR,message:i.translate("File size error."),file:c}),o(!1)):o(!0)}),i.addFileFilter("prevent_duplicates",function(a,c,o){if(a){for(var l=this.files.length;l--;)if(c.name===this.files[l].name&&c.size===this.files[l].size){this.trigger("Error",{code:i.FILE_DUPLICATE_ERROR,message:i.translate("Duplicate file error."),file:c}),o(!1);return}}o(!0)}),i.addFileFilter("prevent_empty",function(a,c,o){a&&!c.size&&c.size!==m?(this.trigger("Error",{code:i.FILE_SIZE_ERROR,message:i.translate("File size error."),file:c}),o(!1)):o(!0)}),i.Uploader=function(a){var c=i.guid(),o,l=[],s={},f=[],u=[],y,w,g=!1,h;function v(){var A,N=0,U;if(this.state==i.STARTED){for(U=0;U<l.length;U++)!A&&l[U].status==i.QUEUED?(A=l[U],this.trigger("BeforeUpload",A)&&(A.status=i.UPLOADING,this.trigger("UploadFile",A))):N++;N==l.length&&(this.state!==i.STOPPED&&(this.state=i.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",l))}}function _(A){A.percent=A.size>0?Math.ceil(A.loaded/A.size*100):100,R()}function R(){var A,N,U,B=0;for(w.reset(),A=0;A<l.length;A++)N=l[A],N.size!==m?(w.size+=N.origSize,U=N.loaded*N.origSize/N.size,(!N.completeTimestamp||N.completeTimestamp>y)&&(B+=U),w.loaded+=U):w.size=m,N.status==i.DONE?w.uploaded++:N.status==i.FAILED?w.failed++:w.queued++;w.size===m?w.percent=l.length>0?Math.ceil(w.uploaded/l.length*100):0:(w.bytesPerSec=Math.ceil(B/((+new Date-y||1)/1e3)),w.percent=w.size>0?Math.ceil(w.loaded/w.size*100):0)}function S(){var A=f[0]||u[0];return A?A.getRuntime().uid:!1}function O(){this.bind("FilesAdded FilesRemoved",function(A){A.trigger("QueueChanged"),A.refresh()}),this.bind("CancelUpload",q),this.bind("BeforeUpload",C),this.bind("UploadFile",D),this.bind("UploadProgress",L),this.bind("StateChanged",F),this.bind("QueueChanged",R),this.bind("Error",z),this.bind("FileUploaded",W),this.bind("Destroy",G)}function P(A,N){var U=this,B=0,j=[],te={runtime_order:A.runtimes,required_caps:A.required_features,preferred_caps:s,swf_url:A.flash_swf_url,xap_url:A.silverlight_xap_url};i.each(A.runtimes.split(/\s*,\s*/),function(X){A[X]&&(te[X]=A[X])}),A.browse_button&&i.each(A.browse_button,function(X){j.push(function(M){var J=new n.file.FileInput(i.extend({},te,{accept:A.filters.mime_types,name:A.file_data_name,multiple:A.multi_selection,container:A.container,browse_button:X}));J.onready=function(){var ne=E.getInfo(this.ruid);i.extend(U.features,{chunks:ne.can("slice_blob"),multipart:ne.can("send_multipart"),multi_selection:ne.can("select_multiple")}),B++,f.push(this),M()},J.onchange=function(){U.addFile(this.files)},J.bind("mouseenter mouseleave mousedown mouseup",function(ne){g||(A.browse_button_hover&&(ne.type==="mouseenter"?i.addClass(X,A.browse_button_hover):ne.type==="mouseleave"&&i.removeClass(X,A.browse_button_hover)),A.browse_button_active&&(ne.type==="mousedown"?i.addClass(X,A.browse_button_active):ne.type==="mouseup"&&i.removeClass(X,A.browse_button_active)))}),J.bind("mousedown",function(){U.trigger("Browse")}),J.bind("error runtimeerror",function(){J=null,M()}),J.init()})}),A.drop_element&&i.each(A.drop_element,function(X){j.push(function(M){var J=new n.file.FileDrop(i.extend({},te,{drop_zone:X}));J.onready=function(){var ne=E.getInfo(this.ruid);i.extend(U.features,{chunks:ne.can("slice_blob"),multipart:ne.can("send_multipart"),dragdrop:ne.can("drag_and_drop")}),B++,u.push(this),M()},J.ondrop=function(){U.addFile(this.files)},J.bind("error runtimeerror",function(){J=null,M()}),J.init()})}),i.inSeries(j,function(){typeof N=="function"&&N(B)})}function I(A,N,U,B){var j=new n.image.Image;try{j.onload=function(){N.width>this.width&&N.height>this.height&&N.quality===m&&N.preserve_headers&&!N.crop?(this.destroy(),B(A)):j.downsize(N.width,N.height,N.crop,N.preserve_headers)},j.onresize=function(){var te=this.getAsBlob(A.type,N.quality);this.destroy(),B(te)},j.bind("error runtimeerror",function(){this.destroy(),B(A)}),j.load(A,U)}catch{B(A)}}function T(A,N,U){var B=this,j=!1;function te(X,M,J){var ne=o[X];switch(X){case"max_file_size":X==="max_file_size"&&(o.max_file_size=o.filters.max_file_size=M);break;case"chunk_size":(M=i.parseSize(M))&&(o[X]=M,o.send_file_name=!0);break;case"multipart":o[X]=M,M||(o.send_file_name=!0);break;case"http_method":o[X]=M.toUpperCase()==="PUT"?"PUT":"POST";break;case"unique_names":o[X]=M,M&&(o.send_file_name=!0);break;case"filters":i.typeOf(M)==="array"&&(M={mime_types:M}),J?i.extend(o.filters,M):o.filters=M,M.mime_types&&(i.typeOf(M.mime_types)==="string"&&(M.mime_types=n.core.utils.Mime.mimes2extList(M.mime_types)),M.mime_types.regexp=function(H){var V=[];return i.each(H,function(Z){i.each(Z.extensions.split(/,/),function(ie){/^\s*\*\s*$/.test(ie)?V.push("\\.*"):V.push("\\."+ie.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+V.join("|")+")$","i")}(M.mime_types),o.filters.mime_types=M.mime_types);break;case"resize":M?o.resize=i.extend({preserve_headers:!0,crop:!1},M):o.resize=!1;break;case"prevent_duplicates":o.prevent_duplicates=o.filters.prevent_duplicates=!!M;break;case"container":case"browse_button":case"drop_element":M=X==="container"?i.get(M):i.getAll(M);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":o[X]=M,J||(j=!0);break;default:o[X]=M}J||B.trigger("OptionChanged",X,M,ne)}typeof A=="object"?i.each(A,function(X,M){te(M,X,U)}):te(A,N,U),U?(o.required_features=d(i.extend({},o)),s=d(i.extend({},o,{required_features:!0}))):j&&(B.trigger("Destroy"),P.call(B,o,function(X){X?(B.runtime=E.getInfo(S()).type,B.trigger("Init",{runtime:B.runtime}),B.trigger("PostInit")):B.trigger("Error",{code:i.INIT_ERROR,message:i.translate("Init error.")})}))}function C(A,N){if(A.settings.unique_names){var U=N.name.match(/\.([^.]+)$/),B="part";U&&(B=U[1]),N.target_name=N.id+"."+B}}function D(A,N){var U=A.settings.url,B=A.settings.chunk_size,j=A.settings.max_retries,te=A.features,X=0,M,J={runtime_order:A.settings.runtimes,required_caps:A.settings.required_features,preferred_caps:s,swf_url:A.settings.flash_swf_url,xap_url:A.settings.silverlight_xap_url};N.loaded&&(X=N.loaded=B?B*Math.floor(N.loaded/B):0);function ne(){j-- >0?p(H,1e3):(N.loaded=X,A.trigger("Error",{code:i.HTTP_ERROR,message:i.translate("HTTP Error."),file:N,response:h.responseText,status:h.status,responseHeaders:h.getAllResponseHeaders()}))}function H(){var Z,ie={},se;N.status!==i.UPLOADING||A.state===i.STOPPED||(A.settings.send_file_name&&(ie.name=N.target_name||N.name),B&&te.chunks&&M.size>B?(se=Math.min(B,M.size-X),Z=M.slice(X,X+se)):(se=M.size,Z=M),B&&te.chunks&&(A.settings.send_chunk_number?(ie.chunk=Math.ceil(X/B),ie.chunks=Math.ceil(M.size/B)):(ie.offset=X,ie.total=M.size)),A.trigger("BeforeChunkUpload",N,ie,Z,X)&&V(ie,Z,se))}function V(Z,ie,se){var ee;h=new n.xhr.XMLHttpRequest,h.upload&&(h.upload.onprogress=function(Re){N.loaded=Math.min(N.size,X+Re.loaded),A.trigger("UploadProgress",N)}),h.onload=function(){if(h.status<200||h.status>=400){ne();return}j=A.settings.max_retries,se<M.size?(ie.destroy(),X+=se,N.loaded=Math.min(X,M.size),A.trigger("ChunkUploaded",N,{offset:N.loaded,total:M.size,response:h.responseText,status:h.status,responseHeaders:h.getAllResponseHeaders()}),i.ua.browser==="Android Browser"&&A.trigger("UploadProgress",N)):N.loaded=N.size,ie=ee=null,!X||X>=M.size?(N.size!=N.origSize&&(M.destroy(),M=null),A.trigger("UploadProgress",N),N.status=i.DONE,N.completeTimestamp=+new Date,A.trigger("FileUploaded",N,{response:h.responseText,status:h.status,responseHeaders:h.getAllResponseHeaders()})):p(H,1)},h.onerror=function(Re){ne()},h.onloadend=function(){this.destroy()},A.settings.multipart&&te.multipart?(h.open(A.settings.http_method,U,!0),i.each(A.settings.headers,function(Re,ct){h.setRequestHeader(ct,Re)}),ee=new n.xhr.FormData,i.each(i.extend(Z,A.settings.multipart_params),function(Re,ct){ee.append(ct,Re)}),ee.append(A.settings.file_data_name,ie),h.send(ee,J)):(U=i.buildUrl(A.settings.url,i.extend(Z,A.settings.multipart_params)),h.open(A.settings.http_method,U,!0),i.each(A.settings.headers,function(Re,ct){h.setRequestHeader(ct,Re)}),h.hasRequestHeader("Content-Type")||h.setRequestHeader("Content-Type","application/octet-stream"),h.send(ie,J))}M=N.getSource(),!i.isEmptyObj(A.settings.resize)&&i.inArray(M.type,["image/jpeg","image/png"])!==-1?I(M,A.settings.resize,J,function(Z){M=Z,N.size=Z.size,H()}):H()}function L(A,N){_(N)}function F(A){if(A.state==i.STARTED)y=+new Date;else if(A.state==i.STOPPED)for(var N=A.files.length-1;N>=0;N--)A.files[N].status==i.UPLOADING&&(A.files[N].status=i.QUEUED,R())}function q(){h&&h.abort()}function W(A){R(),p(function(){v.call(A)},1)}function z(A,N){N.code===i.INIT_ERROR?A.destroy():N.code===i.HTTP_ERROR&&(N.file.status=i.FAILED,N.file.completeTimestamp=+new Date,_(N.file),A.state==i.STARTED&&(A.trigger("CancelUpload"),p(function(){v.call(A)},1)))}function G(A){A.stop(),i.each(l,function(N){N.destroy()}),l=[],f.length&&(i.each(f,function(N){N.destroy()}),f=[]),u.length&&(i.each(u,function(N){N.destroy()}),u=[]),s={},g=!1,y=h=null,w.reset()}o={chunk_size:0,file_data_name:"file",filters:{mime_types:[],max_file_size:0,prevent_duplicates:!1,prevent_empty:!0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:!0,multi_selection:!0,resize:!1,runtimes:E.order,send_file_name:!0,send_chunk_number:!0,silverlight_xap_url:"js/Moxie.xap"},T.call(this,a,null,!0),w=new i.QueueProgress,i.extend(this,{id:c,uid:c,state:i.STOPPED,features:{},runtime:null,files:l,settings:o,total:w,init:function(){var A=this,N,U;if(N=A.getOption("preinit"),typeof N=="function"?N(A):i.each(N,function(B,j){A.bind(j,B)}),O.call(A),i.each(["container","browse_button","drop_element"],function(B){if(A.getOption(B)===null)return U={code:i.INIT_ERROR,message:i.sprintf(i.translate("%s specified, but cannot be found."),B)},!1}),U)return A.trigger("Error",U);if(!o.browse_button&&!o.drop_element)return A.trigger("Error",{code:i.INIT_ERROR,message:i.translate("You must specify either browse_button or drop_element.")});P.call(A,o,function(B){var j=A.getOption("init");typeof j=="function"?j(A):i.each(j,function(te,X){A.bind(X,te)}),B?(A.runtime=E.getInfo(S()).type,A.trigger("Init",{runtime:A.runtime}),A.trigger("PostInit")):A.trigger("Error",{code:i.INIT_ERROR,message:i.translate("Init error.")})})},setOption:function(A,N){T.call(this,A,N,!this.runtime)},getOption:function(A){return A?o[A]:o},refresh:function(){f.length&&i.each(f,function(A){A.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=i.STARTED&&(this.state=i.STARTED,this.trigger("StateChanged"),v.call(this))},stop:function(){this.state!=i.STOPPED&&(this.state=i.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){g=arguments[0]!==m?arguments[0]:!0,f.length&&i.each(f,function(A){A.disable(g)}),this.trigger("DisableBrowse",g)},getFile:function(A){var N;for(N=l.length-1;N>=0;N--)if(l[N].id===A)return l[N]},addFile:function(A,N){var U=this,B=[],j=[],te;function X(J,ne){var H=[];i.each(U.settings.filters,function(V,Z){b[Z]&&H.push(function(ie){b[Z].call(U,V,J,function(se){ie(!se)})})}),i.inSeries(H,ne)}function M(J){var ne=i.typeOf(J);if(J instanceof n.file.File){if(!J.ruid&&!J.isDetached()){if(!te)return!1;J.ruid=te,J.connectRuntime(te)}M(new i.File(J))}else J instanceof n.file.Blob?(M(J.getSource()),J.destroy()):J instanceof i.File?(N&&(J.name=N),B.push(function(H){X(J,function(V){V||(l.push(J),j.push(J),U.trigger("FileFiltered",J)),p(H,1)})})):i.inArray(ne,["file","blob"])!==-1?M(new n.file.File(null,J)):ne==="node"&&i.typeOf(J.files)==="filelist"?i.each(J.files,M):ne==="array"&&(N=null,i.each(J,M))}te=S(),M(A),B.length&&i.inSeries(B,function(){j.length&&U.trigger("FilesAdded",j)})},removeFile:function(A){for(var N=typeof A=="string"?A:A.id,U=l.length-1;U>=0;U--)if(l[U].id===N)return this.splice(U,1)[0]},splice:function(A,N){var U=l.splice(A===m?0:A,N===m?l.length:N),B=!1;return this.state==i.STARTED&&(i.each(U,function(j){if(j.status===i.UPLOADING)return B=!0,!1}),B&&this.stop()),this.trigger("FilesRemoved",U),i.each(U,function(j){j.destroy()}),B&&this.start(),U},dispatchEvent:function(A){var N,U;if(A=A.toLowerCase(),N=this.hasEventListener(A),N){N.sort(function(j,te){return te.priority-j.priority}),U=[].slice.call(arguments),U.shift(),U.unshift(this);for(var B=0;B<N.length;B++)if(N[B].fn.apply(N[B].scope,U)===!1)return!1}return!0},bind:function(A,N,U,B){i.Uploader.prototype.bind.call(this,A,N,B,U)},destroy:function(){this.trigger("Destroy"),o=w=null,this.unbindAll()}})},i.Uploader.prototype=n.core.EventTarget.instance,i.File=function(){var a={};function c(o){i.extend(this,{id:i.guid(),name:o.name||o.fileName,type:o.type||"",relativePath:o.relativePath||"",size:o.fileSize||o.size,origSize:o.fileSize||o.size,loaded:0,percent:0,status:i.QUEUED,lastModifiedDate:o.lastModifiedDate||new Date().toLocaleString(),completeTimestamp:0,getNative:function(){var l=this.getSource().getSource();return i.inArray(i.typeOf(l),["blob","file"])!==-1?l:null},getSource:function(){return a[this.id]?a[this.id]:null},destroy:function(){var l=this.getSource();l&&(l.destroy(),delete a[this.id])}}),a[this.id]=o}return c}(),i.QueueProgress=function(){var a=this;a.size=0,a.loaded=0,a.uploaded=0,a.failed=0,a.queued=0,a.percent=0,a.bytesPerSec=0,a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},r.plupload=i})(this,t)})})(jn);var bo=jn.exports;const wo=Hn(bo),rt="uploadState";function vo(e,t){return new Promise((r,n)=>{const b=e.transaction([rt],"readwrite").objectStore(rt).put(t);b.onsuccess=()=>r(),b.onerror=()=>n(b.error)})}function xo(e,t){return new Promise((r,n)=>{const b=e.transaction([rt],"readonly").objectStore(rt).get(t);b.onsuccess=()=>r(b.result),b.onerror=()=>n(b.error)})}function dr(e){return new Promise((t,r)=>{const n=indexedDB.deleteDatabase(e);n.onsuccess=()=>t(),n.onerror=()=>r(n.error),n.onblocked=()=>{r(new Error("数据库删除被阻塞，请关闭所有使用该数据库的页面后重试"))}})}class Ro{constructor(t={}){re(this,"file",null);re(this,"dbName","");re(this,"url","");re(this,"CHUNK_SIZE",0);re(this,"MAX_RETRIES",0);re(this,"events",{});re(this,"uploadState",new Map);re(this,"db",null);re(this,"browseButton",null);re(this,"file",null);const{url:r="",file:n,events:m={},uploadParams:p={},apiParams:b={},dbName:x}=t;this.dbName=x||`fileToolsUploadDB_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,this.url=r,this.events=m;const{success:E,uploading:d,error:i}=m,a=document.createElement("button");a.style.display="none",document.body.appendChild(a),this.browseButton=a,this.file=n,this.uploader=new wo.Uploader({url:r,browse_button:a,runtimes:"html5",max_retries:this.MAX_RETRIES,chunk_size:this.CHUNK_SIZE,multipart_params:{...b},...p,multi_selection:!0,multiple_queues:!0,init:{UploadFile:(c,o)=>{this.file=o},UploadProgress:(c,o)=>{d&&d(c==null?void 0:c.uid,o)},ChunkUploaded:async(c,o,l)=>{const s=l!=null&&l.response?JSON.parse(l.response):{};if((s==null?void 0:s.code)===0){const f=c.getFile(o.id),u={uploadedChunks:o.loaded,totalChunks:f==null?void 0:f.size,fileId:o.id};this.uploadState.set(o.id,u),this.db&&await vo(this.db,u)}else c==null||c.stop(),i&&i(c==null?void 0:c.uid,s)},FileUploaded:async(c,o,l)=>{const s=l!=null&&l.response?JSON.parse(l.response):{};(s==null?void 0:s.code)===0?E&&E(c==null?void 0:c.uid,s):i&&i(c==null?void 0:c.uid,s),this.uploadState.delete(o.id),this.dbName&&await dr(this.dbName)},UploadComplete:()=>{var c;(c=this.browseButton)==null||c.remove()},Error:async(c,o)=>{var l;i&&i(c==null?void 0:c.uid,o),this.dbName&&await dr(this.dbName),(l=this.browseButton)==null||l.remove()},BeforeUpload:(c,o,l)=>{}}}),this.uploader.init()}async initDB(){return new Promise((t,r)=>{const n=indexedDB.open(this.dbName,1);n.onupgradeneeded=m=>{const p=m.target.result;p.objectStoreNames.contains(rt)||p.createObjectStore(rt,{keyPath:"fileId"})},n.onsuccess=m=>{this.db=m.target.result,t()},n.onerror=m=>{r(m.target.error)}})}setOption(t){var r;(r=this.uploader)==null||r.setOption(t)}async start(t){var r;this.db||await this.initDB(),await So(100);try{this.uploader.addFile(t,t==null?void 0:t.name),(r=this.uploader)==null||r.start(t)}catch{}finally{}}async resume(){var t,r,n,m;if((t=this.file)!=null&&t.id){const p=await xo(this.db,this.file.id);if(p){this.file.loaded=p.uploadedChunks;const b=(n=this.uploader)==null?void 0:n.getFile((r=this.file)==null?void 0:r.id);b&&(b.loaded=p.uploadedChunks)}(m=this.uploader)==null||m.start()}}pause(){var t;(t=this.uploader)==null||t.stop()}async stop(){var t,r,n;if((t=this.uploader)==null||t.destroy(),this.file=null,this.db&&((r=this.db)==null||r.close(),this.db=null),this.dbName)try{await dr(this.dbName)}catch{}(n=this.browseButton)==null||n.remove()}}function So(e){return new Promise(t=>setTimeout(t,e))}var Wn={exports:{}};/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */(function(e){((t,r)=>{e.exports=r()})("streamSaver",()=>{const t=typeof window=="object"?window:this;t.HTMLElement;let r=null,n=!1;const m=l=>{try{l()}catch{}},p=t.WebStreamsPolyfill||{},b=t.isSecureContext;let x=/constructor/i.test(t.HTMLElement)||!!t.safari||!!t.WebKitPoint;const E=b||"MozAppearance"in document.documentElement.style?"iframe":"navigate",d={createWriteStream:o,WritableStream:t.WritableStream||p.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function i(l){if(!l)throw new Error("meh");const s=document.createElement("iframe");return s.hidden=!0,s.src=l,s.loaded=!1,s.name="iframe",s.isIframe=!0,s.postMessage=(...f)=>s.contentWindow.postMessage(...f),s.addEventListener("load",()=>{s.loaded=!0},{once:!0}),document.body.appendChild(s),s}function a(l){const s="width=200,height=100",f=document.createDocumentFragment(),u={frame:t.open(l,"popup",s),loaded:!1,isIframe:!1,isPopup:!0,remove(){u.frame.close()},addEventListener(...w){f.addEventListener(...w)},dispatchEvent(...w){f.dispatchEvent(...w)},removeEventListener(...w){f.removeEventListener(...w)},postMessage(...w){u.frame.postMessage(...w)}},y=w=>{w.source===u.frame&&(u.loaded=!0,t.removeEventListener("message",y),u.dispatchEvent(new Event("load")))};return t.addEventListener("message",y),u}try{new Response(new ReadableStream),b&&!("serviceWorker"in navigator)&&(x=!0)}catch{x=!0}m(()=>{const{readable:l}=new TransformStream,s=new MessageChannel;s.port1.postMessage(l,[l]),s.port1.close(),s.port2.close(),n=!0,Object.defineProperty(d,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function c(){r||(r=b?i(d.mitm):a(d.mitm))}function o(l,s,f){let u={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},y=0,w=null,g=null,h=null;if(Number.isFinite(s)?([f,s]=[s,f],u.size=f,u.writableStrategy=s):s&&s.highWaterMark?(u.size=f,u.writableStrategy=s):u=s||{},!x){c(),g=new MessageChannel,l=encodeURIComponent(l.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const _={transferringReadable:n,pathname:u.pathname||Math.random().toString().slice(-6)+"/"+l,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+l}};u.size&&(_.headers["Content-Length"]=u.size);const R=[_,"*",[g.port2]];if(n){const S=E==="iframe"?void 0:{transform(P,I){if(!(P instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");y+=P.length,I.enqueue(P),w&&(location.href=w,w=null)},flush(){w&&(location.href=w)}};h=new d.TransformStream(S,u.writableStrategy,u.readableStrategy);const O=h.readable;g.port1.postMessage({readableStream:O},[O])}g.port1.onmessage=S=>{S.data.download?E==="navigate"?(r.remove(),r=null,y?location.href=S.data.download:w=S.data.download):(r.isPopup&&(r.remove(),r=null,E==="iframe"&&i(d.mitm)),i(S.data.download)):S.data.abort&&(v=[],g.port1.postMessage("abort"),g.port1.onmessage=null,g.port1.close(),g.port2.close(),g=null)},r.loaded?r.postMessage(...R):r.addEventListener("load",()=>{r.postMessage(...R)},{once:!0})}let v=[];return!x&&h&&h.writable||new d.WritableStream({write(_){if(!(_ instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(x){v.push(_);return}g.port1.postMessage(_),y+=_.length,w&&(location.href=w,w=null)},close(){if(x){const _=new Blob(v,{type:"application/octet-stream; charset=utf-8"}),R=document.createElement("a");R.href=URL.createObjectURL(_),R.download=l,R.click()}else g.port1.postMessage("end")},abort(){v=[],g.port1.postMessage("abort"),g.port1.onmessage=null,g.port1.close(),g.port2.close(),g=null}},u.writableStrategy)}return d})})(Wn);var Eo=Wn.exports;const jt=Hn(Eo);/**
 * @license
 * web-streams-polyfill v4.1.0
 * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */function _t(){}function ae(e){return typeof e=="object"&&e!==null||typeof e=="function"}const Gn=_t;function K(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}const Ur=Promise,To=Promise.resolve.bind(Ur),Ao=Promise.prototype.then,Oo=Promise.reject.bind(Ur),Co=To;function ue(e){return new Ur(e)}function Q(e){return ue(t=>t(e))}function $(e){return Oo(e)}function be(e,t,r){return Ao.call(e,t,r)}function ge(e,t,r){be(be(e,t,r),void 0,Gn)}function hr(e,t){ge(e,t)}function Sr(e,t){ge(e,void 0,t)}function je(e,t,r){return be(e,t,r)}function vt(e){be(e,void 0,Gn)}let We=e=>{if(typeof queueMicrotask=="function")We=queueMicrotask;else{const t=Q(void 0);We=r=>be(t,r)}return We(e)};function nt(e,t,r){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function at(e,t,r){try{return Q(nt(e,t,r))}catch(n){return $(n)}}class he{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){const r=this._back;let n=r;r._elements.length===16383&&(n={_elements:[],_next:void 0}),r._elements.push(t),n!==r&&(this._back=n,r._next=n),++this._size}shift(){const t=this._front;let r=t;const n=this._cursor;let m=n+1;const p=t._elements,b=p[n];return m===16384&&(r=t._next,m=0),--this._size,this._cursor=m,t!==r&&(this._front=r),p[n]=void 0,b}forEach(t){let r=this._cursor,n=this._front,m=n._elements;for(;!(r===m.length&&n._next===void 0||r===m.length&&(n=n._next,m=n._elements,r=0,m.length===0));)t(m[r]),++r}peek(){const t=this._front,r=this._cursor;return t._elements[r]}}const $n=Symbol("[[AbortSteps]]"),Vn=Symbol("[[ErrorSteps]]"),Br=Symbol("[[CancelSteps]]"),Hr=Symbol("[[PullSteps]]"),jr=Symbol("[[ReleaseSteps]]");function Xn(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?Er(e):t._state==="closed"?function(r){Er(r),Yn(r)}(e):Jn(e,t._storedError)}function Wr(e,t){return me(e._ownerReadableStream,t)}function xe(e){const t=e._ownerReadableStream;t._state==="readable"?Gr(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):function(r,n){Jn(r,n)}(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[jr](),t._reader=void 0,e._ownerReadableStream=void 0}function Wt(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function Er(e){e._closedPromise=ue((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r})}function Jn(e,t){Er(e),Gr(e,t)}function Gr(e,t){e._closedPromise_reject!==void 0&&(vt(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function Yn(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}const pn=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},Io=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function Oe(e,t){if(e!==void 0&&typeof(r=e)!="object"&&typeof r!="function")throw new TypeError(`${t} is not an object.`);var r}function Pe(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function Kn(e,t){if(!function(r){return typeof r=="object"&&r!==null||typeof r=="function"}(e))throw new TypeError(`${t} is not an object.`)}function Ge(e,t,r){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${r}'.`)}function gn(e,t,r){if(e===void 0)throw new TypeError(`${t} is required in '${r}'.`)}function Zn(e){return Number(e)}function _n(e){return e===0?0:e}function $r(e,t){const r=Number.MAX_SAFE_INTEGER;let n=Number(e);if(n=_n(n),!pn(n))throw new TypeError(`${t} is not a finite number`);if(n=function(m){return _n(Io(m))}(n),n<0||n>r)throw new TypeError(`${t} is outside the accepted range of 0 to ${r}, inclusive`);return pn(n)&&n!==0?n:0}function Vr(e,t){if(!Se(e))throw new TypeError(`${t} is not a ReadableStream.`)}function Qe(e){return new Me(e)}function Qn(e,t){e._reader._readRequests.push(t)}function Xr(e,t,r){const n=e._reader._readRequests.shift();r?n._closeSteps():n._chunkSteps(t)}function Qt(e){return e._reader._readRequests.length}function ei(e){const t=e._reader;return t!==void 0&&!!Ce(t)}class Me{constructor(t){if(Ge(t,1,"ReadableStreamDefaultReader"),Vr(t,"First parameter"),Ie(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Xn(this,t),this._readRequests=new he}get closed(){return Ce(this)?this._closedPromise:$(Et("closed"))}cancel(t=void 0){return Ce(this)?this._ownerReadableStream===void 0?$(Wt("cancel")):Wr(this,t):$(Et("cancel"))}read(){if(!Ce(this))return $(Et("read"));if(this._ownerReadableStream===void 0)return $(Wt("read from"));let t,r;const n=ue((m,p)=>{t=m,r=p});return yt(this,{_chunkSteps:m=>t({value:m,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:m=>r(m)}),n}releaseLock(){if(!Ce(this))throw Et("releaseLock");this._ownerReadableStream!==void 0&&function(t){xe(t);const r=new TypeError("Reader was released");ti(t,r)}(this)}}function Ce(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")&&e instanceof Me}function yt(e,t){const r=e._ownerReadableStream;r._disturbed=!0,r._state==="closed"?t._closeSteps():r._state==="errored"?t._errorSteps(r._storedError):r._readableStreamController[Hr](t)}function ti(e,t){const r=e._readRequests;e._readRequests=new he,r.forEach(n=>{n._errorSteps(t)})}function Et(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}var mr,pr,gr;function ht(e){return e.slice()}function ri(e,t,r,n,m){new Uint8Array(e).set(new Uint8Array(r,n,m),t)}Object.defineProperties(Me.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),K(Me.prototype.cancel,"cancel"),K(Me.prototype.read,"read"),K(Me.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Me.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});let $e=e=>($e=typeof e.transfer=="function"?t=>t.transfer():typeof structuredClone=="function"?t=>structuredClone(t,{transfer:[t]}):t=>t,$e(e)),Ve=e=>(Ve=typeof e.detached=="boolean"?t=>t.detached:t=>t.byteLength===0,Ve(e));function ni(e,t,r){if(e.slice)return e.slice(t,r);const n=r-t,m=new ArrayBuffer(n);return ri(m,0,e,t,n),m}function mt(e,t){const r=e[t];if(r!=null){if(typeof r!="function")throw new TypeError(`${String(t)} is not a function`);return r}}function yn(e){try{const t=e.done,r=e.value;return be(Co(r),n=>({done:t,value:n}))}catch(t){return $(t)}}const xt=(gr=(mr=Symbol.asyncIterator)!==null&&mr!==void 0?mr:(pr=Symbol.for)===null||pr===void 0?void 0:pr.call(Symbol,"Symbol.asyncIterator"))!==null&&gr!==void 0?gr:"@@asyncIterator";function ii(e,t="sync",r){if(r===void 0)if(t==="async"){if((r=mt(e,xt))===void 0)return function(m){const p={next(){let b;try{b=oi(m)}catch(x){return $(x)}return yn(b)},return(b){let x;try{const E=mt(m.iterator,"return");if(E===void 0)return Q({done:!0,value:b});x=nt(E,m.iterator,[b])}catch(E){return $(E)}return ae(x)?yn(x):$(new TypeError("The iterator.return() method must return an object"))}};return{iterator:p,nextMethod:p.next,done:!1}}(ii(e,"sync",mt(e,Symbol.iterator)))}else r=mt(e,Symbol.iterator);if(r===void 0)throw new TypeError("The object is not iterable");const n=nt(r,e,[]);if(!ae(n))throw new TypeError("The iterator method must return an object");return{iterator:n,nextMethod:n.next,done:!1}}function oi(e){const t=nt(e.nextMethod,e.iterator,[]);if(!ae(t))throw new TypeError("The iterator.next() method must return an object");return t}class si{constructor(t,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=r}next(){const t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?je(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){const r=()=>this._returnSteps(t);return this._ongoingPromise=this._ongoingPromise?je(this._ongoingPromise,r,r):r(),this._ongoingPromise}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const t=this._reader;let r,n;const m=ue((p,b)=>{r=p,n=b});return yt(t,{_chunkSteps:p=>{this._ongoingPromise=void 0,We(()=>r({value:p,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,xe(t),r({value:void 0,done:!0})},_errorSteps:p=>{this._ongoingPromise=void 0,this._isFinished=!0,xe(t),n(p)}}),m}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;const r=this._reader;if(!this._preventCancel){const n=Wr(r,t);return xe(r),je(n,()=>({value:t,done:!0}))}return xe(r),Q({value:t,done:!0})}}const ai={next(){return bn(this)?this._asyncIteratorImpl.next():$(wn("next"))},return(e){return bn(this)?this._asyncIteratorImpl.return(e):$(wn("return"))},[xt](){return this}};function bn(e){if(!ae(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof si}catch{return!1}}function wn(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}Object.defineProperty(ai,xt,{enumerable:!1});const li=Number.isNaN||function(e){return e!=e};function vn(e){const t=ni(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Tr(e){const t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Jr(e,t,r){if(typeof(n=r)!="number"||li(n)||n<0||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");var n;e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function De(e){e._queue=new he,e._queueTotalSize=0}function ui(e){return e===DataView}class Ke{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!_r(this))throw yr("view");return this._view}respond(t){if(!_r(this))throw yr("respond");if(Ge(t,1,"respond"),t=$r(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ve(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");kt(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!_r(this))throw yr("respondWithNewView");if(Ge(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ve(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Mt(this._associatedReadableByteStreamController,t)}}Object.defineProperties(Ke.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),K(Ke.prototype.respond,"respond"),K(Ke.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ke.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Te{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!qe(this))throw ft("byobRequest");return Or(this)}get desiredSize(){if(!qe(this))throw ft("desiredSize");return wi(this)}close(){if(!qe(this))throw ft("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);pt(this)}enqueue(t){if(!qe(this))throw ft("enqueue");if(Ge(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError(`The stream (in ${r} state) is not in the readable state and cannot be enqueued to`);Lt(this,t)}error(t=void 0){if(!qe(this))throw ft("error");de(this,t)}[Br](t){ci(this),De(this);const r=this._cancelAlgorithm(t);return er(this),r}[Hr](t){const r=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void bi(this,t);const n=this._autoAllocateChunkSize;if(n!==void 0){let m;try{m=new ArrayBuffer(n)}catch(b){return void t._errorSteps(b)}const p={buffer:m,bufferByteLength:n,byteOffset:0,byteLength:n,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(p)}Qn(r,t),Je(this)}[jr](){if(this._pendingPullIntos.length>0){const t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new he,this._pendingPullIntos.push(t)}}}function qe(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")&&e instanceof Te}function _r(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")&&e instanceof Ke}function Je(e){if(function(r){const n=r._controlledReadableByteStream;return n._state!=="readable"||r._closeRequested||!r._started?!1:!!(ei(n)&&Qt(n)>0||Kr(n)&&Ri(n)>0||wi(r)>0)}(e)){if(e._pulling)return void(e._pullAgain=!0);e._pulling=!0,ge(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Je(e)),null),r=>(de(e,r),null))}}function ci(e){Yr(e),e._pendingPullIntos=new he}function fi(e,t){let r=!1;e._state==="closed"&&(r=!0);const n=di(t);t.readerType==="default"?Xr(e,n,r):function(m,p,b){const x=m._reader,E=x._readIntoRequests.shift();b?E._closeSteps(p):E._chunkSteps(p)}(e,n,r)}function Dt(e,t){for(let r=0;r<t.length;++r)fi(e,t[r])}function di(e){const t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function Nt(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function hi(e,t,r,n){let m;try{m=ni(t,r,r+n)}catch(p){throw de(e,p),p}Nt(e,m,0,n)}function mi(e,t){t.bytesFilled>0&&hi(e,t.buffer,t.byteOffset,t.bytesFilled),et(e)}function pi(e,t){const r=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),n=t.bytesFilled+r;let m=r,p=!1;const b=n-n%t.elementSize;b>=t.minimumFill&&(m=b-t.bytesFilled,p=!0);const x=e._queue;for(;m>0;){const E=x.peek(),d=Math.min(m,E.byteLength),i=t.byteOffset+t.bytesFilled;ri(t.buffer,i,E.buffer,E.byteOffset,d),E.byteLength===d?x.shift():(E.byteOffset+=d,E.byteLength-=d),e._queueTotalSize-=d,gi(e,d,t),m-=d}return p}function gi(e,t,r){r.bytesFilled+=t}function _i(e){e._queueTotalSize===0&&e._closeRequested?(er(e),Rt(e._controlledReadableByteStream)):Je(e)}function Yr(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Ar(e){const t=[];for(;e._pendingPullIntos.length>0&&e._queueTotalSize!==0;){const r=e._pendingPullIntos.peek();pi(e,r)&&(et(e),t.push(r))}return t}function Fo(e,t,r,n){const m=e._controlledReadableByteStream,p=t.constructor,b=function(c){return ui(c)?1:c.BYTES_PER_ELEMENT}(p),{byteOffset:x,byteLength:E}=t,d=r*b;let i;try{i=$e(t.buffer)}catch(c){return void n._errorSteps(c)}const a={buffer:i,bufferByteLength:i.byteLength,byteOffset:x,byteLength:E,bytesFilled:0,minimumFill:d,elementSize:b,viewConstructor:p,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(a),void xn(m,n);if(m._state!=="closed"){if(e._queueTotalSize>0){if(pi(e,a)){const c=di(a);return _i(e),void n._chunkSteps(c)}if(e._closeRequested){const c=new TypeError("Insufficient bytes to fill elements in the given buffer");return de(e,c),void n._errorSteps(c)}}e._pendingPullIntos.push(a),xn(m,n),Je(e)}else{const c=new p(a.buffer,a.byteOffset,0);n._closeSteps(c)}}function yi(e,t){const r=e._pendingPullIntos.peek();Yr(e),e._controlledReadableByteStream._state==="closed"?function(n,m){m.readerType==="none"&&et(n);const p=n._controlledReadableByteStream;if(Kr(p)){const b=[];for(let x=0;x<Ri(p);++x)b.push(et(n));Dt(p,b)}}(e,r):function(n,m,p){if(gi(0,m,p),p.readerType==="none"){mi(n,p);const E=Ar(n);return void Dt(n._controlledReadableByteStream,E)}if(p.bytesFilled<p.minimumFill)return;et(n);const b=p.bytesFilled%p.elementSize;if(b>0){const E=p.byteOffset+p.bytesFilled;hi(n,p.buffer,E-b,b)}p.bytesFilled-=b;const x=Ar(n);fi(n._controlledReadableByteStream,p),Dt(n._controlledReadableByteStream,x)}(e,t,r),Je(e)}function et(e){return e._pendingPullIntos.shift()}function er(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function pt(e){const t=e._controlledReadableByteStream;if(!e._closeRequested&&t._state==="readable")if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0){const r=e._pendingPullIntos.peek();if(r.bytesFilled%r.elementSize!=0){const n=new TypeError("Insufficient bytes to fill elements in the given buffer");throw de(e,n),n}}er(e),Rt(t)}}function Lt(e,t){const r=e._controlledReadableByteStream;if(e._closeRequested||r._state!=="readable")return;const{buffer:n,byteOffset:m,byteLength:p}=t;if(Ve(n))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");const b=$e(n);if(e._pendingPullIntos.length>0){const x=e._pendingPullIntos.peek();if(Ve(x.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Yr(e),x.buffer=$e(x.buffer),x.readerType==="none"&&mi(e,x)}if(ei(r))(function(x){const E=x._controlledReadableByteStream._reader;for(;E._readRequests.length>0;){if(x._queueTotalSize===0)return;bi(x,E._readRequests.shift())}})(e),Qt(r)===0?Nt(e,b,m,p):(e._pendingPullIntos.length>0&&et(e),Xr(r,new Uint8Array(b,m,p),!1));else if(Kr(r)){Nt(e,b,m,p);const x=Ar(e);Dt(e._controlledReadableByteStream,x)}else Nt(e,b,m,p);Je(e)}function de(e,t){const r=e._controlledReadableByteStream;r._state==="readable"&&(ci(e),De(e),er(e),ji(r,t))}function bi(e,t){const r=e._queue.shift();e._queueTotalSize-=r.byteLength,_i(e);const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);t._chunkSteps(n)}function Or(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),n=Object.create(Ke.prototype);(function(m,p,b){m._associatedReadableByteStreamController=p,m._view=b})(n,e,r),e._byobRequest=n}return e._byobRequest}function wi(e){const t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function kt(e,t){const r=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=$e(r.buffer),yi(e,t)}function Mt(e,t){const r=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const n=t.byteLength;r.buffer=$e(t.buffer),yi(e,n)}function vi(e,t,r,n,m,p,b){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,De(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=p,t._pullAlgorithm=n,t._cancelAlgorithm=m,t._autoAllocateChunkSize=b,t._pendingPullIntos=new he,e._readableStreamController=t,ge(Q(r()),()=>(t._started=!0,Je(t),null),x=>(de(t,x),null))}function yr(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function ft(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function Po(e,t){if((e=`${e}`)!="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function xi(e){return new ze(e)}function xn(e,t){e._reader._readIntoRequests.push(t)}function Ri(e){return e._reader._readIntoRequests.length}function Kr(e){const t=e._reader;return t!==void 0&&!!Be(t)}Object.defineProperties(Te.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),K(Te.prototype.close,"close"),K(Te.prototype.enqueue,"enqueue"),K(Te.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Te.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class ze{constructor(t){if(Ge(t,1,"ReadableStreamBYOBReader"),Vr(t,"First parameter"),Ie(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!qe(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Xn(this,t),this._readIntoRequests=new he}get closed(){return Be(this)?this._closedPromise:$(Tt("closed"))}cancel(t=void 0){return Be(this)?this._ownerReadableStream===void 0?$(Wt("cancel")):Wr(this,t):$(Tt("cancel"))}read(t,r={}){if(!Be(this))return $(Tt("read"));if(!ArrayBuffer.isView(t))return $(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return $(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return $(new TypeError("view's buffer must have non-zero byteLength"));if(Ve(t.buffer))return $(new TypeError("view's buffer has been detached"));let n;try{n=function(E,d){var i;return Oe(E,d),{min:$r((i=E==null?void 0:E.min)!==null&&i!==void 0?i:1,`${d} has member 'min' that`)}}(r,"options")}catch(E){return $(E)}const m=n.min;if(m===0)return $(new TypeError("options.min must be greater than 0"));if(function(E){return ui(E.constructor)}(t)){if(m>t.byteLength)return $(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(m>t.length)return $(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return $(Wt("read from"));let p,b;const x=ue((E,d)=>{p=E,b=d});return Si(this,t,m,{_chunkSteps:E=>p({value:E,done:!1}),_closeSteps:E=>p({value:E,done:!0}),_errorSteps:E=>b(E)}),x}releaseLock(){if(!Be(this))throw Tt("releaseLock");this._ownerReadableStream!==void 0&&function(t){xe(t);const r=new TypeError("Reader was released");Ei(t,r)}(this)}}function Be(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")&&e instanceof ze}function Si(e,t,r,n){const m=e._ownerReadableStream;m._disturbed=!0,m._state==="errored"?n._errorSteps(m._storedError):Fo(m._readableStreamController,t,r,n)}function Ei(e,t){const r=e._readIntoRequests;e._readIntoRequests=new he,r.forEach(n=>{n._errorSteps(t)})}function Tt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function Cr(e,t){const{highWaterMark:r}=e;if(r===void 0)return t;if(li(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function Ti(e){const{size:t}=e;return t||(()=>1)}function Ai(e,t){Oe(e,t);const r=e==null?void 0:e.highWaterMark,n=e==null?void 0:e.size;return{highWaterMark:r===void 0?void 0:Zn(r),size:n===void 0?void 0:Do(n,`${t} has member 'size' that`)}}function Do(e,t){return Pe(e,t),r=>Zn(e(r))}function No(e,t,r){return Pe(e,r),n=>at(e,t,[n])}function Lo(e,t,r){return Pe(e,r),()=>at(e,t,[])}function ko(e,t,r){return Pe(e,r),n=>nt(e,t,[n])}function Mo(e,t,r){return Pe(e,r),(n,m)=>at(e,t,[n,m])}function Oi(e,t){if(!Ze(e))throw new TypeError(`${t} is not a WritableStream.`)}Object.defineProperties(ze.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),K(ze.prototype.cancel,"cancel"),K(ze.prototype.read,"read"),K(ze.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ze.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});class Ue{constructor(t={},r={}){t===void 0?t=null:Kn(t,"First parameter");const n=Ai(r,"Second parameter"),m=function(b,x){Oe(b,x);const E=b==null?void 0:b.abort,d=b==null?void 0:b.close,i=b==null?void 0:b.start,a=b==null?void 0:b.type,c=b==null?void 0:b.write;return{abort:E===void 0?void 0:No(E,b,`${x} has member 'abort' that`),close:d===void 0?void 0:Lo(d,b,`${x} has member 'close' that`),start:i===void 0?void 0:ko(i,b,`${x} has member 'start' that`),write:c===void 0?void 0:Mo(c,b,`${x} has member 'write' that`),type:a}}(t,"First parameter");if(qo(this),m.type!==void 0)throw new RangeError("Invalid type is specified");const p=Ti(n);(function(b,x,E,d){const i=Object.create($t.prototype);let a,c,o,l;a=x.start!==void 0?()=>x.start(i):()=>{},c=x.write!==void 0?s=>x.write(s,i):()=>Q(void 0),o=x.close!==void 0?()=>x.close():()=>Q(void 0),l=x.abort!==void 0?s=>x.abort(s):()=>Q(void 0),Uo(b,i,a,c,o,l,E,d)})(this,m,Cr(n,1),p)}get locked(){if(!Ze(this))throw Ot("locked");return tt(this)}abort(t=void 0){return Ze(this)?tt(this)?$(new TypeError("Cannot abort a stream that already has a writer")):Gt(this,t):$(Ot("abort"))}close(){return Ze(this)?tt(this)?$(new TypeError("Cannot close a stream that already has a writer")):we(this)?$(new TypeError("Cannot close an already-closing stream")):Ii(this):$(Ot("close"))}getWriter(){if(!Ze(this))throw Ot("getWriter");return Ci(this)}}function Ci(e){return new Ee(e)}function qo(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new he,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function Ze(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")&&e instanceof Ue}function tt(e){return e._writer!==void 0}function Gt(e,t){var r;if(e._state==="closed"||e._state==="errored")return Q(void 0);e._writableStreamController._abortReason=t,(r=e._writableStreamController._abortController)===null||r===void 0||r.abort(t);const n=e._state;if(n==="closed"||n==="errored")return Q(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let m=!1;n==="erroring"&&(m=!0,t=void 0);const p=ue((b,x)=>{e._pendingAbortRequest={_promise:void 0,_resolve:b,_reject:x,_reason:t,_wasAlreadyErroring:m}});return e._pendingAbortRequest._promise=p,m||Zr(e,t),p}function Ii(e){const t=e._state;if(t==="closed"||t==="errored")return $(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));const r=ue((p,b)=>{const x={_resolve:p,_reject:b};e._closeRequest=x}),n=e._writer;var m;return n!==void 0&&e._backpressure&&t==="writable"&&nn(n),Jr(m=e._writableStreamController,Li,0),tr(m),r}function Ir(e,t){e._state!=="writable"?Qr(e):Zr(e,t)}function Zr(e,t){const r=e._writableStreamController;e._state="erroring",e._storedError=t;const n=e._writer;n!==void 0&&Pi(n,t),!function(m){return!(m._inFlightWriteRequest===void 0&&m._inFlightCloseRequest===void 0)}(e)&&r._started&&Qr(e)}function Qr(e){e._state="errored",e._writableStreamController[Vn]();const t=e._storedError;if(e._writeRequests.forEach(n=>{n._reject(t)}),e._writeRequests=new he,e._pendingAbortRequest===void 0)return void At(e);const r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(t),void At(e);ge(e._writableStreamController[$n](r._reason),()=>(r._resolve(),At(e),null),n=>(r._reject(n),At(e),null))}function we(e){return e._closeRequest!==void 0||e._inFlightCloseRequest!==void 0}function At(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);const t=e._writer;t!==void 0&&rn(t,e._storedError)}function en(e,t){const r=e._writer;r!==void 0&&t!==e._backpressure&&(t?function(n){rr(n)}(r):nn(r)),e._backpressure=t}Object.defineProperties(Ue.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),K(Ue.prototype.abort,"abort"),K(Ue.prototype.close,"close"),K(Ue.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ue.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});class Ee{constructor(t){if(Ge(t,1,"WritableStreamDefaultWriter"),Oi(t,"First parameter"),tt(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;const r=t._state;if(r==="writable")!we(t)&&t._backpressure?rr(this):Rn(this),qt(this);else if(r==="erroring")Pr(this,t._storedError),qt(this);else if(r==="closed")Rn(this),qt(n=this),zi(n);else{const m=t._storedError;Pr(this,m),qi(this,m)}var n}get closed(){return Ne(this)?this._closedPromise:$(Le("closed"))}get desiredSize(){if(!Ne(this))throw Le("desiredSize");if(this._ownerWritableStream===void 0)throw gt("desiredSize");return function(t){const r=t._ownerWritableStream,n=r._state;return n==="errored"||n==="erroring"?null:n==="closed"?0:ki(r._writableStreamController)}(this)}get ready(){return Ne(this)?this._readyPromise:$(Le("ready"))}abort(t=void 0){return Ne(this)?this._ownerWritableStream===void 0?$(gt("abort")):function(r,n){return Gt(r._ownerWritableStream,n)}(this,t):$(Le("abort"))}close(){if(!Ne(this))return $(Le("close"));const t=this._ownerWritableStream;return t===void 0?$(gt("close")):we(t)?$(new TypeError("Cannot close an already-closing stream")):Fi(this)}releaseLock(){if(!Ne(this))throw Le("releaseLock");this._ownerWritableStream!==void 0&&Di(this)}write(t=void 0){return Ne(this)?this._ownerWritableStream===void 0?$(gt("write to")):Ni(this,t):$(Le("write"))}}function Ne(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")&&e instanceof Ee}function Fi(e){return Ii(e._ownerWritableStream)}function zo(e,t){e._closedPromiseState==="pending"?rn(e,t):function(r,n){qi(r,n)}(e,t)}function Pi(e,t){e._readyPromiseState==="pending"?Ui(e,t):function(r,n){Pr(r,n)}(e,t)}function Di(e){const t=e._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Pi(e,r),zo(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function Ni(e,t){const r=e._ownerWritableStream,n=r._writableStreamController,m=function(x,E){if(x._strategySizeAlgorithm===void 0)return 1;try{return x._strategySizeAlgorithm(E)}catch(d){return Fr(x,d),1}}(n,t);if(r!==e._ownerWritableStream)return $(gt("write to"));const p=r._state;if(p==="errored")return $(r._storedError);if(we(r)||p==="closed")return $(new TypeError("The stream is closing or closed and cannot be written to"));if(p==="erroring")return $(r._storedError);const b=function(x){return ue((E,d)=>{const i={_resolve:E,_reject:d};x._writeRequests.push(i)})}(r);return function(x,E,d){try{Jr(x,E,d)}catch(a){return void Fr(x,a)}const i=x._controlledWritableStream;!we(i)&&i._state==="writable"&&en(i,tn(x)),tr(x)}(n,t,m),b}Object.defineProperties(Ee.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),K(Ee.prototype.abort,"abort"),K(Ee.prototype.close,"close"),K(Ee.prototype.releaseLock,"releaseLock"),K(Ee.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ee.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});const Li={};class $t{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!br(this))throw wr("abortReason");return this._abortReason}get signal(){if(!br(this))throw wr("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!br(this))throw wr("error");this._controlledWritableStream._state==="writable"&&Mi(this,t)}[$n](t){const r=this._abortAlgorithm(t);return Vt(this),r}[Vn](){De(this)}}function br(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")&&e instanceof $t}function Uo(e,t,r,n,m,p,b,x){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,De(t),t._abortReason=void 0,t._abortController=function(){if(typeof AbortController=="function")return new AbortController}(),t._started=!1,t._strategySizeAlgorithm=x,t._strategyHWM=b,t._writeAlgorithm=n,t._closeAlgorithm=m,t._abortAlgorithm=p;const E=tn(t);en(e,E),ge(Q(r()),()=>(t._started=!0,tr(t),null),d=>(t._started=!0,Ir(e,d),null))}function Vt(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ki(e){return e._strategyHWM-e._queueTotalSize}function tr(e){const t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring")return void Qr(t);if(e._queue.length===0)return;const r=e._queue.peek().value;r===Li?function(n){const m=n._controlledWritableStream;(function(b){b._inFlightCloseRequest=b._closeRequest,b._closeRequest=void 0})(m),Tr(n);const p=n._closeAlgorithm();Vt(n),ge(p,()=>(function(b){b._inFlightCloseRequest._resolve(void 0),b._inFlightCloseRequest=void 0,b._state==="erroring"&&(b._storedError=void 0,b._pendingAbortRequest!==void 0&&(b._pendingAbortRequest._resolve(),b._pendingAbortRequest=void 0)),b._state="closed";const x=b._writer;x!==void 0&&zi(x)}(m),null),b=>(function(x,E){x._inFlightCloseRequest._reject(E),x._inFlightCloseRequest=void 0,x._pendingAbortRequest!==void 0&&(x._pendingAbortRequest._reject(E),x._pendingAbortRequest=void 0),Ir(x,E)}(m,b),null))}(e):function(n,m){const p=n._controlledWritableStream;(function(x){x._inFlightWriteRequest=x._writeRequests.shift()})(p);const b=n._writeAlgorithm(m);ge(b,()=>{(function(E){E._inFlightWriteRequest._resolve(void 0),E._inFlightWriteRequest=void 0})(p);const x=p._state;if(Tr(n),!we(p)&&x==="writable"){const E=tn(n);en(p,E)}return tr(n),null},x=>(p._state==="writable"&&Vt(n),function(E,d){E._inFlightWriteRequest._reject(d),E._inFlightWriteRequest=void 0,Ir(E,d)}(p,x),null))}(e,r)}function Fr(e,t){e._controlledWritableStream._state==="writable"&&Mi(e,t)}function tn(e){return ki(e)<=0}function Mi(e,t){const r=e._controlledWritableStream;Vt(e),Zr(r,t)}function Ot(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function wr(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Le(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function gt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function qt(e){e._closedPromise=ue((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"})}function qi(e,t){qt(e),rn(e,t)}function rn(e,t){e._closedPromise_reject!==void 0&&(vt(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function zi(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function rr(e){e._readyPromise=ue((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r}),e._readyPromiseState="pending"}function Pr(e,t){rr(e),Ui(e,t)}function Rn(e){rr(e),nn(e)}function Ui(e,t){e._readyPromise_reject!==void 0&&(vt(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function nn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}Object.defineProperties($t.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($t.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});const Sn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0,Bo=function(){const e=Sn==null?void 0:Sn.DOMException;return function(t){if(typeof t!="function"&&typeof t!="object"||t.name!=="DOMException")return!1;try{return new t,!0}catch{return!1}}(e)?e:void 0}()||function(){const e=function(t,r){this.message=t||"",this.name=r||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return K(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}();function En(e,t,r,n,m,p){const b=Qe(e),x=Ci(t);e._disturbed=!0;let E=!1,d=Q(void 0);return ue((i,a)=>{let c;if(p!==void 0){if(c=()=>{const h=p.reason!==void 0?p.reason:new Bo("Aborted","AbortError"),v=[];n||v.push(()=>t._state==="writable"?Gt(t,h):Q(void 0)),m||v.push(()=>e._state==="readable"?me(e,h):Q(void 0)),y(()=>Promise.all(v.map(_=>_())),!0,h)},p.aborted)return void c();p.addEventListener("abort",c)}var o,l,s;if(u(e,b._closedPromise,h=>(n?w(!0,h):y(()=>Gt(t,h),!0,h),null)),u(t,x._closedPromise,h=>(m?w(!0,h):y(()=>me(e,h),!0,h),null)),o=e,l=b._closedPromise,s=()=>(r?w():y(()=>function(h){const v=h._ownerWritableStream,_=v._state;return we(v)||_==="closed"?Q(void 0):_==="errored"?$(v._storedError):Fi(h)}(x)),null),o._state==="closed"?s():hr(l,s),we(t)||t._state==="closed"){const h=new TypeError("the destination writable stream closed before all data could be piped to it");m?w(!0,h):y(()=>me(e,h),!0,h)}function f(){const h=d;return be(d,()=>h!==d?f():void 0)}function u(h,v,_){h._state==="errored"?_(h._storedError):Sr(v,_)}function y(h,v,_){function R(){return ge(h(),()=>g(v,_),S=>g(!0,S)),null}E||(E=!0,t._state!=="writable"||we(t)?R():hr(f(),R))}function w(h,v){E||(E=!0,t._state!=="writable"||we(t)?g(h,v):hr(f(),()=>g(h,v)))}function g(h,v){return Di(x),xe(b),p!==void 0&&p.removeEventListener("abort",c),h?a(v):i(void 0),null}vt(ue((h,v)=>{(function _(R){R?h():be(E?Q(!0):be(x._readyPromise,()=>ue((S,O)=>{yt(b,{_chunkSteps:P=>{d=be(Ni(x,P),void 0,_t),S(!1)},_closeSteps:()=>S(!0),_errorSteps:O})})),_,v)})(!1)}))})}class Ae{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ct(this))throw It("desiredSize");return on(this)}close(){if(!Ct(this))throw It("close");if(!st(this))throw new TypeError("The stream is not in a state that permits close");it(this)}enqueue(t=void 0){if(!Ct(this))throw It("enqueue");if(!st(this))throw new TypeError("The stream is not in a state that permits enqueue");return ot(this,t)}error(t=void 0){if(!Ct(this))throw It("error");Fe(this,t)}[Br](t){De(this);const r=this._cancelAlgorithm(t);return Xt(this),r}[Hr](t){const r=this._controlledReadableStream;if(this._queue.length>0){const n=Tr(this);this._closeRequested&&this._queue.length===0?(Xt(this),Rt(r)):bt(this),t._chunkSteps(n)}else Qn(r,t),bt(this)}[jr](){}}function Ct(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")&&e instanceof Ae}function bt(e){if(Bi(e)){if(e._pulling)return void(e._pullAgain=!0);e._pulling=!0,ge(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,bt(e)),null),t=>(Fe(e,t),null))}}function Bi(e){const t=e._controlledReadableStream;return!st(e)||!e._started?!1:Ie(t)&&Qt(t)>0?!0:on(e)>0}function Xt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function it(e){if(!st(e))return;const t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(Xt(e),Rt(t))}function ot(e,t){if(!st(e))return;const r=e._controlledReadableStream;if(Ie(r)&&Qt(r)>0)Xr(r,t,!1);else{let n;try{n=e._strategySizeAlgorithm(t)}catch(m){throw Fe(e,m),m}try{Jr(e,t,n)}catch(m){throw Fe(e,m),m}}bt(e)}function Fe(e,t){const r=e._controlledReadableStream;r._state==="readable"&&(De(e),Xt(e),ji(r,t))}function on(e){const t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function st(e){const t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function Hi(e,t,r,n,m,p,b){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,De(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=b,t._strategyHWM=p,t._pullAlgorithm=n,t._cancelAlgorithm=m,e._readableStreamController=t,ge(Q(r()),()=>(t._started=!0,bt(t),null),x=>(Fe(t,x),null))}function It(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function Ho(e,t){return qe(e._readableStreamController)?function(r){let n,m,p,b,x,E=Qe(r),d=!1,i=!1,a=!1,c=!1,o=!1;const l=ue(_=>{x=_});function s(_){Sr(_._closedPromise,R=>(_!==E||(de(p._readableStreamController,R),de(b._readableStreamController,R),c&&o||x(void 0)),null))}function f(){Be(E)&&(xe(E),E=Qe(r),s(E)),yt(E,{_chunkSteps:_=>{We(()=>{i=!1,a=!1;const R=_;let S=_;if(!c&&!o)try{S=vn(_)}catch(O){return de(p._readableStreamController,O),de(b._readableStreamController,O),void x(me(r,O))}c||Lt(p._readableStreamController,R),o||Lt(b._readableStreamController,S),d=!1,i?y():a&&w()})},_closeSteps:()=>{d=!1,c||pt(p._readableStreamController),o||pt(b._readableStreamController),p._readableStreamController._pendingPullIntos.length>0&&kt(p._readableStreamController,0),b._readableStreamController._pendingPullIntos.length>0&&kt(b._readableStreamController,0),c&&o||x(void 0)},_errorSteps:()=>{d=!1}})}function u(_,R){Ce(E)&&(xe(E),E=xi(r),s(E));const S=R?b:p,O=R?p:b;Si(E,_,1,{_chunkSteps:P=>{We(()=>{i=!1,a=!1;const I=R?o:c;if(R?c:o)I||Mt(S._readableStreamController,P);else{let T;try{T=vn(P)}catch(C){return de(S._readableStreamController,C),de(O._readableStreamController,C),void x(me(r,C))}I||Mt(S._readableStreamController,P),Lt(O._readableStreamController,T)}d=!1,i?y():a&&w()})},_closeSteps:P=>{d=!1;const I=R?o:c,T=R?c:o;I||pt(S._readableStreamController),T||pt(O._readableStreamController),P!==void 0&&(I||Mt(S._readableStreamController,P),!T&&O._readableStreamController._pendingPullIntos.length>0&&kt(O._readableStreamController,0)),I&&T||x(void 0)},_errorSteps:()=>{d=!1}})}function y(){if(d)return i=!0,Q(void 0);d=!0;const _=Or(p._readableStreamController);return _===null?f():u(_._view,!1),Q(void 0)}function w(){if(d)return a=!0,Q(void 0);d=!0;const _=Or(b._readableStreamController);return _===null?f():u(_._view,!0),Q(void 0)}function g(_){if(c=!0,n=_,o){const R=ht([n,m]),S=me(r,R);x(S)}return l}function h(_){if(o=!0,m=_,c){const R=ht([n,m]),S=me(r,R);x(S)}return l}function v(){}return p=An(v,y,g),b=An(v,w,h),s(E),[p,b]}(e):function(r,n){const m=Qe(r);let p,b,x,E,d,i=!1,a=!1,c=!1,o=!1;const l=ue(w=>{d=w});function s(){return i?(a=!0,Q(void 0)):(i=!0,yt(m,{_chunkSteps:w=>{We(()=>{a=!1;const g=w,h=w;c||ot(x._readableStreamController,g),o||ot(E._readableStreamController,h),i=!1,a&&s()})},_closeSteps:()=>{i=!1,c||it(x._readableStreamController),o||it(E._readableStreamController),c&&o||d(void 0)},_errorSteps:()=>{i=!1}}),Q(void 0))}function f(w){if(c=!0,p=w,o){const g=ht([p,b]),h=me(r,g);d(h)}return l}function u(w){if(o=!0,b=w,c){const g=ht([p,b]),h=me(r,g);d(h)}return l}function y(){}return x=Jt(y,s,f),E=Jt(y,s,u),Sr(m._closedPromise,w=>(Fe(x._readableStreamController,w),Fe(E._readableStreamController,w),c&&o||d(void 0),null)),[x,E]}(e)}function jo(e){return ae(t=e)&&t.getReader!==void 0?function(r){let n;function m(){let b;try{b=r.read()}catch(x){return $(x)}return je(b,x=>{if(!ae(x))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(x.done)it(n._readableStreamController);else{const E=x.value;ot(n._readableStreamController,E)}})}function p(b){try{return Q(r.cancel(b))}catch(x){return $(x)}}return n=Jt(_t,m,p,0),n}(e.getReader()):function(r){let n;const m=ii(r,"async");function p(){let x;try{x=oi(m)}catch(E){return $(E)}return je(Q(x),E=>{if(!ae(E))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(E.done)it(n._readableStreamController);else{const d=E.value;ot(n._readableStreamController,d)}})}function b(x){const E=m.iterator;let d;try{d=mt(E,"return")}catch(i){return $(i)}return d===void 0?Q(void 0):je(at(d,E,[x]),i=>{if(!ae(i))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return n=Jt(_t,p,b,0),n}(e);var t}function Wo(e,t,r){return Pe(e,r),n=>at(e,t,[n])}function Go(e,t,r){return Pe(e,r),n=>at(e,t,[n])}function $o(e,t,r){return Pe(e,r),n=>nt(e,t,[n])}function Vo(e,t){if((e=`${e}`)!="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Tn(e,t){Oe(e,t);const r=e==null?void 0:e.preventAbort,n=e==null?void 0:e.preventCancel,m=e==null?void 0:e.preventClose,p=e==null?void 0:e.signal;return p!==void 0&&function(b,x){if(!function(E){if(typeof E!="object"||E===null)return!1;try{return typeof E.aborted=="boolean"}catch{return!1}}(b))throw new TypeError(`${x} is not an AbortSignal.`)}(p,`${t} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!n,preventClose:!!m,signal:p}}Object.defineProperties(Ae.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),K(Ae.prototype.close,"close"),K(Ae.prototype.enqueue,"enqueue"),K(Ae.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ae.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});let ce=class{constructor(t={},r={}){t===void 0?t=null:Kn(t,"First parameter");const n=Ai(r,"Second parameter"),m=function(p,b){Oe(p,b);const x=p,E=x==null?void 0:x.autoAllocateChunkSize,d=x==null?void 0:x.cancel,i=x==null?void 0:x.pull,a=x==null?void 0:x.start,c=x==null?void 0:x.type;return{autoAllocateChunkSize:E===void 0?void 0:$r(E,`${b} has member 'autoAllocateChunkSize' that`),cancel:d===void 0?void 0:Wo(d,x,`${b} has member 'cancel' that`),pull:i===void 0?void 0:Go(i,x,`${b} has member 'pull' that`),start:a===void 0?void 0:$o(a,x,`${b} has member 'start' that`),type:c===void 0?void 0:Vo(c,`${b} has member 'type' that`)}}(t,"First parameter");if(sn(this),m.type==="bytes"){if(n.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");(function(p,b,x){const E=Object.create(Te.prototype);let d,i,a;d=b.start!==void 0?()=>b.start(E):()=>{},i=b.pull!==void 0?()=>b.pull(E):()=>Q(void 0),a=b.cancel!==void 0?o=>b.cancel(o):()=>Q(void 0);const c=b.autoAllocateChunkSize;if(c===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");vi(p,E,d,i,a,x,c)})(this,m,Cr(n,0))}else{const p=Ti(n);(function(b,x,E,d){const i=Object.create(Ae.prototype);let a,c,o;a=x.start!==void 0?()=>x.start(i):()=>{},c=x.pull!==void 0?()=>x.pull(i):()=>Q(void 0),o=x.cancel!==void 0?l=>x.cancel(l):()=>Q(void 0),Hi(b,i,a,c,o,E,d)})(this,m,Cr(n,1),p)}}get locked(){if(!Se(this))throw ke("locked");return Ie(this)}cancel(t=void 0){return Se(this)?Ie(this)?$(new TypeError("Cannot cancel a stream that already has a reader")):me(this,t):$(ke("cancel"))}getReader(t=void 0){if(!Se(this))throw ke("getReader");return function(r,n){Oe(r,n);const m=r==null?void 0:r.mode;return{mode:m===void 0?void 0:Po(m,`${n} has member 'mode' that`)}}(t,"First parameter").mode===void 0?Qe(this):xi(this)}pipeThrough(t,r={}){if(!Se(this))throw ke("pipeThrough");Ge(t,1,"pipeThrough");const n=function(p,b){Oe(p,b);const x=p==null?void 0:p.readable;gn(x,"readable","ReadableWritablePair"),Vr(x,`${b} has member 'readable' that`);const E=p==null?void 0:p.writable;return gn(E,"writable","ReadableWritablePair"),Oi(E,`${b} has member 'writable' that`),{readable:x,writable:E}}(t,"First parameter"),m=Tn(r,"Second parameter");if(Ie(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(tt(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return vt(En(this,n.writable,m.preventClose,m.preventAbort,m.preventCancel,m.signal)),n.readable}pipeTo(t,r={}){if(!Se(this))return $(ke("pipeTo"));if(t===void 0)return $("Parameter 1 is required in 'pipeTo'.");if(!Ze(t))return $(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let n;try{n=Tn(r,"Second parameter")}catch(m){return $(m)}return Ie(this)?$(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):tt(t)?$(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):En(this,t,n.preventClose,n.preventAbort,n.preventCancel,n.signal)}tee(){if(!Se(this))throw ke("tee");return ht(Ho(this))}values(t=void 0){if(!Se(this))throw ke("values");return function(r,n){const m=Qe(r),p=new si(m,n),b=Object.create(ai);return b._asyncIteratorImpl=p,b}(this,function(r,n){return Oe(r,n),{preventCancel:!!(r==null?void 0:r.preventCancel)}}(t,"First parameter").preventCancel)}[xt](t){return this.values(t)}static from(t){return jo(t)}};function Jt(e,t,r,n=1,m=()=>1){const p=Object.create(ce.prototype);return sn(p),Hi(p,Object.create(Ae.prototype),e,t,r,n,m),p}function An(e,t,r){const n=Object.create(ce.prototype);return sn(n),vi(n,Object.create(Te.prototype),e,t,r,0,void 0),n}function sn(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Se(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")&&e instanceof ce}function Ie(e){return e._reader!==void 0}function me(e,t){if(e._disturbed=!0,e._state==="closed")return Q(void 0);if(e._state==="errored")return $(e._storedError);Rt(e);const r=e._reader;if(r!==void 0&&Be(r)){const n=r._readIntoRequests;r._readIntoRequests=new he,n.forEach(m=>{m._closeSteps(void 0)})}return je(e._readableStreamController[Br](t),_t)}function Rt(e){e._state="closed";const t=e._reader;if(t!==void 0&&(Yn(t),Ce(t))){const r=t._readRequests;t._readRequests=new he,r.forEach(n=>{n._closeSteps()})}}function ji(e,t){e._state="errored",e._storedError=t;const r=e._reader;r!==void 0&&(Gr(r,t),Ce(r)?ti(r,t):Ei(r,t))}function ke(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}Object.defineProperties(ce,{from:{enumerable:!0}}),Object.defineProperties(ce.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),K(ce.from,"from"),K(ce.prototype.cancel,"cancel"),K(ce.prototype.getReader,"getReader"),K(ce.prototype.pipeThrough,"pipeThrough"),K(ce.prototype.pipeTo,"pipeTo"),K(ce.prototype.tee,"tee"),K(ce.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ce.prototype,xt,{value:ce.prototype.values,writable:!0,configurable:!0});const Xo=e=>e.byteLength;K(Xo,"size");const Jo=()=>1;K(Jo,"size");function Yo(e,t){Fe(e._readable._readableStreamController,t),an(e,t)}function an(e,t){Zo(e._transformStreamController),Fr(e._writable._writableStreamController,t),Ko(e)}function Ko(e){e._backpressure&&Wi(e,!1)}function Wi(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=ue(r=>{e._backpressureChangePromise_resolve=r}),e._backpressure=t}class Ye{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ft(this))throw Pt("desiredSize");return on(this._controlledTransformStream._readable._readableStreamController)}enqueue(t=void 0){if(!Ft(this))throw Pt("enqueue");Qo(this,t)}error(t=void 0){if(!Ft(this))throw Pt("error");var r;r=t,Yo(this._controlledTransformStream,r)}terminate(){if(!Ft(this))throw Pt("terminate");(function(t){const r=t._controlledTransformStream;it(r._readable._readableStreamController);const n=new TypeError("TransformStream terminated");an(r,n)})(this)}}function Ft(e){return!!ae(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")&&e instanceof Ye}function Zo(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function Qo(e,t){const r=e._controlledTransformStream,n=r._readable._readableStreamController;if(!st(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{ot(n,t)}catch(p){throw an(r,p),r._readable._storedError}(function(p){return!Bi(p)})(n)!==r._backpressure&&Wi(r,!0)}function Pt(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}Object.defineProperties(Ye.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),K(Ye.prototype.enqueue,"enqueue"),K(Ye.prototype.error,"error"),K(Ye.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Gi(e,t){return function(){return e.apply(t,arguments)}}const{toString:es}=Object.prototype,{getPrototypeOf:ln}=Object,{iterator:nr,toStringTag:$i}=Symbol,ir=(e=>t=>{const r=es.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),_e=e=>(e=e.toLowerCase(),t=>ir(t)===e),or=e=>t=>typeof t===e,{isArray:lt}=Array,wt=or("undefined");function ts(e){return e!==null&&!wt(e)&&e.constructor!==null&&!wt(e.constructor)&&fe(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Vi=_e("ArrayBuffer");function rs(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Vi(e.buffer),t}const ns=or("string"),fe=or("function"),Xi=or("number"),sr=e=>e!==null&&typeof e=="object",is=e=>e===!0||e===!1,zt=e=>{if(ir(e)!=="object")return!1;const t=ln(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!($i in e)&&!(nr in e)},os=_e("Date"),ss=_e("File"),as=_e("Blob"),ls=_e("FileList"),us=e=>sr(e)&&fe(e.pipe),cs=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||fe(e.append)&&((t=ir(e))==="formdata"||t==="object"&&fe(e.toString)&&e.toString()==="[object FormData]"))},fs=_e("URLSearchParams"),[ds,hs,ms,ps]=["ReadableStream","Request","Response","Headers"].map(_e),gs=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function St(e,t,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let n,m;if(typeof e!="object"&&(e=[e]),lt(e))for(n=0,m=e.length;n<m;n++)t.call(null,e[n],n,e);else{const p=r?Object.getOwnPropertyNames(e):Object.keys(e),b=p.length;let x;for(n=0;n<b;n++)x=p[n],t.call(null,e[x],x,e)}}function Ji(e,t){t=t.toLowerCase();const r=Object.keys(e);let n=r.length,m;for(;n-- >0;)if(m=r[n],t===m.toLowerCase())return m;return null}const He=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Yi=e=>!wt(e)&&e!==He;function Dr(){const{caseless:e}=Yi(this)&&this||{},t={},r=(n,m)=>{const p=e&&Ji(t,m)||m;zt(t[p])&&zt(n)?t[p]=Dr(t[p],n):zt(n)?t[p]=Dr({},n):lt(n)?t[p]=n.slice():t[p]=n};for(let n=0,m=arguments.length;n<m;n++)arguments[n]&&St(arguments[n],r);return t}const _s=(e,t,r,{allOwnKeys:n}={})=>(St(t,(m,p)=>{r&&fe(m)?e[p]=Gi(m,r):e[p]=m},{allOwnKeys:n}),e),ys=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),bs=(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},ws=(e,t,r,n)=>{let m,p,b;const x={};if(t=t||{},e==null)return t;do{for(m=Object.getOwnPropertyNames(e),p=m.length;p-- >0;)b=m[p],(!n||n(b,e,t))&&!x[b]&&(t[b]=e[b],x[b]=!0);e=r!==!1&&ln(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},vs=(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return n!==-1&&n===r},xs=e=>{if(!e)return null;if(lt(e))return e;let t=e.length;if(!Xi(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},Rs=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&ln(Uint8Array)),Ss=(e,t)=>{const n=(e&&e[nr]).call(e);let m;for(;(m=n.next())&&!m.done;){const p=m.value;t.call(e,p[0],p[1])}},Es=(e,t)=>{let r;const n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},Ts=_e("HTMLFormElement"),As=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,n,m){return n.toUpperCase()+m}),On=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),Os=_e("RegExp"),Ki=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};St(r,(m,p)=>{let b;(b=t(m,p,e))!==!1&&(n[p]=b||m)}),Object.defineProperties(e,n)},Cs=e=>{Ki(e,(t,r)=>{if(fe(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const n=e[r];if(fe(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Is=(e,t)=>{const r={},n=m=>{m.forEach(p=>{r[p]=!0})};return lt(e)?n(e):n(String(e).split(t)),r},Fs=()=>{},Ps=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Ds(e){return!!(e&&fe(e.append)&&e[$i]==="FormData"&&e[nr])}const Ns=e=>{const t=new Array(10),r=(n,m)=>{if(sr(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[m]=n;const p=lt(n)?[]:{};return St(n,(b,x)=>{const E=r(b,m+1);!wt(E)&&(p[x]=E)}),t[m]=void 0,p}}return n};return r(e,0)},Ls=_e("AsyncFunction"),ks=e=>e&&(sr(e)||fe(e))&&fe(e.then)&&fe(e.catch),Zi=((e,t)=>e?setImmediate:t?((r,n)=>(He.addEventListener("message",({source:m,data:p})=>{m===He&&p===r&&n.length&&n.shift()()},!1),m=>{n.push(m),He.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",fe(He.postMessage)),Ms=typeof queueMicrotask<"u"?queueMicrotask.bind(He):typeof process<"u"&&process.nextTick||Zi,qs=e=>e!=null&&fe(e[nr]),k={isArray:lt,isArrayBuffer:Vi,isBuffer:ts,isFormData:cs,isArrayBufferView:rs,isString:ns,isNumber:Xi,isBoolean:is,isObject:sr,isPlainObject:zt,isReadableStream:ds,isRequest:hs,isResponse:ms,isHeaders:ps,isUndefined:wt,isDate:os,isFile:ss,isBlob:as,isRegExp:Os,isFunction:fe,isStream:us,isURLSearchParams:fs,isTypedArray:Rs,isFileList:ls,forEach:St,merge:Dr,extend:_s,trim:gs,stripBOM:ys,inherits:bs,toFlatObject:ws,kindOf:ir,kindOfTest:_e,endsWith:vs,toArray:xs,forEachEntry:Ss,matchAll:Es,isHTMLForm:Ts,hasOwnProperty:On,hasOwnProp:On,reduceDescriptors:Ki,freezeMethods:Cs,toObjectSet:Is,toCamelCase:As,noop:Fs,toFiniteNumber:Ps,findKey:Ji,global:He,isContextDefined:Yi,isSpecCompliantForm:Ds,toJSONObject:Ns,isAsyncFn:Ls,isThenable:ks,setImmediate:Zi,asap:Ms,isIterable:qs};function Y(e,t,r,n,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),m&&(this.response=m,this.status=m.status?m.status:null)}k.inherits(Y,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.status}}});const Qi=Y.prototype,eo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eo[e]={value:e}});Object.defineProperties(Y,eo);Object.defineProperty(Qi,"isAxiosError",{value:!0});Y.from=(e,t,r,n,m,p)=>{const b=Object.create(Qi);return k.toFlatObject(e,b,function(E){return E!==Error.prototype},x=>x!=="isAxiosError"),Y.call(b,e.message,t,r,n,m),b.cause=e,b.name=e.name,p&&Object.assign(b,p),b};const zs=null;function Nr(e){return k.isPlainObject(e)||k.isArray(e)}function to(e){return k.endsWith(e,"[]")?e.slice(0,-2):e}function Cn(e,t,r){return e?e.concat(t).map(function(m,p){return m=to(m),!r&&p?"["+m+"]":m}).join(r?".":""):t}function Us(e){return k.isArray(e)&&!e.some(Nr)}const Bs=k.toFlatObject(k,{},null,function(t){return/^is[A-Z]/.test(t)});function ar(e,t,r){if(!k.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,r=k.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(s,f){return!k.isUndefined(f[s])});const n=r.metaTokens,m=r.visitor||i,p=r.dots,b=r.indexes,E=(r.Blob||typeof Blob<"u"&&Blob)&&k.isSpecCompliantForm(t);if(!k.isFunction(m))throw new TypeError("visitor must be a function");function d(l){if(l===null)return"";if(k.isDate(l))return l.toISOString();if(!E&&k.isBlob(l))throw new Y("Blob is not supported. Use a Buffer instead.");return k.isArrayBuffer(l)||k.isTypedArray(l)?E&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function i(l,s,f){let u=l;if(l&&!f&&typeof l=="object"){if(k.endsWith(s,"{}"))s=n?s:s.slice(0,-2),l=JSON.stringify(l);else if(k.isArray(l)&&Us(l)||(k.isFileList(l)||k.endsWith(s,"[]"))&&(u=k.toArray(l)))return s=to(s),u.forEach(function(w,g){!(k.isUndefined(w)||w===null)&&t.append(b===!0?Cn([s],g,p):b===null?s:s+"[]",d(w))}),!1}return Nr(l)?!0:(t.append(Cn(f,s,p),d(l)),!1)}const a=[],c=Object.assign(Bs,{defaultVisitor:i,convertValue:d,isVisitable:Nr});function o(l,s){if(!k.isUndefined(l)){if(a.indexOf(l)!==-1)throw Error("Circular reference detected in "+s.join("."));a.push(l),k.forEach(l,function(u,y){(!(k.isUndefined(u)||u===null)&&m.call(t,u,k.isString(y)?y.trim():y,s,c))===!0&&o(u,s?s.concat(y):[y])}),a.pop()}}if(!k.isObject(e))throw new TypeError("data must be an object");return o(e),t}function In(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function un(e,t){this._pairs=[],e&&ar(e,this,t)}const ro=un.prototype;ro.append=function(t,r){this._pairs.push([t,r])};ro.toString=function(t){const r=t?function(n){return t.call(this,n,In)}:In;return this._pairs.map(function(m){return r(m[0])+"="+r(m[1])},"").join("&")};function Hs(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function no(e,t,r){if(!t)return e;const n=r&&r.encode||Hs;k.isFunction(r)&&(r={serialize:r});const m=r&&r.serialize;let p;if(m?p=m(t,r):p=k.isURLSearchParams(t)?t.toString():new un(t,r).toString(n),p){const b=e.indexOf("#");b!==-1&&(e=e.slice(0,b)),e+=(e.indexOf("?")===-1?"?":"&")+p}return e}class js{constructor(){this.handlers=[]}use(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){k.forEach(this.handlers,function(n){n!==null&&t(n)})}}const Fn=js,io={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ws=typeof URLSearchParams<"u"?URLSearchParams:un,Gs=typeof FormData<"u"?FormData:null,$s=typeof Blob<"u"?Blob:null,Vs={isBrowser:!0,classes:{URLSearchParams:Ws,FormData:Gs,Blob:$s},protocols:["http","https","file","blob","url","data"]},cn=typeof window<"u"&&typeof document<"u",Lr=typeof navigator=="object"&&navigator||void 0,Xs=cn&&(!Lr||["ReactNative","NativeScript","NS"].indexOf(Lr.product)<0),Js=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Ys=cn&&window.location.href||"http://localhost",Ks=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:cn,hasStandardBrowserEnv:Xs,hasStandardBrowserWebWorkerEnv:Js,navigator:Lr,origin:Ys},Symbol.toStringTag,{value:"Module"})),le={...Ks,...Vs};function Zs(e,t){return ar(e,new le.classes.URLSearchParams,Object.assign({visitor:function(r,n,m,p){return le.isNode&&k.isBuffer(r)?(this.append(n,r.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},t))}function Qs(e){return k.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ea(e){const t={},r=Object.keys(e);let n;const m=r.length;let p;for(n=0;n<m;n++)p=r[n],t[p]=e[p];return t}function oo(e){function t(r,n,m,p){let b=r[p++];if(b==="__proto__")return!0;const x=Number.isFinite(+b),E=p>=r.length;return b=!b&&k.isArray(m)?m.length:b,E?(k.hasOwnProp(m,b)?m[b]=[m[b],n]:m[b]=n,!x):((!m[b]||!k.isObject(m[b]))&&(m[b]=[]),t(r,n,m[b],p)&&k.isArray(m[b])&&(m[b]=ea(m[b])),!x)}if(k.isFormData(e)&&k.isFunction(e.entries)){const r={};return k.forEachEntry(e,(n,m)=>{t(Qs(n),m,r,0)}),r}return null}function ta(e,t,r){if(k.isString(e))try{return(t||JSON.parse)(e),k.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}const fn={transitional:io,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const n=r.getContentType()||"",m=n.indexOf("application/json")>-1,p=k.isObject(t);if(p&&k.isHTMLForm(t)&&(t=new FormData(t)),k.isFormData(t))return m?JSON.stringify(oo(t)):t;if(k.isArrayBuffer(t)||k.isBuffer(t)||k.isStream(t)||k.isFile(t)||k.isBlob(t)||k.isReadableStream(t))return t;if(k.isArrayBufferView(t))return t.buffer;if(k.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let x;if(p){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Zs(t,this.formSerializer).toString();if((x=k.isFileList(t))||n.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return ar(x?{"files[]":t}:t,E&&new E,this.formSerializer)}}return p||m?(r.setContentType("application/json",!1),ta(t)):t}],transformResponse:[function(t){const r=this.transitional||fn.transitional,n=r&&r.forcedJSONParsing,m=this.responseType==="json";if(k.isResponse(t)||k.isReadableStream(t))return t;if(t&&k.isString(t)&&(n&&!this.responseType||m)){const b=!(r&&r.silentJSONParsing)&&m;try{return JSON.parse(t)}catch(x){if(b)throw x.name==="SyntaxError"?Y.from(x,Y.ERR_BAD_RESPONSE,this,null,this.response):x}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};k.forEach(["delete","get","head","post","put","patch"],e=>{fn.headers[e]={}});const dn=fn,ra=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),na=e=>{const t={};let r,n,m;return e&&e.split(`
`).forEach(function(b){m=b.indexOf(":"),r=b.substring(0,m).trim().toLowerCase(),n=b.substring(m+1).trim(),!(!r||t[r]&&ra[r])&&(r==="set-cookie"?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t},Pn=Symbol("internals");function dt(e){return e&&String(e).trim().toLowerCase()}function Ut(e){return e===!1||e==null?e:k.isArray(e)?e.map(Ut):String(e)}function ia(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}const oa=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function vr(e,t,r,n,m){if(k.isFunction(n))return n.call(this,t,r);if(m&&(t=r),!!k.isString(t)){if(k.isString(n))return t.indexOf(n)!==-1;if(k.isRegExp(n))return n.test(t)}}function sa(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,n)=>r.toUpperCase()+n)}function aa(e,t){const r=k.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(m,p,b){return this[n].call(this,t,m,p,b)},configurable:!0})})}class lr{constructor(t){t&&this.set(t)}set(t,r,n){const m=this;function p(x,E,d){const i=dt(E);if(!i)throw new Error("header name must be a non-empty string");const a=k.findKey(m,i);(!a||m[a]===void 0||d===!0||d===void 0&&m[a]!==!1)&&(m[a||E]=Ut(x))}const b=(x,E)=>k.forEach(x,(d,i)=>p(d,i,E));if(k.isPlainObject(t)||t instanceof this.constructor)b(t,r);else if(k.isString(t)&&(t=t.trim())&&!oa(t))b(na(t),r);else if(k.isObject(t)&&k.isIterable(t)){let x={},E,d;for(const i of t){if(!k.isArray(i))throw TypeError("Object iterator must return a key-value pair");x[d=i[0]]=(E=x[d])?k.isArray(E)?[...E,i[1]]:[E,i[1]]:i[1]}b(x,r)}else t!=null&&p(r,t,n);return this}get(t,r){if(t=dt(t),t){const n=k.findKey(this,t);if(n){const m=this[n];if(!r)return m;if(r===!0)return ia(m);if(k.isFunction(r))return r.call(this,m,n);if(k.isRegExp(r))return r.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=dt(t),t){const n=k.findKey(this,t);return!!(n&&this[n]!==void 0&&(!r||vr(this,this[n],n,r)))}return!1}delete(t,r){const n=this;let m=!1;function p(b){if(b=dt(b),b){const x=k.findKey(n,b);x&&(!r||vr(n,n[x],x,r))&&(delete n[x],m=!0)}}return k.isArray(t)?t.forEach(p):p(t),m}clear(t){const r=Object.keys(this);let n=r.length,m=!1;for(;n--;){const p=r[n];(!t||vr(this,this[p],p,t,!0))&&(delete this[p],m=!0)}return m}normalize(t){const r=this,n={};return k.forEach(this,(m,p)=>{const b=k.findKey(n,p);if(b){r[b]=Ut(m),delete r[p];return}const x=t?sa(p):String(p).trim();x!==p&&delete r[p],r[x]=Ut(m),n[x]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return k.forEach(this,(n,m)=>{n!=null&&n!==!1&&(r[m]=t&&k.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const n=new this(t);return r.forEach(m=>n.set(m)),n}static accessor(t){const n=(this[Pn]=this[Pn]={accessors:{}}).accessors,m=this.prototype;function p(b){const x=dt(b);n[x]||(aa(m,b),n[x]=!0)}return k.isArray(t)?t.forEach(p):p(t),this}}lr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);k.reduceDescriptors(lr.prototype,({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});k.freezeMethods(lr);const pe=lr;function xr(e,t){const r=this||dn,n=t||r,m=pe.from(n.headers);let p=n.data;return k.forEach(e,function(x){p=x.call(r,p,m.normalize(),t?t.status:void 0)}),m.normalize(),p}function so(e){return!!(e&&e.__CANCEL__)}function ut(e,t,r){Y.call(this,e??"canceled",Y.ERR_CANCELED,t,r),this.name="CanceledError"}k.inherits(ut,Y,{__CANCEL__:!0});function ao(e,t,r){const n=r.config.validateStatus;!r.status||!n||n(r.status)?e(r):t(new Y("Request failed with status code "+r.status,[Y.ERR_BAD_REQUEST,Y.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function la(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function ua(e,t){e=e||10;const r=new Array(e),n=new Array(e);let m=0,p=0,b;return t=t!==void 0?t:1e3,function(E){const d=Date.now(),i=n[p];b||(b=d),r[m]=E,n[m]=d;let a=p,c=0;for(;a!==m;)c+=r[a++],a=a%e;if(m=(m+1)%e,m===p&&(p=(p+1)%e),d-b<t)return;const o=i&&d-i;return o?Math.round(c*1e3/o):void 0}}function ca(e,t){let r=0,n=1e3/t,m,p;const b=(d,i=Date.now())=>{r=i,m=null,p&&(clearTimeout(p),p=null),e.apply(null,d)};return[(...d)=>{const i=Date.now(),a=i-r;a>=n?b(d,i):(m=d,p||(p=setTimeout(()=>{p=null,b(m)},n-a)))},()=>m&&b(m)]}const Yt=(e,t,r=3)=>{let n=0;const m=ua(50,250);return ca(p=>{const b=p.loaded,x=p.lengthComputable?p.total:void 0,E=b-n,d=m(E),i=b<=x;n=b;const a={loaded:b,total:x,progress:x?b/x:void 0,bytes:E,rate:d||void 0,estimated:d&&x&&i?(x-b)/d:void 0,event:p,lengthComputable:x!=null,[t?"download":"upload"]:!0};e(a)},r)},Dn=(e,t)=>{const r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Nn=e=>(...t)=>k.asap(()=>e(...t)),fa=le.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,le.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(le.origin),le.navigator&&/(msie|trident)/i.test(le.navigator.userAgent)):()=>!0,da=le.hasStandardBrowserEnv?{write(e,t,r,n,m,p){const b=[e+"="+encodeURIComponent(t)];k.isNumber(r)&&b.push("expires="+new Date(r).toGMTString()),k.isString(n)&&b.push("path="+n),k.isString(m)&&b.push("domain="+m),p===!0&&b.push("secure"),document.cookie=b.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ha(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function ma(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function lo(e,t,r){let n=!ha(t);return e&&(n||r==!1)?ma(e,t):t}const Ln=e=>e instanceof pe?{...e}:e;function Xe(e,t){t=t||{};const r={};function n(d,i,a,c){return k.isPlainObject(d)&&k.isPlainObject(i)?k.merge.call({caseless:c},d,i):k.isPlainObject(i)?k.merge({},i):k.isArray(i)?i.slice():i}function m(d,i,a,c){if(k.isUndefined(i)){if(!k.isUndefined(d))return n(void 0,d,a,c)}else return n(d,i,a,c)}function p(d,i){if(!k.isUndefined(i))return n(void 0,i)}function b(d,i){if(k.isUndefined(i)){if(!k.isUndefined(d))return n(void 0,d)}else return n(void 0,i)}function x(d,i,a){if(a in t)return n(d,i);if(a in e)return n(void 0,d)}const E={url:p,method:p,data:p,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,withXSRFToken:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:x,headers:(d,i,a)=>m(Ln(d),Ln(i),a,!0)};return k.forEach(Object.keys(Object.assign({},e,t)),function(i){const a=E[i]||m,c=a(e[i],t[i],i);k.isUndefined(c)&&a!==x||(r[i]=c)}),r}const uo=e=>{const t=Xe({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:m,xsrfCookieName:p,headers:b,auth:x}=t;t.headers=b=pe.from(b),t.url=no(lo(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),x&&b.set("Authorization","Basic "+btoa((x.username||"")+":"+(x.password?unescape(encodeURIComponent(x.password)):"")));let E;if(k.isFormData(r)){if(le.hasStandardBrowserEnv||le.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if((E=b.getContentType())!==!1){const[d,...i]=E?E.split(";").map(a=>a.trim()).filter(Boolean):[];b.setContentType([d||"multipart/form-data",...i].join("; "))}}if(le.hasStandardBrowserEnv&&(n&&k.isFunction(n)&&(n=n(t)),n||n!==!1&&fa(t.url))){const d=m&&p&&da.read(p);d&&b.set(m,d)}return t},pa=typeof XMLHttpRequest<"u",ga=pa&&function(e){return new Promise(function(r,n){const m=uo(e);let p=m.data;const b=pe.from(m.headers).normalize();let{responseType:x,onUploadProgress:E,onDownloadProgress:d}=m,i,a,c,o,l;function s(){o&&o(),l&&l(),m.cancelToken&&m.cancelToken.unsubscribe(i),m.signal&&m.signal.removeEventListener("abort",i)}let f=new XMLHttpRequest;f.open(m.method.toUpperCase(),m.url,!0),f.timeout=m.timeout;function u(){if(!f)return;const w=pe.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),h={data:!x||x==="text"||x==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:w,config:e,request:f};ao(function(_){r(_),s()},function(_){n(_),s()},h),f=null}"onloadend"in f?f.onloadend=u:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(u)},f.onabort=function(){f&&(n(new Y("Request aborted",Y.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new Y("Network Error",Y.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let g=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded";const h=m.transitional||io;m.timeoutErrorMessage&&(g=m.timeoutErrorMessage),n(new Y(g,h.clarifyTimeoutError?Y.ETIMEDOUT:Y.ECONNABORTED,e,f)),f=null},p===void 0&&b.setContentType(null),"setRequestHeader"in f&&k.forEach(b.toJSON(),function(g,h){f.setRequestHeader(h,g)}),k.isUndefined(m.withCredentials)||(f.withCredentials=!!m.withCredentials),x&&x!=="json"&&(f.responseType=m.responseType),d&&([c,l]=Yt(d,!0),f.addEventListener("progress",c)),E&&f.upload&&([a,o]=Yt(E),f.upload.addEventListener("progress",a),f.upload.addEventListener("loadend",o)),(m.cancelToken||m.signal)&&(i=w=>{f&&(n(!w||w.type?new ut(null,e,f):w),f.abort(),f=null)},m.cancelToken&&m.cancelToken.subscribe(i),m.signal&&(m.signal.aborted?i():m.signal.addEventListener("abort",i)));const y=la(m.url);if(y&&le.protocols.indexOf(y)===-1){n(new Y("Unsupported protocol "+y+":",Y.ERR_BAD_REQUEST,e));return}f.send(p||null)})},_a=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n=new AbortController,m;const p=function(d){if(!m){m=!0,x();const i=d instanceof Error?d:this.reason;n.abort(i instanceof Y?i:new ut(i instanceof Error?i.message:i))}};let b=t&&setTimeout(()=>{b=null,p(new Y(`timeout ${t} of ms exceeded`,Y.ETIMEDOUT))},t);const x=()=>{e&&(b&&clearTimeout(b),b=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(p):d.removeEventListener("abort",p)}),e=null)};e.forEach(d=>d.addEventListener("abort",p));const{signal:E}=n;return E.unsubscribe=()=>k.asap(x),E}},ya=_a,ba=function*(e,t){let r=e.byteLength;if(!t||r<t){yield e;return}let n=0,m;for(;n<r;)m=n+t,yield e.slice(n,m),n=m},wa=async function*(e,t){for await(const r of va(e))yield*ba(r,t)},va=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:r,value:n}=await t.read();if(r)break;yield n}}finally{await t.cancel()}},kn=(e,t,r,n)=>{const m=wa(e,t);let p=0,b,x=E=>{b||(b=!0,n&&n(E))};return new ReadableStream({async pull(E){try{const{done:d,value:i}=await m.next();if(d){x(),E.close();return}let a=i.byteLength;if(r){let c=p+=a;r(c)}E.enqueue(new Uint8Array(i))}catch(d){throw x(d),d}},cancel(E){return x(E),m.return()}},{highWaterMark:2})},ur=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",co=ur&&typeof ReadableStream=="function",xa=ur&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),fo=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Ra=co&&fo(()=>{let e=!1;const t=new Request(le.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Mn=64*1024,kr=co&&fo(()=>k.isReadableStream(new Response("").body)),Kt={stream:kr&&(e=>e.body)};ur&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Kt[t]&&(Kt[t]=k.isFunction(e[t])?r=>r[t]():(r,n)=>{throw new Y(`Response type '${t}' is not supported`,Y.ERR_NOT_SUPPORT,n)})})})(new Response);const Sa=async e=>{if(e==null)return 0;if(k.isBlob(e))return e.size;if(k.isSpecCompliantForm(e))return(await new Request(le.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(k.isArrayBufferView(e)||k.isArrayBuffer(e))return e.byteLength;if(k.isURLSearchParams(e)&&(e=e+""),k.isString(e))return(await xa(e)).byteLength},Ea=async(e,t)=>{const r=k.toFiniteNumber(e.getContentLength());return r??Sa(t)},Ta=ur&&(async e=>{let{url:t,method:r,data:n,signal:m,cancelToken:p,timeout:b,onDownloadProgress:x,onUploadProgress:E,responseType:d,headers:i,withCredentials:a="same-origin",fetchOptions:c}=uo(e);d=d?(d+"").toLowerCase():"text";let o=ya([m,p&&p.toAbortSignal()],b),l;const s=o&&o.unsubscribe&&(()=>{o.unsubscribe()});let f;try{if(E&&Ra&&r!=="get"&&r!=="head"&&(f=await Ea(i,n))!==0){let h=new Request(t,{method:"POST",body:n,duplex:"half"}),v;if(k.isFormData(n)&&(v=h.headers.get("content-type"))&&i.setContentType(v),h.body){const[_,R]=Dn(f,Yt(Nn(E)));n=kn(h.body,Mn,_,R)}}k.isString(a)||(a=a?"include":"omit");const u="credentials"in Request.prototype;l=new Request(t,{...c,signal:o,method:r.toUpperCase(),headers:i.normalize().toJSON(),body:n,duplex:"half",credentials:u?a:void 0});let y=await fetch(l);const w=kr&&(d==="stream"||d==="response");if(kr&&(x||w&&s)){const h={};["status","statusText","headers"].forEach(S=>{h[S]=y[S]});const v=k.toFiniteNumber(y.headers.get("content-length")),[_,R]=x&&Dn(v,Yt(Nn(x),!0))||[];y=new Response(kn(y.body,Mn,_,()=>{R&&R(),s&&s()}),h)}d=d||"text";let g=await Kt[k.findKey(Kt,d)||"text"](y,e);return!w&&s&&s(),await new Promise((h,v)=>{ao(h,v,{data:g,headers:pe.from(y.headers),status:y.status,statusText:y.statusText,config:e,request:l})})}catch(u){throw s&&s(),u&&u.name==="TypeError"&&/Load failed|fetch/i.test(u.message)?Object.assign(new Y("Network Error",Y.ERR_NETWORK,e,l),{cause:u.cause||u}):Y.from(u,u&&u.code,e,l)}}),Mr={http:zs,xhr:ga,fetch:Ta};k.forEach(Mr,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const qn=e=>`- ${e}`,Aa=e=>k.isFunction(e)||e===null||e===!1,ho={getAdapter:e=>{e=k.isArray(e)?e:[e];const{length:t}=e;let r,n;const m={};for(let p=0;p<t;p++){r=e[p];let b;if(n=r,!Aa(r)&&(n=Mr[(b=String(r)).toLowerCase()],n===void 0))throw new Y(`Unknown adapter '${b}'`);if(n)break;m[b||"#"+p]=n}if(!n){const p=Object.entries(m).map(([x,E])=>`adapter ${x} `+(E===!1?"is not supported by the environment":"is not available in the build"));let b=t?p.length>1?`since :
`+p.map(qn).join(`
`):" "+qn(p[0]):"as no adapter specified";throw new Y("There is no suitable adapter to dispatch the request "+b,"ERR_NOT_SUPPORT")}return n},adapters:Mr};function Rr(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ut(null,e)}function zn(e){return Rr(e),e.headers=pe.from(e.headers),e.data=xr.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),ho.getAdapter(e.adapter||dn.adapter)(e).then(function(n){return Rr(e),n.data=xr.call(e,e.transformResponse,n),n.headers=pe.from(n.headers),n},function(n){return so(n)||(Rr(e),n&&n.response&&(n.response.data=xr.call(e,e.transformResponse,n.response),n.response.headers=pe.from(n.response.headers))),Promise.reject(n)})}const mo="1.9.0",cr={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{cr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Un={};cr.transitional=function(t,r,n){function m(p,b){return"[Axios v"+mo+"] Transitional option '"+p+"'"+b+(n?". "+n:"")}return(p,b,x)=>{if(t===!1)throw new Y(m(b," has been removed"+(r?" in "+r:"")),Y.ERR_DEPRECATED);return r&&!Un[b]&&(Un[b]=!0),t?t(p,b,x):!0}};cr.spelling=function(t){return(r,n)=>!0};function Oa(e,t,r){if(typeof e!="object")throw new Y("options must be an object",Y.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let m=n.length;for(;m-- >0;){const p=n[m],b=t[p];if(b){const x=e[p],E=x===void 0||b(x,p,e);if(E!==!0)throw new Y("option "+p+" must be "+E,Y.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Y("Unknown option "+p,Y.ERR_BAD_OPTION)}}const Bt={assertOptions:Oa,validators:cr},ye=Bt.validators;class Zt{constructor(t){this.defaults=t||{},this.interceptors={request:new Fn,response:new Fn}}async request(t,r){try{return await this._request(t,r)}catch(n){if(n instanceof Error){let m={};Error.captureStackTrace?Error.captureStackTrace(m):m=new Error;const p=m.stack?m.stack.replace(/^.+\n/,""):"";try{n.stack?p&&!String(n.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+p):n.stack=p}catch{}}throw n}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=Xe(this.defaults,r);const{transitional:n,paramsSerializer:m,headers:p}=r;n!==void 0&&Bt.assertOptions(n,{silentJSONParsing:ye.transitional(ye.boolean),forcedJSONParsing:ye.transitional(ye.boolean),clarifyTimeoutError:ye.transitional(ye.boolean)},!1),m!=null&&(k.isFunction(m)?r.paramsSerializer={serialize:m}:Bt.assertOptions(m,{encode:ye.function,serialize:ye.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Bt.assertOptions(r,{baseUrl:ye.spelling("baseURL"),withXsrfToken:ye.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let b=p&&k.merge(p.common,p[r.method]);p&&k.forEach(["delete","get","head","post","put","patch","common"],l=>{delete p[l]}),r.headers=pe.concat(b,p);const x=[];let E=!0;this.interceptors.request.forEach(function(s){typeof s.runWhen=="function"&&s.runWhen(r)===!1||(E=E&&s.synchronous,x.unshift(s.fulfilled,s.rejected))});const d=[];this.interceptors.response.forEach(function(s){d.push(s.fulfilled,s.rejected)});let i,a=0,c;if(!E){const l=[zn.bind(this),void 0];for(l.unshift.apply(l,x),l.push.apply(l,d),c=l.length,i=Promise.resolve(r);a<c;)i=i.then(l[a++],l[a++]);return i}c=x.length;let o=r;for(a=0;a<c;){const l=x[a++],s=x[a++];try{o=l(o)}catch(f){s.call(this,f);break}}try{i=zn.call(this,o)}catch(l){return Promise.reject(l)}for(a=0,c=d.length;a<c;)i=i.then(d[a++],d[a++]);return i}getUri(t){t=Xe(this.defaults,t);const r=lo(t.baseURL,t.url,t.allowAbsoluteUrls);return no(r,t.params,t.paramsSerializer)}}k.forEach(["delete","get","head","options"],function(t){Zt.prototype[t]=function(r,n){return this.request(Xe(n||{},{method:t,url:r,data:(n||{}).data}))}});k.forEach(["post","put","patch"],function(t){function r(n){return function(p,b,x){return this.request(Xe(x||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:p,data:b}))}}Zt.prototype[t]=r(),Zt.prototype[t+"Form"]=r(!0)});const Ht=Zt;class hn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(p){r=p});const n=this;this.promise.then(m=>{if(!n._listeners)return;let p=n._listeners.length;for(;p-- >0;)n._listeners[p](m);n._listeners=null}),this.promise.then=m=>{let p;const b=new Promise(x=>{n.subscribe(x),p=x}).then(m);return b.cancel=function(){n.unsubscribe(p)},b},t(function(p,b,x){n.reason||(n.reason=new ut(p,b,x),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new hn(function(m){t=m}),cancel:t}}}const Ca=hn;function Ia(e){return function(r){return e.apply(null,r)}}function Fa(e){return k.isObject(e)&&e.isAxiosError===!0}const qr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qr).forEach(([e,t])=>{qr[t]=e});const Pa=qr;function po(e){const t=new Ht(e),r=Gi(Ht.prototype.request,t);return k.extend(r,Ht.prototype,t,{allOwnKeys:!0}),k.extend(r,t,null,{allOwnKeys:!0}),r.create=function(m){return po(Xe(e,m))},r}const oe=po(dn);oe.Axios=Ht;oe.CanceledError=ut;oe.CancelToken=Ca;oe.isCancel=so;oe.VERSION=mo;oe.toFormData=ar;oe.AxiosError=Y;oe.Cancel=oe.CanceledError;oe.all=function(t){return Promise.all(t)};oe.spread=Ia;oe.isAxiosError=Fa;oe.mergeConfig=Xe;oe.AxiosHeaders=pe;oe.formToJSON=e=>oo(k.isHTMLForm(e)?new FormData(e):e);oe.getAdapter=ho.getAdapter;oe.HttpStatusCode=Pa;oe.default=oe;const ve=oe;window!=null&&window.WritableStream||(jt.WritableStream=Ue);window.location.protocol==="https:"&&(jt.mitm="/mitm.html?version=2.0.0");ve.interceptors.response.use(e=>e,e=>{var r,n,m,p,b,x;const t={status:e.status??((r=e.response)==null?void 0:r.status)??((n=e==null?void 0:e.request)==null?void 0:n.status),code:(e==null?void 0:e.code)??((m=e==null?void 0:e.response)==null?void 0:m.code)??-1,message:(e==null?void 0:e.message)??((p=e==null?void 0:e.response)==null?void 0:p.message)??((b=e==null?void 0:e.request)==null?void 0:b.statusText)};if(e&&e.response)switch(e.response.status){case 400:t.message="请求错误";break;case 401:t.message="未授权，请登录";break;case 403:t.message="拒绝访问";break;case 404:t.message=`请求地址出错: ${e.response.config.url}`;break;case 408:t.message="请求超时";break;case 500:t.message="服务器内部错误";break;case 501:t.message="服务未实现";break;case 502:t.message="网关错误";break;case 503:t.message="服务不可用";break;case 504:t.message="网关超时";break;case 505:t.message="HTTP版本不受支持";break}else((x=e==null?void 0:e.stack)==null?void 0:x.indexOf("Network Error"))>-1?t.message="网络异常":t.message="请求错误";return(e!=null&&e.__CANCEL__||(e==null?void 0:e.code)==="ERR_CANCELED")&&(t.code=-99,t.message="请求中断"),Promise.reject(t)});class Da{constructor(t={}){re(this,"apiConfig",{});re(this,"downloaded",0);re(this,"chunks",[]);re(this,"isPaused",!1);re(this,"isStop",!1);re(this,"isCompleted",!1);re(this,"cancelTokenSource",null);re(this,"initPromise",null);re(this,"fileName",null);re(this,"writer",null);re(this,"stream",null);re(this,"db",null);re(this,"events",{});re(this,"totalSize",0);re(this,"chunkSize",0);re(this,"maxRetries",0);re(this,"mitmUrl",null);if(this.url=t==null?void 0:t.url,this.fileName=(t==null?void 0:t.fileName)??"downloaded_file",this.totalSize=Number((t==null?void 0:t.totalSize)??this.totalSize),this.chunkSize=Number((t==null?void 0:t.chunkSize)??this.chunkSize),this.maxRetries=Number((t==null?void 0:t.maxRetries)??this.maxRetries),this.totalSize<=0&&this.chunkSize!==0)throw new Error("totalSize必须为正整数");this.dbName=`fileToolsDownloadDB_${Na(this.url??String(Date.now()))}`,this.storeName=(t==null?void 0:t.storeName)??"chunks",this.initPromise=this.initDB(),this.events=(t==null?void 0:t.events)??{},this.apiConfig=(t==null?void 0:t.apiConfig)??{},this.mitmUrl=(t==null?void 0:t.mitmUrl)??null,this.mitmUrl&&(jt.mitm=this.mitmUrl)}async initDB(){return new Promise((t,r)=>{const n=indexedDB.open(this.dbName,1);n.onupgradeneeded=m=>{const p=m.target.result;p.objectStoreNames.contains(this.storeName)||p.createObjectStore(this.storeName,{keyPath:"index"})},n.onsuccess=m=>{this.db=m.target.result,t()},n.onerror=m=>{r(m.target.error)}})}async start(){var t;try{this.isCompleted=!1,await this.initPromise,this.isPaused=!1,this.isStop=!1,await this.loadChunksFromIndexedDB(),await this.downloadChunks()}catch(r){this.isPaused=!0,this.isCompleted=!1,(t=this.events)!=null&&t.error&&this.events.error(r)}}pause(){this.isPaused=!0,this.cancelTokenSource&&this.cancelTokenSource.cancel("下载已暂停")}resume(){var t,r;if(this.isPaused){this.isPaused=!1,this.isCompleted=!1,(t=this.events)!=null&&t.uploading&&this.events.uploading(this.getProgress());try{this.downloadChunks()}catch(n){this.isPaused=!0,(r=this.events)!=null&&r.error&&this.events.error(n)}}}stop(){var t,r;if(this.isStop=!0,this.isCompleted=!1,this.cancelTokenSource&&this.cancelTokenSource.cancel("下载已取消"),this.writer){try{typeof this.writer.abort=="function"?(t=this.writer)==null||t.abort():typeof this.writer.close=="function"&&((r=this.writer)==null||r.close())}catch{}this.writer=null,this.stream=null}this.clearChunksFromIndexedDB()}getProgress(){return{status:"uploading",downloaded:this.downloaded,total:this.totalSize,percent:Math.round(this.totalSize?this.downloaded/this.totalSize*100:0)}}async downloadChunks(){var r,n,m,p,b,x,E,d;if(this.writer||(this.stream=jt.createWriteStream(this.fileName,{size:this.totalSize}),this.writer=(r=this.stream)==null?void 0:r.getWriter()),this.chunkSize===0){try{this.cancelTokenSource=ve.CancelToken.source();let i=0,a=!1,c=null;for(;i<=this.maxRetries&&!a;)try{const s=await(await ve(zr({url:this.url,method:"GET",responseType:"blob",cancelToken:this.cancelTokenSource.token,...this.apiConfig,onDownloadProgress:f=>{var y;if(this.isPaused||this.isStop)return;const u=f.loaded;this.downloaded=u,(y=this.events)!=null&&y.uploading&&this.events.uploading(this.getProgress())}},this.apiConfig))).data.arrayBuffer();await this.writer.write(new Uint8Array(s)),a=!0}catch(o){if(c=o,ve.isCancel(o))throw o;i++,i<=this.maxRetries&&((n=this.events)!=null&&n.uploading&&this.events.uploading({status:"retry",message:`文件下载失败，正在进行第 ${i} 次重试`}),await new Promise(l=>setTimeout(l,1e3*i)))}if(!a)throw c||new Error(`文件下载失败，已重试 ${this.maxRetries} 次`)}catch(i){if(ve.isCancel(i))return;throw i}!this.isPaused&&!this.isStop&&(await this.mergeChunks(),(m=this.events)!=null&&m.success&&this.events.success());return}const t=Math.ceil(this.totalSize/this.chunkSize);for(let i=0;i<t&&!(this.isPaused||this.isStop);i++)try{if(this.chunks[i]){const f=await this.chunks[i].arrayBuffer();await((p=this.writer)==null?void 0:p.write(new Uint8Array(f)));continue}const a=i*this.chunkSize,c=Math.min(this.totalSize-1,(i+1)*this.chunkSize-1);this.cancelTokenSource=ve.CancelToken.source();let o=0,l=!1,s=null;for(;o<=this.maxRetries&&!l;)try{const u=(await ve(zr({url:this.url,method:"GET",responseType:"blob",cancelToken:this.cancelTokenSource.token,headers:{range:`bytes=${a}-${c}`},onDownloadProgress:w=>{var _,R;if(this.isPaused||this.isStop)return;const g=w.loaded,h=this.downloaded-(((_=this.chunks[i])==null?void 0:_.size)||0)+g,v={status:"uploading",downloaded:h,total:this.totalSize,percent:Math.round(this.totalSize?h/this.totalSize*100:0)};(R=this.events)!=null&&R.uploading&&this.events.uploading(v)}},this.apiConfig))).data;await this.saveChunkToIndexedDB(i,u),this.chunks[i]=u,this.downloaded+=u.size;const y=await u.arrayBuffer();await((b=this.writer)==null?void 0:b.write(new Uint8Array(y))),(x=this.events)!=null&&x.uploading&&this.events.uploading(this.getProgress()),l=!0}catch(f){if(l=!1,s=f,ve.isCancel(f))throw f;o++,o<=this.maxRetries&&((E=this.events)!=null&&E.uploading&&this.events.uploading({status:"retry",message:`分片 ${i} 下载失败，正在进行第 ${o} 次重试`}),await new Promise(u=>setTimeout(u,1e3*o)))}if(!l)throw s||new Error(`分片 ${i} 下载失败，已重试 ${this.maxRetries} 次`)}catch(a){if(ve.isCancel(a))return;throw a}!this.isPaused&&!this.isStop&&(await this.mergeChunks(),(d=this.events)!=null&&d.success&&this.events.success())}async saveChunkToIndexedDB(t,r){return new Promise((n,m)=>{const p=this.db.transaction([this.storeName],"readwrite");p.objectStore(this.storeName).put({index:t,blob:r}),p.oncomplete=()=>n(),p.onerror=x=>m(x.target.error)})}async loadChunksFromIndexedDB(){return new Promise((t,r)=>{const p=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();p.onsuccess=b=>{const x=b.target.result;this.chunks=[],this.downloaded=0;for(const{index:E,blob:d}of x)this.chunks[E]=d,this.downloaded+=d.size;t()},p.onerror=b=>r(b.target.error)})}async clearChunksFromIndexedDB(){return new Promise((t,r)=>{if(this.db){const p=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();p.onsuccess=()=>t(),p.onerror=b=>r(b.target.error)}else t()})}async mergeChunks(){this.writer&&(await this.writer.close(),this.writer=null,this.stream=null),await this.clearChunksFromIndexedDB(),this.db&&(this.db.close(),this.db=null),await new Promise((t,r)=>{const n=indexedDB.deleteDatabase(this.dbName);n.onsuccess=()=>{t()},n.onerror=m=>r(m.target.error),n.onblocked=()=>{}}),this.isCompleted=!0}}function zr(e,t){const r={...e};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]!==null&&typeof t[n]=="object"&&!Array.isArray(t[n])&&e[n]!==null&&typeof e[n]=="object"&&!Array.isArray(e[n])?r[n]=zr(e[n],t[n]):r[n]=t[n]);return r}function Na(e){let t=0,r,n;if(e.length===0)return t;for(r=0;r<e.length;r++)n=e.charCodeAt(r),t=(t<<5)-t+n,t|=0;return t}const La=async e=>{try{const t=await fetch(e,{method:"HEAD"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=t.headers.get("content-length");if(!r)throw new Error("无法获取文件大小：服务器头部未返回 Content-Length ");return{size:parseInt(r,10)}}catch(t){throw new Error(`获取失败: ${t.message}`)}};exports.FileDownloader=Da;exports.FileUploader=Ro;exports.getFileSize=La;
